(function(e){e.jGrowl=function(t,n){e("#jGrowl").size()==0&&e('<div id="jGrowl"></div>').addClass(n&&n.position?n.position:e.jGrowl.defaults.position).appendTo("body"),e("#jGrowl").jGrowl(t,n)},e.fn.jGrowl=function(t,n){if(e.isFunction(this.each)){var r=arguments;return this.each(function(){var i=this;e(this).data("jGrowl.instance")==undefined&&(e(this).data("jGrowl.instance",e.extend(new e.fn.jGrowl,{notifications:[],element:null,interval:null})),e(this).data("jGrowl.instance").startup(this)),e.isFunction(e(this).data("jGrowl.instance")[t])?e(this).data("jGrowl.instance")[t].apply(e(this).data("jGrowl.instance"),e.makeArray(r).slice(1)):e(this).data("jGrowl.instance").create(t,n)})}},e.extend(e.fn.jGrowl.prototype,{defaults:{pool:0,header:"",group:"",sticky:!1,position:"top-right",glue:"after",theme:"default",themeState:"highlight",corners:"10px",check:250,life:3e3,closeDuration:"normal",openDuration:"normal",easing:"swing",closer:!0,closeTemplate:"&times;",closerTemplate:"<div>[ close all ]</div>",log:function(e,t,n){},beforeOpen:function(e,t,n){},afterOpen:function(e,t,n){},open:function(e,t,n){},beforeClose:function(e,t,n){},close:function(e,t,n){},animateOpen:{opacity:"show"},animateClose:{opacity:"hide"}},notifications:[],element:null,interval:null,create:function(t,n){var n=e.extend({},this.defaults,n);typeof n.speed!="undefined"&&(n.openDuration=n.speed,n.closeDuration=n.speed),this.notifications.push({message:t,options:n}),n.log.apply(this.element,[this.element,t,n])},render:function(t){var n=this,r=t.message,i=t.options;i.themeState=i.themeState==""?"":"ui-state-"+i.themeState;var t=e('<div class="jGrowl-notification '+i.themeState+" ui-corner-all"+(i.group!=undefined&&i.group!=""?" "+i.group:"")+'">'+'<div class="jGrowl-close">'+i.closeTemplate+"</div>"+'<div class="jGrowl-header">'+i.header+"</div>"+'<div class="jGrowl-message">'+r+"</div></div>").data("jGrowl",i).addClass(i.theme).children("div.jGrowl-close").bind("click.jGrowl",function(){e(this).parent().trigger("jGrowl.close")}).parent();e(t).bind("mouseover.jGrowl",function(){e("div.jGrowl-notification",n.element).data("jGrowl.pause",!0)}).bind("mouseout.jGrowl",function(){e("div.jGrowl-notification",n.element).data("jGrowl.pause",!1)}).bind("jGrowl.beforeOpen",function(){i.beforeOpen.apply(t,[t,r,i,n.element])!=0&&e(this).trigger("jGrowl.open")}).bind("jGrowl.open",function(){i.open.apply(t,[t,r,i,n.element])!=0&&(i.glue=="after"?e("div.jGrowl-notification:last",n.element).after(t):e("div.jGrowl-notification:first",n.element).before(t),e(this).animate(i.animateOpen,i.openDuration,i.easing,function(){e.browser.msie&&(parseInt(e(this).css("opacity"),10)===1||parseInt(e(this).css("opacity"),10)===0)&&this.style.removeAttribute("filter"),e(this).data("jGrowl")!=null&&(e(this).data("jGrowl").created=new Date),e(this).trigger("jGrowl.afterOpen")}))}).bind("jGrowl.afterOpen",function(){i.afterOpen.apply(t,[t,r,i,n.element])}).bind("jGrowl.beforeClose",function(){i.beforeClose.apply(t,[t,r,i,n.element])!=0&&e(this).trigger("jGrowl.close")}).bind("jGrowl.close",function(){e(this).data("jGrowl.pause",!0),e(this).animate(i.animateClose,i.closeDuration,i.easing,function(){e.isFunction(i.close)?i.close.apply(t,[t,r,i,n.element])!==!1&&e(this).remove():e(this).remove()})}).trigger("jGrowl.beforeOpen"),i.corners!=""&&e.fn.corner!=undefined&&e(t).corner(i.corners),e("div.jGrowl-notification:parent",n.element).size()>1&&e("div.jGrowl-closer",n.element).size()==0&&this.defaults.closer!=0&&e(this.defaults.closerTemplate).addClass("jGrowl-closer "+this.defaults.themeState+" ui-corner-all").addClass(this.defaults.theme).appendTo(n.element).animate(this.defaults.animateOpen,this.defaults.speed,this.defaults.easing).bind("click.jGrowl",function(){e(this).siblings().trigger("jGrowl.beforeClose"),e.isFunction(n.defaults.closer)&&n.defaults.closer.apply(e(this).parent()[0],[e(this).parent()[0]])})},update:function(){e(this.element).find("div.jGrowl-notification:parent").each(function(){e(this).data("jGrowl")!=undefined&&e(this).data("jGrowl").created!=undefined&&e(this).data("jGrowl").created.getTime()+parseInt(e(this).data("jGrowl").life)<(new Date).getTime()&&e(this).data("jGrowl").sticky!=1&&(e(this).data("jGrowl.pause")==undefined||e(this).data("jGrowl.pause")!=1)&&e(this).trigger("jGrowl.beforeClose")}),this.notifications.length>0&&(this.defaults.pool==0||e(this.element).find("div.jGrowl-notification:parent").size()<this.defaults.pool)&&this.render(this.notifications.shift()),e(this.element).find("div.jGrowl-notification:parent").size()<2&&e(this.element).find("div.jGrowl-closer").animate(this.defaults.animateClose,this.defaults.speed,this.defaults.easing,function(){e(this).remove()})},startup:function(t){this.element=e(t).addClass("jGrowl").append('<div class="jGrowl-notification"></div>'),this.interval=setInterval(function(){e(t).data("jGrowl.instance").update()},parseInt(this.defaults.check)),e.browser.msie&&parseInt(e.browser.version)<7&&!window.XMLHttpRequest&&e(this.element).addClass("ie6")},shutdown:function(){e(this.element).removeClass("jGrowl").find("div.jGrowl-notification").remove(),clearInterval(this.interval)},close:function(){e(this.element).find("div.jGrowl-notification").each(function(){e(this).trigger("jGrowl.beforeClose")})}}),e.jGrowl.defaults=e.fn.jGrowl.prototype.defaults})(jQuery)
window.ZeroClipboard={version:"1.0.8",clients:{},moviePath:"ZeroClipboard.swf",nextId:1,$:function(e){return typeof e=="string"&&(e=document.getElementById(e)),e.addClass||(e.hide=function(){this.style.display="none"},e.show=function(){this.style.display=""},e.addClass=function(e){this.removeClass(e),this.className+=" "+e},e.removeClass=function(e){var t=this.className.split(/\s+/),n=-1;for(var r=0;r<t.length;r++)t[r]==e&&(n=r,r=t.length);return n>-1&&(t.splice(n,1),this.className=t.join(" ")),this},e.hasClass=function(e){return!!this.className.match(new RegExp("\\s*"+e+"\\s*"))}),e},setMoviePath:function(e){this.moviePath=e},newClient:function(){return new ZeroClipboard.Client},dispatch:function(e,t,n){var r=this.clients[e];r&&r.receiveEvent(t,n)},register:function(e,t){this.clients[e]=t},getDOMObjectPosition:function(e,t){var n={left:0,top:0,width:e.width?e.width:e.offsetWidth,height:e.height?e.height:e.offsetHeight};while(e&&e!=t)n.left+=e.offsetLeft,n.left+=e.style.borderLeftWidth?parseInt(e.style.borderLeftWidth):0,n.top+=e.offsetTop,n.top+=e.style.borderTopWidth?parseInt(e.style.borderTopWidth):0,e=e.offsetParent;return n},Client:function(e){this.handlers={},this.id=ZeroClipboard.nextId++,this.movieId="ZeroClipboardMovie_"+this.id,ZeroClipboard.register(this.id,this),e&&this.glue(e)}},ZeroClipboard.Client.prototype={id:0,title:"",ready:!1,movie:null,clipText:"",handCursorEnabled:!0,cssEffects:!0,handlers:null,zIndex:99,glue:function(e,t,n){this.domElement=ZeroClipboard.$(e),this.domElement.style.zIndex&&(this.zIndex=parseInt(this.domElement.style.zIndex,10)+1),this.domElement.getAttribute("title")!=null&&(this.title=this.domElement.getAttribute("title")),typeof t=="string"?t=ZeroClipboard.$(t):typeof t=="undefined"&&(t=document.getElementsByTagName("body")[0]);var r=ZeroClipboard.getDOMObjectPosition(this.domElement,t);this.div=document.createElement("div");var i=this.div.style;i.position="absolute",i.left=""+r.left+"px",i.top=""+r.top+"px",i.width=""+r.width+"px",i.height=""+r.height+"px",i.zIndex=this.zIndex;if(typeof n=="object")for(var s in n)i[s]=n[s];t.appendChild(this.div),this.div.innerHTML=this.getHTML(r.width,r.height)},getHTML:function(e,t){var n="",r="id="+this.id+"&width="+e+"&height="+t,i=this.title?' title="'+this.title+'"':"";if(navigator.userAgent.match(/MSIE/)){var s=location.href.match(/^https/i)?"https://":"http://";n+="<object"+i+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+s+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+e+'" height="'+t+'" id="'+this.movieId+'"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+ZeroClipboard.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+r+'"/><param name="wmode" value="transparent"/></object>'}else n+="<embed"+i+' id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+e+'" height="'+t+'" name="'+this.movieId+'" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+r+'" wmode="transparent" />';return n},hide:function(){this.div&&(this.div.style.left="-2000px")},show:function(){this.reposition()},destroy:function(){if(this.domElement&&this.div){this.hide(),this.div.innerHTML="";var e=document.getElementsByTagName("body")[0];try{e.removeChild(this.div)}catch(t){}this.domElement=null,this.div=null}},reposition:function(e){e&&(this.domElement=ZeroClipboard.$(e),this.domElement||this.hide());if(this.domElement&&this.div){var t=ZeroClipboard.getDOMObjectPosition(this.domElement),n=this.div.style;n.left=""+t.left+"px",n.top=""+t.top+"px"}},setText:function(e){this.clipText=e,this.ready&&this.movie.setText(e)},setTitle:function(e){this.title=e},addEventListener:function(e,t){e=e.toString().toLowerCase().replace(/^on/,""),this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)},setHandCursor:function(e){this.handCursorEnabled=e,this.ready&&this.movie.setHandCursor(e)},setCSSEffects:function(e){this.cssEffects=!!e},receiveEvent:function(e,t){e=e.toString().toLowerCase().replace(/^on/,"");switch(e){case"load":this.movie=document.getElementById(this.movieId);if(!this.movie){var n=this;setTimeout(function(){n.receiveEvent("load",null)},1);return}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){var n=this;setTimeout(function(){n.receiveEvent("load",null)},100),this.ready=!0;return}this.ready=!0,this.movie.setText(this.clipText),this.movie.setHandCursor(this.handCursorEnabled);break;case"mouseover":this.domElement&&this.cssEffects&&(this.domElement.addClass("hover"),this.recoverActive&&this.domElement.addClass("active"));break;case"mouseout":this.domElement&&this.cssEffects&&(this.recoverActive=!1,this.domElement.hasClass("active")&&(this.domElement.removeClass("active"),this.recoverActive=!0),this.domElement.removeClass("hover"));break;case"mousedown":this.domElement&&this.cssEffects&&this.domElement.addClass("active");break;case"mouseup":this.domElement&&this.cssEffects&&(this.domElement.removeClass("active"),this.recoverActive=!1)}if(this.handlers[e])for(var r=0,i=this.handlers[e].length;r<i;r++){var s=this.handlers[e][r];typeof s=="function"?s(this,t):typeof s=="object"&&s.length==2?s[0][s[1]](this,t):typeof s=="string"&&window[s](this,t)}}},typeof module!="undefined"&&(module.exports=ZeroClipboard)
document.domain="xunlei.com";var Protocol={INTERFACE:"interface",PROTOCOL:"http",HOST:"homecloud.yuancheng.xunlei.com",PORT:"80",V:"2",CT:"0",DEBUG:!1,LISTPEER_TYPE_UNUSED:0,LISTPEER_TYPE_ETM:1,LISTPEER_TYPE_XL:2,LISTPEER_TYPE_XLX:3,LISTPEER_TYPE_PLAYER:10,LISTPEER_TYPE_ROUTER:20,LISTPEER_TYPE_NAS:30,LISTPEER_TYPE_WIFI:40,LISTPEER_TYPE_MOBILE:50,LISTPEER_TYPE_PAD:60,LIST_TASK_TYPE_GENERAL:1,LIST_TASK_TYPE_BT:2,LIST_TASK_TYPE_EMULE:3,LIST_TASK_STATE_DOWNLOADING:0,LIST_TASK_STATE_WAITING:8,LIST_TASK_STATE_STOPPED:9,LIST_TASK_STATE_PAUSED:10,LIST_TASK_STATE_COMPLETED:11,LIST_TASK_STATE_FAILED:12,LIST_TASK_STATE_UPLOADING:13,LIST_TASK_STATE_PREDOWNLOAD:14,LIST_TASK_STATE_DELETED:15,LIST_TASK_STATE_RECYCLED:16,LIST_TASK_STATE_PENDING:37,LIST_TASK_STATE_ERROR:38,LIST_TASK_VIPCHANNEL_TYPE_FREE3:0,LIST_TASK_VIPCHANNEL_TYPE_GREEN:1,LIST_TASK_VIPCHANNEL_TYPE_VIP:2,LIST_TASK_VIPCHANNEL_TYPE_UNAVAILABLE:-1,LIST_TASK_VIPCHANNEL_OPENED_NOTUSED:0,LIST_TASK_VIPCHANNEL_OPENED_SUBMITTING:1,LIST_TASK_VIPCHANNEL_OPENED_ACTIVATED:2,LIST_TASK_VIPCHANNEL_OPENED_FAILED:3,LIST_TASK_LIXIANCHANNEL_STATE_NOTUSED:0,LIST_TASK_LIXIANCHANNEL_STATE_SUBMITTING:1,LIST_TASK_LIXIANCHANNEL_STATE_DOWNLOADING:2,LIST_TASK_LIXIANCHANNEL_STATE_ACTIVATED:3,LIST_TASK_LIXIANCHANNEL_STATE_FAILED:4,LIST_TASK_SUBLIST_STATUS_WAITING:0,LIST_TASK_SUBLIST_STATUS_RUNNING:1,LIST_TASK_SUBLIST_STATUS_COMPLETED:2,LIST_TASK_SUBLIST_STATUS_FAILED:3,LIST_TASK_ERR_SUCCESS:0,LIST_TASK_ERR_RELATE_ERROR:61,LIST_TASK_ERR_RELATE_OVERFLOW:62,LIST_TASK_ERR_RELATE_ALREADY:63,LIST_TASK_ERR_DB_FAULT:64,LIST_TASK_ERR_MACHINE_NOT_RELATED:65,LIST_TASK_ERR_MACHINE_NOT_FOUND:101,LIST_TASK_ERR_KEY_WRONG:102,LIST_TASK_ERR_KEY_NOT_FOUND:103,LIST_TASK_ERR_INVALID_USER:104,LIST_TASK_ERR_MACHINE_RESET:105,LIST_TASK_ERR_MACHINE_NAME_DUP:106,LIST_TASK_ERR_INVALID_REQUEST:107,LIST_TASK_ERR_CLIENT_NOT_SUPPORT:108,LIST_TASK_ERR_DOWN_URL_ILLEGAL:201,LIST_TASK_ERR_TASK_ALREADY_EXISTS:202,LIST_TASK_ERR_TASK_ALREADY_WAITTING:203,LIST_TASK_ERR_NO_SPACE:204,LIST_TASK_ERR_PATH_ILLEGAL:205,LIST_TASK_ERR_COMMON_TASK_TOO_MANY:206,LIST_TASK_ERR_BT_FILE:207,LIST_TASK_ERR_BT_TOO_LARGE:208,LIST_TASK_ERR_BT_EXCEPT_FILE:209,LIST_TASK_ERR_BT_TASK_TOO_MANY:210,LIST_TASK_ERR_BT_TASK_EMPTY:211,LIST_TASK_ERR_TASK_NOT_EXISTS:301,LIST_TASK_ERR_THUNDER_REFUSE:302,LIST_TASK_ERR_TASK_WAITING:303,LIST_TASK_ERR_THUNDER_TIMEOUT:401,LIST_TASK_ERR_PLUGIN_VERSION:402,LIST_TASK_ERR_INTERNAL:403,LIST_TASK_ERR_UNKNOWN:500,LIST_TASK_ERR_SESSIONID_FALSE:601,LIST_TASK_ERR_SESSIONID_EXPIRED:602,LIST_TASK_ERR_MULTIPLE_APPLY_CONTROL:603,LIST_TASK_ERR_MAX_CONNECTION:604,LIST_TASK_ERR_MACHINE_NAME_INVALID:605,MESSAGE_LIST_TASK_ERRORS:{3:"服务器内部错误",4:"服务器内部错误",201:"url非法",202:"任务已经存在",203:"任务已经在等待创建中",204:"磁盘空间不足",205:"存储路径错误",206:"bt种子错误",207:"bt种子文件太大",208:"无法下载该类型bt任务",209:"bt任务个数过多",210:"bt任务无需要下载的子任务",20482:"下载地址错误",1274:"向下载库的map表中插入重复数据",106510:"无法打开数据库文件",2298:"写文件失败",107:"创建文件或写数据失败",131:"服务器连接异常",108:"写入数据失败",112:"磁盘空间不足",401:"网络状况不佳",1025:"内存不足",1624:"参数错误",2750:"DNS解析错误",4112:"任务URL存在异常",4200:"无效的URL",4201:"文件存储路径无效",4202:"文件名无效",4216:"重复下载了相同的任务",15400:"BT种子没资源或磁盘空间不足",15414:"磁力链任务建立失败",106517:"设备固件问题",106596:"磁盘异常",106597:"磁盘异常"},MESSAGE_LIST_TASK_VIPCHANNEL_ERRORS:{101:"流量不足",102:"上一个操作尚未完成",103:"超时未提交",104:"提交数据错误，请稍后再试",105:"请安装最新版本迅雷客户端",106:"加速文件不存在",107:"剩余流量为零，不能提交",500:"服务器忙",502:"参数错误",503:"任务不存在",504:"流量卡达到上限",505:"被锁定账户",507:"账户过期",308:"资源被举报，无法加速",23553:"无加速资源",23554:"流量不足",23563:"解析服务器响应失败"},LIST_TASK_LIXIANCHANNEL_ERR_OK:0,LIST_TASK_LIXIANCHANNEL_ERR_ERROR:1,LIST_TASK_LIXIANCHANNEL_ERR_CHECK_VIP_QUEUE_FULL:2,LIST_TASK_LIXIANCHANNEL_ERR_VIP_SERVER_ERROR:3,LIST_TASK_LIXIANCHANNEL_ERR_ACCOUNT_SERVER_ERROR:4,LIST_TASK_LIXIANCHANNEL_ERR_INVALID_USER:5,LIST_TASK_LIXIANCHANNEL_ERR_CONN_GB_ERROR:6,LIST_TASK_LIXIANCHANNEL_ERR_IP_LOCKED:7,LIST_TASK_LIXIANCHANNEL_ERR_SESSION_FAILED:8,LIST_TASK_LIXIANCHANNEL_ERR_GB_LOGIN_FAILED:9,LIST_TASK_LIXIANCHANNEL_ERR_SPACE_LACK:10,LIST_TASK_LIXIANCHANNEL_ERR_GET_TORRENT_DB_FAILED:11,LIST_TASK_LIXIANCHANNEL_ERR_CONN_DBP_ERROR:12,LIST_TASK_LIXIANCHANNEL_ERR_USER_NOT_EXIST:13,LIST_TASK_LIXIANCHANNEL_ERR_INVALID_MSG_TYPE:14,LIST_TASK_LIXIANCHANNEL_ERR_QUERY_USER_INFO_FAILED:15,LIST_TASK_LIXIANCHANNEL_ERR_QUERY_TASK_LIST_FAILED:16,LIST_TASK_LIXIANCHANNEL_ERR_ADD_NEW_USER_FAILED:17,LIST_TASK_LIXIANCHANNEL_ERR_TIME_OUT:18,LIST_TASK_LIXIANCHANNEL_ERR_CONVERT_THUNDER_URL_FAILED:19,LIST_TASK_LIXIANCHANNEL_ERR_NO_TASK_COMMIT:20,LIST_TASK_LIXIANCHANNEL_ERR_EMULE_CHECK_FAIL:21,LIST_TASK_LIXIANCHANNEL_ERR_CREATE_LOGIN_FSM_FAIL:22,LIST_TASK_LIXIANCHANNEL_ERR_COMMIT_SAME_TASK:23,LIST_TASK_LIXIANCHANNEL_ERR_DELETE_FSM_EXIST:24,LIST_TASK_LIXIANCHANNEL_ERR_DELETE_TASK_FAILED:25,LIST_TASK_LIXIANCHANNEL_ERR_CREATE_DEL_FSM_FAILED:26,LIST_TASK_LIXIANCHANNEL_ERR_COMMIT_URL_NOT_MATCH:27,LIST_TASK_LIXIANCHANNEL_ERR_GOLDBEAN_LACK:28,LIST_TASK_LIXIANCHANNEL_ERR_CONVERT_GOLDBEAN_FAILED:29,LIST_TASK_LIXIANCHANNEL_ERR_SECTION_INVALID:30,LIST_TASK_LIXIANCHANNEL_ERR_SPACE_OR_GB_LACK:31,LIST_TASK_LIXIANCHANNEL_ERR_ADD_NEW_TASK_FAILED:32,LIST_TASK_LIXIANCHANNEL_ERR_UPDATE_COMMIT_TIME_FAILED:33,LIST_TASK_LIXIANCHANNEL_ERR_CHECK_TASK_INVALID:34,LIST_TASK_LIXIANCHANNEL_ERR_CHECK_TASK_USER_INVALID:35,LIST_TASK_LIXIANCHANNEL_ERR_DELETE_DB_FAILED:36,LIST_TASK_LIXIANCHANNEL_ERR_DEL_INPUT_QUEUE_FULL:37,LIST_TASK_LIXIANCHANNEL_ERR_TORRENT_INVALID:38,LIST_TASK_LIXIANCHANNEL_ERR_TORRENT_EMPTY:39,LIST_TASK_LIXIANCHANNEL_ERR_SAVE_TORRENT_FAILED:40,LIST_TASK_LIXIANCHANNEL_ERR_INFO_HASH_NOT_MATCH:41,LIST_TASK_LIXIANCHANNEL_ERR_COMMIT_TASK_TOO_MORE:42,LIST_TASK_LIXIANCHANNEL_ERR_SUSPEND_INPUT_QUEUE_FULL:43,LIST_TASK_LIXIANCHANNEL_ERR_SUSPEND_DB_FAILED:44,LIST_TASK_LIXIANCHANNEL_ERR_GET_DL_HISTORY_FAILED:45,LIST_TASK_LIXIANCHANNEL_ERR_TASK_NOT_EXIST:46,LIST_TASK_LIXIANCHANNEL_ERR_INFO_HASH_INVLIAD:47,LIST_TASK_LIXIANCHANNEL_ERR_XL_VERSION_OLD:48,LIST_TASK_LIXIANCHANNEL_ERR_CREATE_TASKQUERY_FSM_FAILED:49,LIST_TASK_LIXIANCHANNEL_ERR_CREATE_COMMIT_FSM_FAILED:50,LIST_TASK_LIXIANCHANNEL_ERR_CREATE_BTCOMMIT_FSM_FAILED:51,LIST_TASK_LIXIANCHANNEL_ERR_GET_COMMIT_FSM_FAILED:52,LIST_TASK_LIXIANCHANNEL_ERR_GET_BTCOMMIT_FSM_FAILED:53,LIST_TASK_LIXIANCHANNEL_ERR_CREATE_TRANSFER_FSM_FAILED:54,LIST_TASK_LIXIANCHANNEL_ERR_CREATE_SUSPEND_FSM_FAILED:55,LIST_TASK_LIXIANCHANNEL_ERR_CREATE_USERTASK_FSM_FAILED:56,LIST_TASK_LIXIANCHANNEL_ERR_TASK_DELAY_DB_FAILED:57,LIST_TASK_LIXIANCHANNEL_ERR_INVALID_KEY:58,LIST_TASK_LIXIANCHANNEL_ERR_GET_FREE_INFO_FAILED:59,LIST_TASK_LIXIANCHANNEL_ERR_INVALID_KANKAN_URL:60,LIST_TASK_LIXIANCHANNEL_ERR_OLD_VERSION_OF_FREE:61,LIST_TASK_LIXIANCHANNEL_ERR_LOADING_SERVER:62,LIST_TASK_LIXIANCHANNEL_ERR_GET_TASK_LIST_FAILED:63,LIST_TASK_LIXIANCHANNEL_ERR_GET_SUB_TASK_FAILED:64,LIST_TASK_LIXIANCHANNEL_ERR_DB_QUERY_SPACE_FAILED:65,LIST_TASK_LIXIANCHANNEL_ERR_USER_ID_INVALID:66,LIST_TASK_LIXIANCHANNEL_ERR_SWITCH_OFF:67,LIST_TASK_LIXIANCHANNEL_ERR_UPDATE_TASK_FAILED:68,LIST_TASK_LIXIANCHANNEL_ERR_DEDUCT_AUTH_FAILED:69,LIST_TASK_LIXIANCHANNEL_ERR_NEED_HIGHER_VIP:70,LIST_TASK_LIXIANCHANNEL_ERR_CLASS_OPERATE_DB_FAILED:71,LIST_TASK_LIXIANCHANNEL_ERR_MAX_CLASS_NUM:72,LIST_TASK_LIXIANCHANNEL_ERR_CLASS_NOT_EXIST:73,LIST_TASK_LIXIANCHANNEL_ERR_WRONG_PROTOCOL:24577,LIST_TASK_LIXIANCHANNEL_ERR_GET_ORIGINAL_URL:24578,LIST_TASK_LIXIANCHANNEL_ERR_USER_INFO_INVALID:24579,LIST_TASK_LIXIANCHANNEL_ERR_IS_WORKING:24580,LIST_TASK_LIXIANCHANNEL_ERR_TASK_NOT_RUNNING:24581,LIST_TASK_LIXIANCHANNEL_ERR_CODE_CONVERTION_ERROR:24582,LIST_TASK_LIXIANCHANNEL_ERR_ACC_URL_FORMAT:24583,MESSAGE_LIST_TASK_LIXIANCHANNEL_ERRORS:{1:"服务器连接失败",2:"服务器连接失败",3:"服务器连接失败",4:"服务器连接失败",5:"您还不是VIP用户，请开通会员",6:"服务器连接失败",7:"IP登录次数过多",8:"长时间未登录，请重新登录",9:"服务器连接失败",10:"离线空间不足",11:"服务器连接失败",12:"服务器连接失败",13:"您还不是VIP用户，请开通会员",14:"服务器异常",15:"服务器连接失败",16:"服务器连接失败",17:"服务器连接失败",18:"服务器连接超时",19:"URL解析错误",20:"提交任务失败",21:"提交任务失败",22:"操作失败",23:"重复任务",24:"操作失败",25:"操作失败",26:"操作失败",27:"提交任务失败",28:"金豆不足",29:"兑换金豆失败",30:"提交任务失败",31:"空间或金豆不足",32:"提交任务失败",33:"提交任务失败",34:"非法URL，无法提交",35:"非法URL，无法提交",36:"操作失败",37:"服务器繁忙，请稍候再试",38:"种子文件错误",39:"种子文件错误",40:"服务器连接失败",41:"提交任务失败",42:"文件超过1000的任务",43:"服务器繁忙，请稍候再试",44:"操作失败",45:"服务器繁忙，请稍候再试",46:"任务不存在",47:"种子文件错误",48:"请安装最新迅雷客户端使用金豆",49:"查询失败",50:"提交任务失败",51:"提交任务失败",52:"提交任务失败",53:"提交任务失败",54:"操作失败",55:"操作失败",56:"续期失败",57:"续期失败",58:"非法操作",59:"服务器连接失败",60:"非法URL，无法提交",61:"请安装最新迅雷客户端使用",62:"服务器连接失败",63:"服务器连接失败",64:"服务器连接失败",65:"服务器连接失败",66:"服务器连接失败",67:"服务器连接失败",68:"服务器连接失败",69:"服务器连接失败",70:"服务器连接失败",71:"服务器连接失败",72:"服务器连接失败",73:"分类不存在",74:"任务总数超过上限",75:"文件涉及版权或非法",76:"资源被举报，无法开启离线",24577:"服务器返回协议解析错误",24578:"原始URL获取错误",24579:"会员信息无效",24580:"重复开启离线",24581:"对未运行的任务开启离线",24582:"转码错误",24583:"加速URL无法识别",24584:"初始化失败",24585:"云端下载失败"},LIST_TYPE_RUNNING_TASKS:0,LIST_TYPE_COMPLETED_TASKS:1,LIST_TYPE_RECYCLED_TASKS:2,LIST_TYPE_FAILED_TASKS:3,_ajax:function(e,t,n,r){typeof t!="function"&&(t=function(){}),typeof n!="function"&&(n=function(){});var i=Protocol.PROTOCOL+"://"+Protocol.HOST+":"+Protocol.PORT+"/"+e+"&v="+Protocol.V+"&ct="+Protocol.CT+"&callback=?";Protocol.DEBUG&&(console.log("----------------"),console.log("AJAX: "+i)),r===undefined?$.ajax({url:i,dataType:"jsonp",success:function(e){Protocol.DEBUG&&console.log(e),t(e)},error:function(){Protocol.DEBUG&&console.log("REQUEST FAILED"),n()}}):$.ajax({url:i,dataType:"jsonp",timeout:parseInt(r),success:function(e){Protocol.DEBUG&&console.log(e),t(e)},error:function(){Protocol.DEBUG&&console.log("REQUEST FAILED"),n()}})},_post:function(e,t,n,r){typeof n!="function"&&(n=function(){}),typeof r!="function"&&(r=function(){});var i=Protocol.PROTOCOL+"://"+Protocol.HOST+"/"+e+"&v="+Protocol.V+"&ct="+Protocol.CT;Protocol.DEBUG&&(console.log("----------------"),console.log("AJAX: "+i),console.log("WITH: "+JSON.stringify(t))),Protocol._create_post(i,t,n)},_post_id:0,_create_post:function(e,t,n){var r=String(++Protocol._post_id),i='<form action="'+e+'&callback=window.parent.Protocol.postCallback" '+'method="post" target="ajax-iframe">';Helper.isFunction(n)?Protocol.postCallback=n:Protocol.postCallback=function(){};for(var s in t)i+='<input type="hidden" name="'+s+'" value="'+t[s]+'" />';i+="</form>",$("#ajax-form-div").html(i).find("form").submit().html(" ")},postCallback:function(){},login:function(e,t,n,r){var i="login?pid="+e+"&clientType="+t;Protocol._ajax(i,n,r)},listPeer:function(e,t){var n="listPeer?type=0",r=this,i=new Date;Protocol._ajax(n,function(t){r._resetInterval(new Date-i),e(t)},t)},bind:function(e,t,n,r){var i="bind?boxName="+e+"&key="+t.replace(/#/g,"%23");Protocol._ajax(i,n,r)},unbind:function(e,t,n){var r="unbind?pid="+e;Protocol._ajax(r,t,n)},getConfig:function(e,t,n){var r="settings?pid="+e;Protocol._ajax(r,t,n)},setConfig:function(e,t,n,r){var i="settings?pid="+e+"&"+Helper.queryString(t);Protocol._ajax(i,n,r)},rename:function(e,t,n,r){var i="rename?pid="+e+"&boxName="+t;Protocol._ajax(i,n,r)},boxSpace:function(e,t,n){var r="boxSpace?pid="+e;Protocol._ajax(r,t,n)},verifyAccessCode:function(e,t,n,r){var i="1/checkAccessPass?pid="+e;Protocol._post(i,{passwd:t},n,r)},list:function(e,t,n,r,i,s){var o="list?pid="+e+"&type="+t+"&pos="+n+"&number="+r+"&needUrl=1",u=this,a=new Date;Protocol._ajax(o,function(e){u._resetInterval(new Date-a),i(e)},s)},urlCheck:function(e,t,n,r,i){t=Helper.trim(t);var s="urlCheck?pid="+e+"&url="+t+"&type="+n,o=function(e){e.rtn==0&&e.taskInfo.name&&(e.taskInfo.name=e.taskInfo.name.replace(/[\\\/:\*\?"<>|]/g,"-")),r(e)};Protocol._ajax(s,o,i)},prepareCheckBTUrl:function(e,t){return Helper.isFunction(t)&&(this.checkBTCallback=t),Protocol.PROTOCOL+"://"+Protocol.HOST+":"+Protocol.PORT+"/urlCheck?v="+Protocol.V+"&pid="+e+"&type=2&upload=1&url=&callback=window.parent.Protocol.checkBTCallback"},checkBTCallback:function(){},createOne:function(e,t,n,r,i,s,o,u){n=Helper.trim(n);if(/[\\\/:\*\?"<>|]/g.test(r)){o({rtn:-1,msg:"文件名包含特殊字符"});return}var a="createOne?pid="+e+"&path="+Helper.urlEncodeSafe(t)+"&url="+n+"&name="+r.replace(/#/g,"%23")+"&type="+i+"&upload="+s;Protocol._ajax(a,o,u)},createMulti:function(e,t,n){if(t.length<=0){XRD.log("请传入URL参数！");return}t=Helper.unique(t);var r=Protocol.PROTOCOL+"://"+Protocol.HOST+":"+Protocol.PORT+"/"+"createMulti?pid="+e.pid+"&path="+Helper.urlEncodeSafe(e.path)+"&type="+e.type+"&v="+Protocol.V+"&callback=window.parent.Protocol.createMultiCallback",i="";for(var s=0;s<t.length;s++)t[s]=Helper.trim(t[s]),i+=Helper.urlEncode(t[s])+"\n";var o='<form action="'+r+'" method="post" target="ajax-iframe"><input type="hidden" name="plUrls" value="'+i+'" /></form>';Helper.isFunction(n)&&(Protocol.createMultiCallback=n),$("#ajax-form-div").html(o).find("form").submit(),$("#ajax-form-div").html(" ")},createMultiCallback:function(){},createMultiImprove:function(e,t,n){if(t.length<=0){XRD.log("Please import url parameter.");return}e.path=e.path.replace(/\\/g,"/"),e.path.lastIndexOf("/")!==e.path.length-1&&(e.path+="/");var r=Protocol.PROTOCOL+"://"+Protocol.HOST+":"+Protocol.PORT+"/"+"createMulti?pid="+e.pid+"&path="+Helper.urlEncodeSafe(e.path)+"&type="+e.type+"&v="+Protocol.V+"&callback=window.parent.Protocol.createMultiCallback",i="";for(var s=0;s<t.length;s++)i+=Helper.urlEncode(t[s][0])+" "+Helper.urlEncode(t[s][1].replace(/[\\\/:]/g,"-"))+"\n";var o='<form action="'+r+'" method="post" target="ajax-iframe"><input type="hidden" name="plUrls" value="'+i+'" /></form>';Helper.isFunction(n)&&(Protocol.createMultiCallback=n),$("#ajax-form-div").html(o).find("form").submit().html(" ")},prepareCreateBTUrl:function(e,t,n,r,i){return Helper.isFunction(i)&&(this.createBTCallback=i),Protocol.PROTOCOL+"://"+Protocol.HOST+":"+Protocol.PORT+"/createOne?v="+Protocol.V+"&pid="+e+"&path="+Helper.urlEncodeSafe(t)+"&name="+n.replace(/#/g,"%23")+"&btSub="+r.join(",")+"&type=2&upload=1&url=&callback=window.parent.Protocol.createBTCallback"},createBTCallback:function(){},start:function(e,t,n,r){var i="start?pid="+e+"&tasks="+t.join(",");Protocol._ajax(i,n,r)},pause:function(e,t,n,r){var i="pause?pid="+e+"&tasks="+t.join(",");Protocol._ajax(i,n,r)},del:function(e,t,n,r,i,s){var o="del?pid="+e+"&tasks="+t.join(",")+"&recycleTask="+n+"&deleteFile="+r;Protocol._ajax(o,i,s)},restore:function(e,t,n,r){var i="restore?pid="+e+"&tasks="+t.join(",");Protocol._ajax(i,n,r)},clear:function(e,t,n,r){var i="del?pid="+e+"&tasks=-1_64"+"&recycleTask=0"+"&deleteFile="+t;Protocol._ajax(i,n,r)},openLixianChannel:function(e,t,n,r){var i="openLixianChannel?taskid="+e+"&pid="+t+"&open=true";Protocol._ajax(i,n,r)},openVipChannel:function(e,t,n,r){var i="openVipChannel?taskid="+e+"&pid="+t;Protocol._ajax(i,n,r)},getBtSubList:function(e,t,n,r){var i="getBtSubList?pid="+e+"&taskid="+t;Protocol._ajax(i,n,r,3e4)},getVipInfo:function(e,t,n,r){typeof n!="function"&&(n=function(){}),typeof r!="function"&&(r=function(){});var i="http://hub.yuancheng.xunlei.com/check/vipcache?callback=?";$.ajax({url:i,dataType:"jsonp",timeout:1e4,success:function(e){e&&e.rtn==0&&e.ret==0?n(e):r(e)},error:function(){r()}})},checkVodPort:function(e,t,n){var r="http://"+e+":8002/check_server?callback=?";$.ajax({url:r,dataType:"jsonp",timeout:3e3,success:function(e){t(e)},error:function(){n()}})},getVodUrls:function(e,t,n,r){if(!Helper.isArray(t))return!1;typeof n!="function"&&(n=function(){}),typeof r!="function"&&(r=function(){});var i="http://"+e+":8002/get_task_abs_path?taskid="+t[0]+"&v=2&callback=?";$.ajax({url:i,dataType:"jsonp",timeout:1e4,success:function(e){e&&e.rtn==0?n(e):r(e.rtn)},error:function(e,t,n){r(t)}})},XMPPlay:function(e,t){try{Protocol.XMP=Helper.createDapCtrlInstance(),Protocol.XMPInstalledVer=Protocol.XMP.GetThunderVer("KANKAN","INSTALL"),Protocol.XMPRunningVer=Protocol.XMP.GetThunderVer("KANKAN","RUNNING"),Protocol.XMPPackageType=Protocol.XMP.Get("IXMPPACKAGETYPE");if(!Protocol.XMPPackageType||!Protocol.XMPInstalledVer)throw new Error;Protocol.XMPInstalledVer>550?Protocol.XMPCommand="SXMP4ARG":Protocol.XMPCommand="SXMPARG"}catch(n){return!1}Protocol.XMPPlayList=[],Protocol.XMPPlayNames=[];for(var r=0;r<t.length;r++){var i=t[r];i.lastIndexOf("/")!=-1&&(i=i.substr(i.lastIndexOf("/")+1)),Protocol.XMPPlayNames.push(i)}if(Helper.isString(e))Protocol.XMPPlayList=['"'+Helper.urlEncodeSafe(e)+'"'];else if(Helper.isArray(e))for(var r=0;r<e.length;r++)Protocol.XMPPlayList.push(Helper.urlEncodeSafe(e[r]));return Protocol.XMP.Put(Protocol.XMPCommand,Protocol.XMPPlayList.shift()+' /sname "'+Protocol.XMPPlayNames.shift()+'"'),Protocol.XMPAppendTimeoutHandle=setTimeout(Protocol.XMPAppend,3e3),!0},XMPAppend:function(){Protocol.XMPPlayList.length>0&&(Protocol.XMP.Put(Protocol.XMPCommand,Protocol.XMPPlayList.shift()+' /sname "'+Protocol.XMPPlayNames.shift()+'" /addtolist'),Protocol.XMPAppendTimeoutHandle=setTimeout(Protocol.XMPAppend,300))},XMP:null,XMPInstalledVer:null,XMPRunningVer:null,XMPPackageType:null,XMPPlayList:[],XMPPlayNames:[],XMPAppendTimeoutHandle:null,_lixianJQueryObject:null,lixianInit:function(){var e=0;if(Protocol._lixianJQueryObject===null){var t=0,n=$("<iframe>",{id:"lixianIframe",src:"http://i.vod.xunlei.com/proxy.html?v2.82",style:"display:none"}).appendTo(document);document.body.appendChild(n[0]);var r=setInterval(function(){++e>=50||Protocol._lixianJQueryObject!=null?(e=null,clearInterval(r)):$("#lixianIframe")[0].contentWindow.jQuery&&(Protocol._lixianJQueryObject=$("#lixianIframe")[0].contentWindow.jQuery,window.isLixianOpen&&(XRD.dispatch("open","lixian"),window.isLixianOpen=undefined))},200)}return Protocol._lixianJQueryObject},lixianPost:function(e,t,n){if(Protocol._lixianJQueryObject===null)return!1;Protocol._lixianJQueryObject.post("http://i.vod.xunlei.com/req_lxtask_list",e,function(e){e.ret<=0?t(e):n(e)},"json")},reqLxtaskList:function(e,t,n,r,i,s,o){var u={user_info:e,offset:t,req_num:n,req_type:r,fileattribute:i},a=JSON.stringify(u);Protocol.lixianPost(a,s,o)},_resetInterval:function(e){e=Number(e);if(!e||typeof XRD=="undefined"||!XRD.config.dynamicInterval)return!1;var t=0,n=0,r=0;r=(Math.log(e+1)/Math.log(4.32)-2.7)*3,t=Math.floor(r*5),n=Math.floor(r*10),t<5?t=5:t>30&&(t=30),n<10?n=10:n>60&&(n=60),XRD.config.downloaderListPeriod=n,XRD.config.taskListPeriod=t},_requestID:0,_homecloudPost:function(e,t,n,r){var i=++Protocol._requestID,s=Protocol.PROTOCOL+"://"+Protocol.HOST+":"+Protocol.PORT+"/"+e+"?"+(t?t+"&":"")+"v="+Protocol.V+"&ct="+Protocol.CT,o=0;return Protocol.DEBUG&&(console.log("-- HOMECLOUD POST API REQUEST #%s --------",i),console.log("POST: "+s)),Protocol.__post(s,n,function(e){try{var t=typeof e.constructor}catch(n){}Protocol.DEBUG&&console.log("RESPONSE: ",e),typeof r=="function"&&e&&(e._REQUEST_ID_=i,o=e.rtn,delete e.rtn,o>=0?r(o,e):r(-1,e))}),i},_homecloudFile:function(e,t,n,r){var i=++Protocol._requestID,s=Protocol.PROTOCOL+"://"+Protocol.HOST+":"+Protocol.PORT+"/"+e+"?"+(t?t+"&":"")+"v="+Protocol.V+"&ct="+Protocol.CT,o=0;return Protocol.DEBUG&&(console.log("-- HOMECLOUD FILE API REQUEST #%s --------",i),console.log("FILE: "+s)),Protocol._file(s,n,function(e){try{var t=typeof e.constructor}catch(n){}Protocol.DEBUG&&console.log("RESPONSE: ",e),typeof r=="function"&&e&&(e._REQUEST_ID_=i,o=e.rtn,delete e.rtn,o>=0?r(o,e):r(-1,e))}),i},__post:function(e,t,n){typeof n!="function"&&(n=function(){});var r=String(++Protocol._postId),i="_POST_CALLBACK_"+r+"_",s="_POST_DIV_"+r+"_",o="_POST_IFRAME_"+r+"_",u="_POST_FORM_"+r+"_",a=document.createElement("div"),f,l;a.id=s,a.style.display="none",a.innerHTML='<form id="'+u+'" name="'+u+'" target="'+o+'" method="POST" action="'+e+"&callback=window.parent."+i+'"></form>'+'<iframe id="'+o+'" name="'+o+'" src=""></iframe>',document.body.appendChild(a),f=document.getElementById(u),f.innerHTML="";for(var c in t)l=document.createElement("input"),l.type="hidden",l.name=c,l.value=t[c],f.appendChild(l);return window[i]=function(){n.apply(this,arguments),document.body.removeChild(a);try{delete window[i]}catch(e){}},f.submit(),r},_postId:0,_file:function(e,t,n){typeof n!="function"&&(n=function(){});var r=String(++Protocol._fileId),i="_FILE_"+r+"_",s=document.getElementById(t);return s.method="POST",s.action=e+"&callback=window.parent."+i,window[i]=function(){n.apply(this,arguments);try{delete window[i]}catch(e){}},s.submit(),r},_fileId:0,urlResolve:function(e,t,n){var r="pid="+e;return Protocol._homecloudPost("urlResolve",r,{json:JSON.stringify({url:t})},n)},createTask:function(e,t,n,r){var i=[],s;for(var o=0;o<n.length;o++)s=n[o],i.push(s);if(i.length>0){var u="pid="+e;return Protocol._homecloudPost("createTask",u,{json:JSON.stringify({path:t,tasks:i})},r)}return 0},btCheck:function(e,t,n){var r="pid="+e;return Protocol._homecloudFile("btCheck",r,t,n)},createBtTask:function(e,t,n,r,i,s){var o="pid="+e;return Protocol._homecloudPost("createBtTask",o,{json:JSON.stringify({path:t,infohash:n,name:r,btSub:i})},s)},_end:null}
var MESSAGES={init:"页面初始化",start:"页面初始化完毕",open:"打开指定页面",logout:"用户登出",heartbeat:"心跳事件",message:"消息提示",connectError:"无法连接到服务器",rGetDownloaderList:"获取所有已绑定的下载器",rDownloaderList:"已绑定的下载器列表",rDownloaderListFailed:"获取下载器列表失败",rDownloaderTaskStat:"当前下载器的任务数量统计信息",rGetDownloaderConfig:"获取指定下载器的配置信息",rGetDownloaderConfigFailed:"获取下载器配置信息失败",rDownloaderConfig:"下载器的配置信息",rLoginDownloader:"登录到指定下载器",rAddDownloader:"添加下载器",rClickDownloader:"点击指定下载器",rSelectDownloader:"选择指定下载器作为当前下载器",rConfigDownloader:"设置指定下载器",rRenameDownloader:"重命名指定下载器",rRemoveDownloader:"删除指定下载器",rDownloaderLogined:"下载器已登录",rDownloaderAdded:"下载器已添加",rDownloaderSelected:"下载器已选择",rDownloaderConfigured:"下载器已设置",rDownloaderRenamed:"下载器已重命名",rDownloaderRemoved:"下载器已删除",rDownloaderLoginFailed:"下载器登录失败",rDownloaderAddFailed:"添加下载器失败",rDownloaderConfigureFailed:"设置下载器失败",rDownloaderRenameFailed:"重命名下载器失败",rDownloaderRemoveFailed:"删除下载器失败",rShowRunningTasks:"显示当前下载器的正在下载任务",rShowCompletedTasks:"显示当前下载器的已完成任务",rShowFailedTasks:"显示当前下载器的失败任务",rShowRecycledTasks:"显示当前下载器的垃圾箱任务",rGetTaskList:"获取当前下载器的任务列表",rTaskList:"当前下载器的任务列表",rTaskListFailed:"获取任务列表失败",rTaskSelected:"任务已选择",rTaskDeselected:"任务已取消选择",rCreateTask:"新建任务",rCreateMultiTask:"新建批量任务",rStartTasks:"开始任务",rPauseTasks:"暂停任务",rRemoveTasks:"删除任务",rRecycleTasks:"回收任务",rRestoreTasks:"还原任务",rClearTasks:"清空任务",rTaskCreated:"任务已创建",rMultiTaskCreated:"批量任务已创建",rTaskStarted:"任务已开始",rTaskPaused:"任务已暂停",rTaskRemoved:"任务已删除",rTaskRecycled:"任务已回收",rTaskRestored:"任务已还原",rTaskCleared:"任务已清空",rTaskCreateFailed:"任务创建失败",rMultiTaskCreateFailed:"批量任务创建失败",rTaskStartFailed:"开始任务失败",rTaskPauseFailed:"暂停任务失败",rTaskRemoveFailed:"删除任务失败",rTaskRecycleFailed:"回收任务失败",rTaskRestoreFailed:"还原任务失败",rTaskClearFailed:"清空任务失败",rActiveLixianChannel:"开启离线加速",rActiveVipChannel:"开启高速通道",rLixianChannelActived:"离线加速已开启",rVipChannelActived:"高速通道已开启",rLixianChannelFailed:"离线加速开启失败",rVipChannelFailed:"高速通道开启失败",rCheckUrl:"分析URL",rUrlInfo:"URL分析结果",rUrlCheckFailed:"分析URL失败",rClickItem:"点击任务项",rSelectItem:"选择任务项",rDeselectItem:"取消选择任务项",rSelectAll:"选择所有任务项",rDeselectAll:"取消选择所有任务项",rSelectInverse:"反选所有任务项",rConfirmRemoveTasks:"确认删除任务"},VIDEO_EXTENSIONS=["asf","avi","wm","wmp","wmv","ram","rm","rmvb","rp","rpm","rt","smil","scm","dat","m1v","m2v","m2p","m2ts","mp2v","mpe","mpeg","mpeg1","mpeg2","mpg","mpv2","pss","pva","tp","tpr","ts","m4b","m4p","m4v","mp4","mpeg4","3g2","3gp","3gp2","3gpp","mov","qt","flv","f4v","swf","hlv","ifo","vob","amv","csf","divx","evo","mkv","mod","pmp","vp6","bik","mts","xv","xlmv","ogm","ogv","ogx","dvd"],XRD=function(){function e(){this.DEBUG=0,this.name="XRD",this.info={sessionid:"",userid:"",usernick:"",uservip:0,inXL:!1,currentModule:"",downloaderList:{},onlineDownloaderCount:0,currentDownloader:"",currentDownloaderType:"",currentTaskType:"",currentTaskList:{},selectedTasks:[],parameters:{},accessCodePopped:0,heartbeatTick:0},this.config={heartbeatInterval:1e3,downloaderListPeriod:30,taskListPeriod:30,defaultModule:"tasklist",dynamicInterval:!0},heartbeatHandle=null,this.modules={},this.times={},this.locks={},this.queues={},this.dispatcher=new Helper.Dispatcher,this.listening={},document.domain="xunlei.com",this.info.sessionid=Helper.getCookie("sessionid"),this.info.userid=Helper.getCookie("userid"),this.info.usernick=Helper.getCookie("usernick"),this.info.uservip=+Helper.getCookie("isvip"),this.parameters=window.PARAMETERS,this.info.inXL=!!window.PARAMETERS.xl}return Helper.extend(e.prototype,{init:function(){for(var e in this.modules)this.modules[e].init.call(this.modules[e]);this.on("start",this.start,this),this.on("open",this.moduleOpened,this),this.on("heartbeat",this.heartbeat,this),this.on("logout",this.logout,this),this.on("rDownloaderList",this.updateDownloaderList,this),this.on("rDownloaderSelected",this.downloaderSelected,this),this.on("rDownloaderTaskStat",this.updateDownloaderTaskStat,this),this.on("rDownloaderLogined",this.downloaderLogined,this),this.on("rDownloaderAdded",this.refreshDownloaderList,this),this.on("rDownloaderConfigured",this.refreshDownloaderList,this),this.on("rDownloaderRenamed",this.refreshDownloaderList,this),this.on("rDownloaderRemoved",this.refreshDownloaderList,this),this.on("rTaskList",this.updateTaskList,this),this.on("rTaskSelected",this.taskSelected,this),this.on("rTaskDeselected",this.taskDeselected,this),this.on("rDownloaderConfig",this.updateDownloaderConfig,this),this.on("rShowRunningTasks",this.updateTaskType,this),this.on("rShowCompletedTasks",this.updateTaskType,this),this.on("rShowRecycledTasks",this.updateTaskType,this),this.on("rShowFailedTasks",this.updateTaskType,this),this.on("rGoToPage",this.updateTaskType,this),this.on("rWindowReload",this.windowReload,this),this.on("rCheckVipInfo",this.checkVipInfo,this),this.dispatch("start"),this.dispatch("heartbeat",0)},dispatch:function(){if(this.DEBUG&&Helper.isArray(this.listening[arguments[0]])&&arguments[0]!="heartbeat"){var e=Helper.cloneArray(arguments);this.log("MESSAGE: "+e[0]),this.log("       ",e.slice(1)),this.log("    -> ",this.listening[arguments[0]])}this.dispatcher.dispatch.apply(this.dispatcher,arguments)},on:function(){if(Helper.isObject(arguments[2])){var e=arguments[2].name;Helper.isArray(this.listening[arguments[0]])?this.listening[arguments[0]].push(e):this.listening[arguments[0]]=[e]}this.dispatcher.on.apply(this.dispatcher,arguments)},off:function(){if(Helper.isObject(arguments[2])){var e=arguments[2].name;if(Helper.isArray(this.listening[arguments[0]])){var t=Helper.indexOf(this.listening[arguments[0]],e);this.listening[arguments[0]].splice(t,1)}}this.dispatcher.off.apply(this.dispatcher,arguments)},log:function(){typeof console=="object"&&typeof console.log=="function"&&this.DEBUG&&console.log.apply(console,arguments)},decay:function(e,t){t||(t=1);var n=Math.floor((new Date).getTime()/1e3);return!Helper.isNumber(this.times[e])||this.times[e]+t<n?(this.times[e]=n,!0):!1},defer:function(e){this.times[e]=Math.floor((new Date).getTime()/1e3)},lock:function(e){return this.locks[e]?!1:(this.locks[e]=1,!0)},unlock:function(e){this.locks[e]=0},enqueue:function(e,t){Helper.isArray(this.queues[e])?this.queues[e].push(t):this.queues[e]=[t]},dequeue:function(e){return this.queues[e].splice(0,1)},queueSize:function(e){return Helper.isArray(this.queues[e])?this.queues[e].length:0},attach:function(t,n){var r=new e.Module(t,n);this.modules[t]=r},detach:function(e){var t=this.modules[e];return t&&delete this.modules[e],t},start:function(e){this.parameters.a=="bind"&&this.parameters.key&&this.dispatch("rAddDownloader",this.parameters.key.toUpperCase());if(this.parameters.module)if(this.parameters.module==="lixian")window.isLixianOpen=1;else if(this.parameters.module==="task"){this.dispatch("open","tasklist");switch(this.parameters.type){case"0":this.info.currentTaskType="rShowRunningTasks";break;case"1":this.info.currentTaskType="rShowCompletedTasks";break;case"2":this.info.currentTaskType="rShowRecycledTasks";break;case"3":this.info.currentTaskType="rShowFailedTasks";break;default:}}else this.dispatch("open",this.parameters.module);else this.dispatch("open",this.config.defaultModule);this.parameters.pid&&(this.info.currentDownloader=this.parameters.pid),this.parameters.list&&(this.info.currentTaskType=this.parameters.list),this.dispatch("rCheckVipInfo")},moduleOpened:function(e,t){this.info.currentModule=t},heartbeat:function(e,t){this.info.sessionid!=Helper.getCookie("sessionid")&&this.info.userid!=Helper.getCookie("userid")&&this.dispatch("rWindowReload"),this.info.heartbeatTick=++t,this.heartbeatHandle=setTimeout('XRD.dispatch("heartbeat", '+t+");",this.config.heartbeatInterval)},checkVipInfo:function(e){var t=this;Protocol.getVipInfo(this.info.userid,this.info.sessionid,function(e){t.info.uservip=+e.isvip,t.modules.LiXian.init.call(t.modules.LiXian)},function(e){})},logout:function(e){this.resetPassed(),window.location.href="/login.html#a=logout"},windowReload:function(e){this.resetPassed(),window.location.reload()},updateDownloaderList:function(e,t){var n=[];this.info.onlineDownloaderCount=0,Helper.isArray(t)&&t.length>0&&t.sort(function(e,t){return t.lastLoginTime-e.lastLoginTime});for(var r=0;r<t.length;r++)Helper.isString(t[r].path_list)&&t[r].path_list.length>0?t[r].storage=!0:t[r].storage=!1,t[r].localIP=="255.255.255.255"&&(t[r].localIP=""),t[r].type>1&&t[r].type<10&&(t[r].isVirtual=!0),t[r].type>1&&t[r].type<10&&(t[r].isLite=!0),this.info.downloaderList[t[r].pid]?Helper.extend(this.info.downloaderList[t[r].pid],t[r]):this.info.downloaderList[t[r].pid]=t[r],t[r].online==1&&(this.info.onlineDownloaderCount++,this.info.downloaderList[t[r].pid].logined||this.dispatch("rLoginDownloader",t[r].pid)),n.push(t[r].pid);for(var i in this.info.downloaderList)Helper.indexOf(n,i)==-1&&delete this.info.downloaderList[i]},updateDownloaderTaskStat:function(e,t){Helper.extend(this.info.downloaderList[this.info.currentDownloader],t)},downloaderSelected:function(e,t,n){this.info.downloaderList[t].online&&t!=this.info.currentDownloader&&this.dispatch("rLoginDownloader",t),this.info.currentDownloader!=t?(this.info.downloaderList[this.info.currentDownloader]&&(this.info.downloaderList[this.info.currentDownloader].logined=!1),this.info.currentDownloader=t,this.info.currentModule=="tasklist"&&this.dispatch("rShowRunningTasks",!0)):n===!0&&this.info.currentModule=="tasklist"&&this.dispatch("rRefreshTaskList",!0),this.info.currentTaskType!="rShowRecycledTasks"&&($("#tasklist-toolbox [data-dispatch=popCreateTask]").show(),$("#tasklist-toolbox [data-dispatch=rRestoreSelectedTasks]").hide(),$("#tasklist-toolbox [data-dispatch=popClearRecycledTasks]").hide());if(this.parameters.a){switch(this.parameters.a){case"newtask":this.parameters.url&&this.dispatch("popCreateTask",Helper.urlDecode(this.parameters.url),this.parameters.name),delete this.parameters.url,delete this.parameters.name;break;case"importtasks":this.parameters.src&&this.dispatch("popImportTasks",Helper.urlDecode(this.parameters.src)),delete this.parameters.src}delete this.parameters.a}},downloaderLogined:function(e,t,n){this.info.downloaderList[n].logined=!0,this.info.downloaderList[n].clientVersion=t.clientVersion},refreshDownloaderList:function(e){this.defer("rGetDownloaderList"),this.dispatch("rGetDownloaderList")},updateTaskType:function(e){e!=this.info.currentTaskType&&(this.info.selectedTasks=[]);if(e=="rGoToPage")return;this.info.currentTaskType=e,this.info.currentTaskType=="rShowRecycledTasks"?($("#tasklist-toolbox [data-dispatch=popCreateTask]").hide(),$("#tasklist-toolbox [data-dispatch=rRestoreSelectedTasks]").show(),$("#tasklist-toolbox [data-dispatch=popClearRecycledTasks]").show()):($("#tasklist-toolbox [data-dispatch=popCreateTask]").show(),$("#tasklist-toolbox [data-dispatch=rRestoreSelectedTasks]").hide(),$("#tasklist-toolbox [data-dispatch=popClearRecycledTasks]").hide())},updateTaskList:function(e,t){var n=[];if(Helper.isArray(t))for(var r=0;r<t.length;r++){var i=t[r].id.toString();this.info.currentTaskList[i]?Helper.extend(this.info.currentTaskList[i],t[r]):this.info.currentTaskList[i]=t[r],n.push(i)}for(var s in this.info.currentTaskList)Helper.indexOf(n,s)==-1&&(delete this.info.currentTaskList[s],this.dispatch("rTaskDeselected",s))},updateSelectedTasks:function(e){for(var t in this.info.currentTaskList)Helper.indexOf(this.info.selectedTasks,t)==-1&&this.dispatch("rTaskDeselected",t)},taskSelected:function(e,t){var n=Helper.indexOf(this.info.selectedTasks,t);n==-1&&this.info.selectedTasks.push(t)},taskDeselected:function(e,t){var n=Helper.indexOf(this.info.selectedTasks,t);n!=-1&&Helper.removeAt(this.info.selectedTasks,n)},getPassed:function(e){var t=Helper.getCookie("yc_acpl");return t?(t=Helper.jsonDecode(t),!!t[e]):!1},setPassed:function(e){var t=Helper.getCookie("yc_acpl");return t||(t={}),t[e]=1,Helper.setCookie("yc_acpl",Helper.jsonEncode(t)),!0},resetPassed:function(){Helper.setCookie("yc_acpl",null)}}),e.Module=function(){function e(e,t){this.name=e,Helper.extend(this,t),Helper.inherit(this,Helper.Dispatcher)}return Helper.extend(e.prototype,{init:function(){}}),e}(),new e}()
XRD.attach("Page",{init:function(){this.binding=!1,XRD.on("showBgMask",this.showBgMask,this),XRD.on("hideBgMask",this.hideBgMask,this),XRD.on("message",this.message,this),XRD.on("messageClose",this.messageClose,this),XRD.on("rDownloaderList",this.checkDownloaderList,this),XRD.on("rDownloaderAdded",this.downloaderAdded,this),XRD.on("rDownloaderAddFailed",this.downloaderAddFailed,this),XRD.on("pageBindDownloader",this.bindDownloader,this),XRD.on("layboxAddDragEvent",this.layboxAddDrayEvent,this),XRD.on("layboxStopDragEvent",this.layboxStopDrayEvent,this),$("a, button").live("click",function(){$(this).data("dispatch")&&!+$(this).data("disabled")&&XRD.dispatch($(this).data("dispatch"),$(this).attr("data-data"))}),$(".layer_box .layer_head").mousedown(function(e){return XRD.dispatch("layboxAddDragEvent",$(this).parent().parent(),e),!1}),$(document).mouseup(function(){XRD.dispatch("layboxStopDragEvent")}),$("#username").html(XRD.info.usernick),XRD.info.uservip?$("#rightop-vip").children().hide().eq(0).show():$("#rightop-vip").children().hide().eq(1).show(),$(window).resize(function(){$("#body, #no-downloaders").height($(window).height()-$("#header").height())}),$("#body, #no-downloaders").height($(window).height()-$("#header").height());var e=this;$("#no-downloaders-tab-title").children().click(function(){if(e.binding)return;$(this).addClass("on").siblings().removeClass("on"),$("#no-downloaders-tab-content").children().hide().eq($(this).index()).show(),$("#no-downloaders [data-field=hint]").html("")}),$("#no-downloaders-done").click(function(){e.noDownloaders||($("#no-downloaders").hide(),$("#body").show())}),$("#no-downloaders input[data-field]").click(function(){$("#no-downloaders [data-field=hint]").html("")}),$("#no-downloaders input[data-field]").keyup(function(){$("#no-downloaders [data-field=hint]").html("")})},layboxAddDrayEvent:function(e,t,n){var r=n.target.tagName.toLowerCase();if(r=="a"||r=="button")return;$(".layer_box").css("cursor","move"),$("#top-layer-box").show();var i=t.offset(),s=n.pageX-i.left,o=n.pageY-i.top,u=document.documentElement.clientWidth-t.width(),a=document.documentElement.clientHeight-t.height();$(document).bind("mousemove",function(e){$(".layer_box").stop();var n=e.pageX-s,r=e.pageY-o;n=n>u?u:n,r=r>a?a:r,n=n>0?n:0,r=r>0?r:0,t.animate({left:n+"px",top:r+"px",marginLeft:"0px",marginTop:"0px"},10)})},layboxStopDrayEvent:function(){$(".layer_box").css("cursor","default"),$("#top-layer-box").hide(),$(document).unbind("mousemove")},showBgMask:function(){$("#bg-mask").show()},hideBgMask:function(){$("#bg-mask").hide()},message:function(e,t,n){var r={sticky:!1,glue:"before",position:"bottom-right",theme:"yuancheng",corners:"22px",check:1e3,life:3e3,speed:"fast",closer:!0,header:undefined,open:function(){$("#jGrowl").css({bottom:"30px",right:"15px"})}};if(n&&typeof n=="object"){var i="";for(i in r)r.hasOwnProperty(i)&&(n[i]||(n[i]=r[i]))}else n=null,n=r;$.jGrowl.defaults.closerTemplate='<div class="close-all" title="关闭这些通知">关闭这些通知</div>',$("#jGrowl").show(),$.jGrowl(t,n)},messageClose:function(){$("#jGrowl").hide()},checkDownloaderList:function(e,t){var n=$("#no-downloaders-tab-title > .on").index();t.length==0?(this.noDownloaders=!0,$("#no-downloaders-done").addClass("yc_fm_linkgrey"),$("#no-downloaders").show(),$("#body").hide()):(this.noDownloaders=!1,$("#no-downloaders-done").removeClass("yc_fm_linkgrey"),n>0&&($("#no-downloaders").hide(),$("#body").show()))},bindDownloader:function(e){var t=$("#no-downloaders-tab-title > .on").index(),n="";switch(t){case 0:break;case 1:n=$("#no-downloaders input[data-field=key1]").val();break;case 2:n=$("#no-downloaders input[data-field=key2]").val();break;case 3:n=$("#no-downloaders input[data-field=key3]").val()}if(n.length==0){$("#no-downloaders [data-field=hint]").html("请输入激活码");return}if(n.length<6){$("#no-downloaders [data-field=hint]").html("激活码长度为6位或10位");return}if(!/^[0-9a-zA-Z\:@#\$]+$/.test(n)){$("#no-downloaders [data-field=hint]").html("激活码字符有误");return}this.binding=!0,$("#no-downloaders [data-field=hint]").html("正在绑定……"),XRD.dispatch("rAddDownloader",n)},downloaderAdded:function(e){this.binding=!1,$("#no-downloaders").hide(),$("#no-downloaders input[data-field]").val(""),$("#no-downloaders [data-field=hint]").html(""),$("#body").show()},downloaderAddFailed:function(e,t){this.binding=!1,t==62?$("#no-downloaders [data-field=hint]").html("绑定超过最大值"):t==63?$("#no-downloaders [data-field=hint]").html("绑定失败，已经绑定到其它用户"):t==106?$("#no-downloaders [data-field=hint]").html("绑定失败，请重新进入电视激活码界面获取激活码"):$("#no-downloaders [data-field=hint]").html("绑定失败，请重新输入")}})
XRD.attach("SideBar",{init:function(){XRD.on("heartbeat",this.heartbeatDownloaderList,this),XRD.on("rDownloaderList",this.showDownloaderList,this),XRD.on("rClickDownloader",this.clickDownloader,this),XRD.on("rSelectDownloader",this.selectDownloader,this),XRD.on("rDownloaderTaskStat",this.updateTaskStat,this),XRD.on("rShowRunningTasks",this.openTaskList,this),XRD.on("rShowCompletedTasks",this.openTaskList,this),XRD.on("rShowRecycledTasks",this.openTaskList,this),XRD.on("rShowFailedTasks",this.openTaskList,this),XRD.on("showXiaoMiBoxTips",this.showXiaoMiBoxTips,this),XRD.on("closeXiaoMiBoxTips",this.closeXiaoMiBoxTips,this),XRD.on("rClickXiaoMiBoxTips",this.clickXiaoMiBoxTips,this),$("#sidebar [data-type=list-items] a").live("click",function(){$("#sidebar [data-type=list-items] a").removeClass("on"),$(this).addClass("on")}),$("#sidebar-downloader-list [data-type=label-items]").live("mouseover",function(){$(this).find("[data-type=button]").show(),XRD.dispatch("showXiaoMiBoxTips",this)}).live("mouseout",function(){$(this).parent().data("pid")!=XRD.info.currentDownloader&&$(this).find("[data-type=button]").hide()}),$("#sidebar-downloader-list").mouseleave(function(){XRD.dispatch("closeXiaoMiBoxTips",this)})},showXiaoMiBoxTips:function(e,t){var n=Helper.getCookie("clickXiaomiBoxTip");if(n&&n=="checked")return;var r=XRD.info.downloaderList[$(t).parent().data("pid")];if(r.online||!r.company||r.company!="小米盒子"&&r.company!="多看")return;var i=$("#sidebar-downloader-list").find($(".xiaomibox_tip"));i.length<1&&$(t).after('<a class="xiaomibox_tip" href="xiaomi_help.html" target="_blank" data-dispatch="rClickXiaoMiBoxTips"><i class="xiaomibox_tip_i"></i>为什么我的盒子显示不在线?</a>')},closeXiaoMiBoxTips:function(e,t){$(this).find($(".xiaomibox_tip")).remove()},clickXiaoMiBoxTips:function(e){Helper.setCookie("clickXiaomiBoxTip","checked",{path:"/",expires:3600,domain:"xunlei.com"})},heartbeatDownloaderList:function(e,t){XRD.decay("rGetDownloaderList",XRD.config.downloaderListPeriod)&&XRD.dispatch("rGetDownloaderList")},showDownloaderList:function(e,t){if(Helper.isArray(t)&&t.length>0){$("#sidebar-downloader-list, #sidebar-addon-list").show(),$("#sidebar-downloader-list").children().remove(),$("#tasklist-list, #tasklist-footer").show(),$("#no-downloader").hide();var n=[];t.sort(function(e,t){return t.lastLoginTime-e.lastLoginTime});for(var r=0;r<t.length;r++){n.push(t[r].pid);var i=t[r].online?"t_tool_on":"t_tool_off",s=t[r].online?'<a class="oico ico_set" href="#" title="设置" data-type="button" data-dispatch="popConfigDownloader" data-data="'+t[r].pid+'">设置</a>':"",o=$('<div data-type="downloader-item" data-pid="'+t[r].pid+'" data-name="'+t[r].name+'" data-type="'+t[r].type+'" data-online="'+t[r].online+'">'+'<h2 class="t_tool '+i+'" data-type="label-items">'+'<a class="lk_tool" href="#" data-field="name" data-dispatch="rClickDownloader" data-data="'+t[r].pid+'" title="'+t[r].name+'">'+t[r].name+"</a>"+s+'<a class="oico ico_edit" href="#" title="编辑" data-type="button" data-dispatch="popRenameDownloader" data-data="'+t[r].pid+'">编辑</a>'+'<a class="oico ico_del" href="#" title="删除" data-type="button" data-dispatch="popRemoveDownloader" data-data="'+t[r].pid+'">删除</a>'+"</h2>"+'<ul class="subnav" data-type="list-items" style="display:none;">'+'<li><a href="#" data-dispatch="rShowRunningTasks" data-data="'+t[r].pid+'"><span class="list_down" data-dname="'+t[r].name+'">正在下载(<em style="font-style:normal" data-field="running">'+Helper.toNumber(XRD.info.downloaderList[t[r].pid].runningCount)+"</em>)</span></a></li>"+'<li><a href="#" data-dispatch="rShowCompletedTasks" data-data="'+t[r].pid+'"><span class="list_downed" data-dname="'+t[r].name+'">已完成(<em style="font-style:normal" data-field="completed">'+Helper.toNumber(XRD.info.downloaderList[t[r].pid].completedCount)+"</em>)</span></a></li>"+'<li><a href="#" data-dispatch="rShowRecycledTasks" data-data="'+t[r].pid+'"><span class="list_rubish" data-dname="'+t[r].name+'">垃圾箱(<em style="font-style:normal" data-field="recycled">'+Helper.toNumber(XRD.info.downloaderList[t[r].pid].recycledCount)+"</em>)</span></a></li>"+'<li><a href="#" data-dispatch="rShowFailedTasks" data-data="'+t[r].pid+'"><span class="list_lost" data-dname="'+t[r].name+'">提交失败(<em style="font-style:normal" data-field="failed">'+Helper.toNumber(XRD.info.downloaderList[t[r].pid].failedCount)+"</em>)</span></a></li>"+"</ul>"+"</div>");o.find("[data-type=button]").hide(),t[r].online?r>0&&$("#sidebar-downloader-list [data-online=1]").size()>0?$("#sidebar-downloader-list [data-online=1]:last").after(o):$("#sidebar-downloader-list").prepend(o):$("#sidebar-downloader-list").append(o)}if(XRD.info.currentDownloader&&$("#sidebar-downloader-list [data-pid="+XRD.info.currentDownloader+"]").size()>0)XRD.dispatch("rSelectDownloader",XRD.info.currentDownloader);else{var u=$("#sidebar-downloader-list [data-pid]:first").data("pid");XRD.info.currentModule=="tasklist"&&(!XRD.info.downloaderList[u].accesscode||!XRD.info.accessCodePopped)&&XRD.dispatch("rClickDownloader",u)}}else $("#sidebar-downloader-list, #sidebar-addon-list").hide(),$("#tasklist-list, #tasklist-footer").hide(),$("#no-downloader").show(),XRD.info.currentDownloader=="",XRD.dispatch("open","tasklist")},clickDownloader:function(e,t){XRD.info.currentTaskType="",XRD.info.downloaderList[t].accesscode&&!XRD.getPassed(t)?XRD.dispatch("popAccessCode",t,function(){XRD.dispatch("rClickDownloader",t)}):(XRD.dispatch("open","tasklist"),XRD.dispatch("rSelectDownloader",t,!0))},selectDownloader:function(e,t,n){var r=$("#sidebar-downloader-list").children("[data-pid="+t+"]");r.size()>0&&($("#sidebar-downloader-list [data-type=button]").hide(),$("#sidebar-downloader-list [data-type=list-items]").hide(),$("#sidebar-addon-list [data-type=list-items] a").removeClass("on"),r.find("[data-type=label-items]").find("[data-type=button]").show(),r.find("[data-type=list-items]").show().find("a").removeClass("on"),XRD.info.currentModule=="tasklist"?r.find("[data-type=list-items] a[data-dispatch="+XRD.info.currentTaskType+"]").size()>0?r.find("[data-type=list-items] a[data-dispatch="+XRD.info.currentTaskType+"]").addClass("on"):r.find("[data-type=list-items] a:first").addClass("on"):$("#sidebar-addon-list a[data-data="+XRD.info.currentModule+"]").addClass("on"),XRD.dispatch("rDownloaderSelected",t,n))},updateTaskStat:function(e,t){var n=$("#sidebar-downloader-list [data-pid="+XRD.info.currentDownloader+"]");n.find("[data-field=running]").html(t.runningCount),n.find("[data-field=completed]").html(t.completedCount),n.find("[data-field=recycled]").html(t.recycledCount),n.find("[data-field=failed]").html(t.failedCount)},openTaskList:function(e){var t=$("#sidebar-downloader-list [data-pid="+XRD.info.currentDownloader+"]");t.find("a").removeClass("on"),t.find("a[data-dispatch="+e+"]").addClass("on"),XRD.dispatch("open","tasklist")}})
XRD.attach("TaskList",{init:function(){this.currentListType=Protocol.LIST_TYPE_ALL_TASKS,this.currentListMessage="rShowRunningTasks",this.showPages=5,this.totalCount=0,this.pageSize=8,this.currentPage=1,this.vipChannelTasks=[],this.lixianChannelTasks=[],this.taskIconClasses={},this.vodServer={},this.vodBTServer={},this.taskIconClasses[Protocol.LIST_TASK_STATE_DOWNLOADING]="rwicdown",this.taskIconClasses[Protocol.LIST_TASK_STATE_WAITING]="rwictime",this.taskIconClasses[Protocol.LIST_TASK_STATE_STOPPED]="rwicpause",this.taskIconClasses[Protocol.LIST_TASK_STATE_PAUSED]="rwicpause",this.taskIconClasses[Protocol.LIST_TASK_STATE_COMPLETED]="rwicok",this.taskIconClasses[Protocol.LIST_TASK_STATE_FAILED]="rwicwrong",this.taskIconClasses[Protocol.LIST_TASK_STATE_UPLOADING]="rwicup",this.taskIconClasses[Protocol.LIST_TASK_STATE_PREDOWNLOAD]="rwictime",this.taskIconClasses[Protocol.LIST_TASK_STATE_DELETED]="rwicwrong",this.taskIconClasses[Protocol.LIST_TASK_STATE_RECYCLED]="rwicwrong",this.taskIconClasses[Protocol.LIST_TASK_STATE_PENDING]="rwictime",this.taskIconClasses[Protocol.LIST_TASK_STATE_ERROR]="rwicwrong",XRD.on("start",this.start,this),XRD.on("heartbeat",this.heartbeatTaskList,this),XRD.on("open",this.open,this),XRD.on("contextMenu",this.contextMenu,this),XRD.on("closeFloating",this.closeFloating,this),XRD.on("rClickItem",this.clickItem,this),XRD.on("rSelectItem",this.selectItem,this),XRD.on("rDeselectItem",this.deselectItem,this),XRD.on("rSelectAll",this.selectAll,this),XRD.on("rDeselectAll",this.deselectAll,this),XRD.on("rSelectInverse",this.selectInverse,this),XRD.on("rConfirmRemoveTasks",this.removeTasks,this),XRD.on("rRefreshTaskList",this.loadTaskList,this),XRD.on("rGoToPage",this.loadTaskList,this),XRD.on("rDownloaderTaskStat",this.updateTaskCount,this),XRD.on("rShowRunningTasks",this.loadTaskList,this),XRD.on("rShowCompletedTasks",this.loadTaskList,this),XRD.on("rShowRecycledTasks",this.loadTaskList,this),XRD.on("rShowFailedTasks",this.loadTaskList,this),XRD.on("rStartSelectedTasks",this.startSelectedTasks,this),XRD.on("rPauseSelectedTasks",this.pauseSelectedTasks,this),XRD.on("rRemoveSelectedTasks",this.removeSelectedTasks,this),XRD.on("rRestoreSelectedTasks",this.restoreSelectedTasks,this),XRD.on("rActiveSelectedVipChannel",this.activeSelectedVipChannel,this),XRD.on("rActiveSelectedLixianChannel",this.activeSelectedLixianChannel,this),XRD.on("rPlaySelectedTasks",this.playSelectedTasks,this),XRD.on("rTaskList",this.viewTaskList,this),XRD.on("rTaskCreated",this.loadTaskList,this),XRD.on("rTaskStarted",this.loadTaskList,this),XRD.on("rTaskPaused",this.loadTaskList,this),XRD.on("rTaskRemoved",this.loadTaskList,this),XRD.on("rTaskRecycled",this.loadTaskList,this),XRD.on("rTaskRestored",this.loadTaskList,this),XRD.on("rActiveVipChannel",this.updateVipChannelState,this),XRD.on("rActiveLixianChannel",this.updateLixianChannelState,this),XRD.on("rVipChannelActived",this.loadTaskList,this),XRD.on("rLixianChannelActived",this.loadTaskList,this),XRD.on("rVipChannelFailed",this.loadTaskList,this),XRD.on("rLixianChannelFailed",this.loadTaskList,this),XRD.on("rTaskCreateFailed",this.taskFailed,this),XRD.on("rClickXiaoMiBoxTips2",this.clickXiaoMiBoxTips2,this),XRD.on("popPlaylistClose",this.popPlaylistClose,this),XRD.on("popPlaylistPlay",this.popPlaylistPlay,this);var e=this;$("#tasklist-body").data("op-height",$("#header").height()+$("#tasklist-toolbox").height()+$("#tasklist-header").height()+$("#tasklist-footer").height()),$("#tasklist-body").height($(window).height()-$("#tasklist-body").data("op-height")),$(window).resize(function(){$("#tasklist-body").height($(window).height()-$("#tasklist-body").data("op-height"))}),$("#tasklist-body [data-task-id]").live("click",function(t){e.vodServer[XRD.info.currentDownloader]===!1&&(e.vodServer[XRD.info.currentDownloader]=undefined),e.vodBTServer[XRD.info.currentDownloader]===!1&&(e.vodBTServer[XRD.info.currentDownloader]=undefined),XRD.dispatch("rClickItem",$(this).attr("data-task-id"),t.target.tagName.toLowerCase())}),$("#tasklist-select-all").click(function(){$(this).attr("checked")?XRD.dispatch("rSelectAll"):XRD.dispatch("rDeselectAll")}),$("#pop-paylist-select-all").click(function(){$("#pop-playlist-bt-sublist input[type=checkbox]").attr("checked",!0)}),$("#pop-paylist-select-inverse").click(function(){$("#pop-playlist-bt-sublist input[type=checkbox]").each(function(e){$(this).attr("checked")?$(this).removeAttr("checked"):$(this).attr("checked",!0)})})},refreshToolbox:function(){var e=XRD.info.currentTaskList,t=XRD.info.selectedTasks;if(t.length>0){var n=null,r=!1,i=!1,s=!1;for(var o=0;o<t.length;o++)n=e[t[o]],r=r||n.state==Protocol.LIST_TASK_STATE_PAUSED||n.state==Protocol.LIST_TASK_STATE_STOPPED||n.state==Protocol.LIST_TASK_STATE_FAILED,i=i||n.state==Protocol.LIST_TASK_STATE_DOWNLOADING||n.state==Protocol.LIST_TASK_STATE_WAITING,s=s||n.state==Protocol.LIST_TASK_STATE_DOWNLOADING;this.currentListType==Protocol.LIST_TYPE_RECYCLED_TASKS&&(r=!1,i=!1,s=!1),$("#tasklist-toolbox [data-dispatch=rStartSelectedTasks]").toggleClass("fbd",!r),$("#tasklist-toolbox [data-dispatch=rPauseSelectedTasks]").toggleClass("fbd",!i),$("#tasklist-toolbox [data-dispatch=rRemoveSelectedTasks]").removeClass("fbd"),$("#tasklist-toolbox [data-dispatch=rActiveSelectedVipChannel]").toggleClass("fbd",!s),$("#tasklist-toolbox [data-dispatch=rActiveSelectedLixianChannel]").toggleClass("fbd",!s),$("#tasklist-toolbox [data-dispatch=rActiveSelectedLixianChannel]").toggleClass("fbd",!s),r?$("#tasklist-toolbox [data-dispatch=rStartSelectedTasks]").data("disabled","0"):$("#tasklist-toolbox [data-dispatch=rStartSelectedTasks]").data("disabled","1"),i?$("#tasklist-toolbox [data-dispatch=rPauseSelectedTasks]").data("disabled","0"):$("#tasklist-toolbox [data-dispatch=rPauseSelectedTasks]").data("disabled","1"),$("#tasklist-toolbox [data-dispatch=rRemoveSelectedTasks]").data("disabled","0"),s?($("#tasklist-toolbox [data-dispatch=rActiveSelectedVipChannel]").data("disabled","0"),$("#tasklist-toolbox [data-dispatch=rActiveSelectedLixianChannel]").data("disabled","0")):($("#tasklist-toolbox [data-dispatch=rActiveSelectedVipChannel]").data("disabled","1"),$("#tasklist-toolbox [data-dispatch=rActiveSelectedLixianChannel]").data("disabled","1")),$("#tasklist-contextmenu-selection [data-dispatch=rStartSelectedTasks]").parent().toggle(r),$("#tasklist-contextmenu-selection [data-dispatch=rPauseSelectedTasks]").parent().toggle(i),$("#tasklist-contextmenu-selection [data-dispatch=rRemoveSelectedTasks]").parent().show(),$("#tasklist-contextmenu-selection [data-dispatch=popPropertyOpen]").parent().toggle(t.length===1),$("#tasklist-contextmenu-selection [data-dispatch=rPlaySelectedTasks]").parent().toggle(!1),$("#tasklist-toolbox [data-dispatch=rRestoreSelectedTasks]").toggleClass("fbd",this.currentListType!=Protocol.LIST_TYPE_RECYCLED_TASKS),$("#tasklist-contextmenu-selection [data-dispatch=rRestoreSelectedTasks]").parent().toggle(this.currentListType==Protocol.LIST_TYPE_RECYCLED_TASKS),$("#tasklist-toolbox [data-dispatch=rPlaySelectedTasks]").hide(),$("#tasklist-toolbox [data-dispatch=rPlaySelectedTasks]").addClass("fbd"),$("#tasklist-toolbox [data-dispatch=rPlaySelectedTasks]").data("disabled","1"),this.prePlayTasksCheck()}else $("#tasklist-toolbox [data-dispatch=rStartSelectedTasks]").addClass("fbd"),$("#tasklist-toolbox [data-dispatch=rPauseSelectedTasks]").addClass("fbd"),$("#tasklist-toolbox [data-dispatch=rRemoveSelectedTasks]").addClass("fbd"),$("#tasklist-toolbox [data-dispatch=rActiveSelectedVipChannel]").addClass("fbd"),$("#tasklist-toolbox [data-dispatch=rActiveSelectedLixianChannel]").addClass("fbd"),$("#tasklist-toolbox [data-dispatch=rStartSelectedTasks]").data("disabled","1"),$("#tasklist-toolbox [data-dispatch=rPauseSelectedTasks]").data("disabled","1"),$("#tasklist-toolbox [data-dispatch=rRemoveSelectedTasks]").data("disabled","1"),$("#tasklist-toolbox [data-dispatch=rActiveSelectedVipChannel]").data("disabled","1"),$("#tasklist-toolbox [data-dispatch=rActiveSelectedLixianChannel]").data("disabled","1"),$("#tasklist-contextmenu-selection [data-dispatch=rPlaySelectedTasks]").parent().hide(),$("#tasklist-contextmenu-selection [data-dispatch=rStartSelectedTasks]").parent().hide(),$("#tasklist-contextmenu-selection [data-dispatch=rPauseSelectedTasks]").parent().hide(),$("#tasklist-contextmenu-selection [data-dispatch=rRemoveSelectedTasks]").parent().hide(),$("#tasklist-contextmenu-selection [data-dispatch=popPropertyOpen]").parent().hide(),$("#tasklist-toolbox [data-dispatch=rRestoreSelectedTasks]").addClass("fbd"),$("#tasklist-contextmenu-selection [data-dispatch=rRestoreSelectedTasks]").parent().hide(),$("#tasklist-toolbox [data-dispatch=rPlaySelectedTasks]").hide(),$("#tasklist-toolbox [data-dispatch=rPlaySelectedTasks]").addClass("fbd"),$("#tasklist-toolbox [data-dispatch=rPlaySelectedTasks]").data("disabled","1");$("#tasklist-body [data-task-id] input[type=checkbox]:checked").size()==$("#tasklist-body [data-task-id] input[type=checkbox]").size()&&$("#tasklist-body [data-task-id] input[type=checkbox]").size()>0?$("#tasklist-select-all").attr("checked",!0):$("#tasklist-select-all").removeAttr("checked")},start:function(e,t){if(XRD.parameters.module&&XRD.parameters.module=="task")switch(XRD.parameters.type){case"0":this.currentListMessage="rShowRunningTasks",this.currentListType=0;break;case"1":this.currentListMessage="rShowCompletedTasks",this.currentListType=1;break;case"2":this.currentListMessage="rShowRecycledTasks",this.currentListType=2;break;case"3":this.currentListMessage="rShowFailedTasks",this.currentListType=3;break;default:}},open:function(e,t){t=="tasklist"?$("#tasklist").show():$("#tasklist").hide()},heartbeatTaskList:function(e,t){if(XRD.info.currentModule=="tasklist"&&XRD.info.currentDownloader&&XRD.info.downloaderList[XRD.info.currentDownloader]){if(XRD.info.downloaderList[XRD.info.currentDownloader].online&&!XRD.info.downloaderList[XRD.info.currentDownloader].logined)return;XRD.decay("rGetTaskList",XRD.config.taskListPeriod)&&this.loadTaskList(e)}},contextMenu:function(e,t){var n=$(t.target);if(n.attr("id")=="tasklist-body"||n.parents("[id=tasklist-body]").size()>0){n.parents("[data-task-id]").size()>0&&(n=n.parents("[data-task-id]").eq(0));var r=n.attr("data-task-id");if(r){XRD.dispatch("rSelectItem",r);var i=$("#tasklist-contextmenu-selection").height()+12;i+t.clientY>$(window).height()?$("#tasklist-contextmenu-selection").css("top",t.clientY-i+"px").css("left",t.clientX+"px"):$("#tasklist-contextmenu-selection").css("top",t.clientY+"px").css("left",t.clientX+"px"),$("#tasklist-contextmenu-selection").show(),$("#tasklist-contextmenu-blank").hide()}else{var i=$("#tasklist-contextmenu-blank").height()+12;i+t.clientY>$(window).height()?$("#tasklist-contextmenu-blank").css("top",t.clientY-i+"px").css("left",t.clientX+"px"):$("#tasklist-contextmenu-blank").css("top",t.clientY+"px").css("left",t.clientX+"px"),$("#tasklist-contextmenu-blank").show(),$("#tasklist-contextmenu-selection").hide()}return Helper.cancelBubble(t),!1}if(XRD.info.inXL)return Helper.cancelBubble(t),!1},closeFloating:function(e,t){$("#tasklist-contextmenu-selection").hide(),$("#tasklist-contextmenu-blank").hide()},clickItem:function(e,t,n){var r=$("#tasklist-task-item-"+t),i=$("#tasklist-task-item-checkbox-"+t);n!="input"&&(i.attr("checked")?i.removeAttr("checked"):i.attr("checked",!0)),i.attr("checked")?(XRD.dispatch("rTaskSelected",t),r.addClass("hover")):(XRD.dispatch("rTaskDeselected",t),r.removeClass("hover")),this.refreshToolbox()},selectItem:function(e,t){var n=$("#tasklist-task-item-checkbox-"+t);n.attr("checked")||XRD.dispatch("rClickItem",t)},deselectItem:function(e,t){var n=$("#tasklist-task-item-checkbox-"+t);n.attr("checked")&&XRD.dispatch("rClickItem",t)},selectAll:function(e){$("#tasklist-body").children().each(function(e){XRD.dispatch("rSelectItem",$(this).attr("data-task-id"))})},deselectAll:function(e){$("#tasklist-body").children().each(function(e){XRD.dispatch("rDeselectItem",$(this).attr("data-task-id"))})},selectInverse:function(e){$("#tasklist-body").children().each(function(e){XRD.dispatch("rClickItem",$(this).attr("data-task-id"))})},startSelectedTasks:function(e){XRD.info.downloaderList[XRD.info.currentDownloader].online?XRD.info.downloaderList[XRD.info.currentDownloader].storage?XRD.info.selectedTasks.length>0&&(XRD.dispatch("message","正在开启所选任务……"),XRD.dispatch("rStartTasks",XRD.info.selectedTasks)):XRD.dispatch("popHintNoStorage"):XRD.dispatch("popHintOffline")},pauseSelectedTasks:function(e){XRD.info.downloaderList[XRD.info.currentDownloader].online?XRD.info.downloaderList[XRD.info.currentDownloader].storage?XRD.info.selectedTasks.length>0&&(XRD.dispatch("message","正在暂停所选任务……"),XRD.dispatch("rPauseTasks",XRD.info.selectedTasks)):XRD.dispatch("popHintNoStorage"):XRD.dispatch("popHintOffline")},removeSelectedTasks:function(e){XRD.info.downloaderList[XRD.info.currentDownloader].online?XRD.info.downloaderList[XRD.info.currentDownloader].storage?XRD.info.selectedTasks.length>0&&XRD.dispatch("popRemoveTask",XRD.info.selectedTasks):XRD.dispatch("popHintNoStorage"):XRD.dispatch("popHintOffline")},restoreSelectedTasks:function(e){XRD.info.downloaderList[XRD.info.currentDownloader].online?XRD.info.downloaderList[XRD.info.currentDownloader].storage?XRD.info.selectedTasks.length>0&&(XRD.dispatch("message","正在还原所选任务……"),XRD.dispatch("rRestoreTasks",XRD.info.selectedTasks)):XRD.dispatch("popHintNoStorage"):XRD.dispatch("popHintOffline")},removeTasks:function(e,t){var n=t.taskIds,r=t.deleteFiles;XRD.dispatch("rRemoveTasks",n,r)},activeSelectedVipChannel:function(e){XRD.info.downloaderList[XRD.info.currentDownloader].online?XRD.info.downloaderList[XRD.info.currentDownloader].storage?XRD.info.uservip<1?XRD.dispatch("popVipOpen"):XRD.info.selectedTasks.length>0&&(XRD.dispatch("message","正在开启所选任务的高速通道……"),XRD.dispatch("rActiveVipChannel",XRD.info.selectedTasks)):XRD.dispatch("popHintNoStorage"):XRD.dispatch("popHintOffline")},activeSelectedLixianChannel:function(e){XRD.info.downloaderList[XRD.info.currentDownloader].online?XRD.info.downloaderList[XRD.info.currentDownloader].storage?XRD.info.uservip<1?XRD.dispatch("popVipOpen"):XRD.info.selectedTasks.length>0&&(XRD.dispatch("message","正在开启所选任务的离线加速……"),XRD.dispatch("rActiveLixianChannel",XRD.info.selectedTasks)):XRD.dispatch("popHintNoStorage"):XRD.dispatch("popHintOffline")},prePlayTasksCheck:function(e){var t=XRD.info.downloaderList[XRD.info.currentDownloader],n=XRD.info.currentTaskList,r=XRD.info.selectedTasks,i=null;if(this.currentListType!=Protocol.LIST_TYPE_COMPLETED_TASKS)return!1;if(!t.online)return!1;if(!t.localIP)return!1;if(r.length>1)return!1;i=n[r[0]];if(i.type==Protocol.LIST_TASK_TYPE_BT){if(this.vodBTServer[XRD.info.currentDownloader]===!0)return $("#tasklist-contextmenu-selection [data-dispatch=rPlaySelectedTasks]").parent().toggle(!0),$("#tasklist-toolbox [data-dispatch=rPlaySelectedTasks]").removeClass("fbd").show(),$("#tasklist-toolbox [data-dispatch=rPlaySelectedTasks]").data("disabled","0"),!0}else{var s=Helper.getExtension(i.name);if(Helper.indexOf(VIDEO_EXTENSIONS,s)==-1)return!1;if(this.vodServer[XRD.info.currentDownloader]===!0)return $("#tasklist-contextmenu-selection [data-dispatch=rPlaySelectedTasks]").parent().toggle(!0),$("#tasklist-toolbox [data-dispatch=rPlaySelectedTasks]").removeClass("fbd").show(),$("#tasklist-toolbox [data-dispatch=rPlaySelectedTasks]").data("disabled","0"),!0}if(this.vodServer[XRD.info.currentDownloader]===undefined&&this.vodBTServer[XRD.info.currentDownloader]===undefined){var o=this;o.vodServer[XRD.info.currentDownloader]="checking",o.vodBTServer[XRD.info.currentDownloader]="checking",Protocol.checkVodPort(t.localIP,function(e){if(e.data.indexOf("etm")!=-1){o.vodServer[XRD.info.currentDownloader]=!0,e.data>"etm2.0"?o.vodBTServer[XRD.info.currentDownloader]=!0:o.vodBTServer[XRD.info.currentDownloader]=!1;if(XRD.info.currentTaskList[XRD.info.selectedTasks[0]].type!=Protocol.LIST_TASK_TYPE_BT||o.vodBTServer[XRD.info.currentDownloader]!==!1)$("#tasklist-contextmenu-selection [data-dispatch=rPlaySelectedTasks]").parent().toggle(!0),$("#tasklist-toolbox [data-dispatch=rPlaySelectedTasks]").removeClass("fbd").show(),$("#tasklist-toolbox [data-dispatch=rPlaySelectedTasks]").data("disabled","0")}else o.vodServer[XRD.info.currentDownloader]=!1,o.vodBTServer[XRD.info.currentDownloader]=!1},function(){o.vodServer[XRD.info.currentDownloader]=!1,o.vodBTServer[XRD.info.currentDownloader]=!1})}},playSelectedTasks:function(e){var t=XRD.info.downloaderList[XRD.info.currentDownloader],n=XRD.info.currentTaskList,r=XRD.info.selectedTasks,i=null;if(!t.online)XRD.dispatch("popHintOffline");else if(!t.storage)XRD.dispatch("popHintNoStorage");else if(r.length>0){if(this.vodLoading)return;this.vodLoading=!0;if(!t.localIP){XRD.dispatch("popHint","点播功能只能在同一个局域网内使用"),this.vodLoading=!1;return}if(!r.length>1){XRD.dispatch("popHint","点播功能只支持单个任务"),this.vodLoading=!1;return}this.analysePlayableTasks(!0,XRD.info.selectedTasks[0])}},analysePlayableTasks:function(e,t){var n=this,r=XRD.info.downloaderList[XRD.info.currentDownloader],i=XRD.info.currentTaskList[t];if(!i)return this.resetVodData();if(e===!0){var s=Helper.getExtension(i.name);if(i.type==Protocol.LIST_TASK_TYPE_BT){XRD.dispatch("message","正在获取播放列表……"),Protocol.getBtSubList(XRD.info.currentDownloader,t,function(e){n.analysePlayableTasks(e,t)},function(){n.vodShowBTError()});return}if(Helper.indexOf(VIDEO_EXTENSIONS,s)==-1)return XRD.dispatch("popHint","您选中的任务中含有不可播放的文件，请重新选择"),this.resetVodData();this.vodTaskIdData.push(t),this.vodTaskNameData.push(i.name),Protocol.getVodUrls(r.localIP,this.vodTaskIdData,function(e){n.getVodUrlsCallback(e)},function(e){n.vodShowUrlError(e)})}else if(e&&e.rtn==0){var o=e.taskInfo.subList,u=null,a=[],f=[];for(var l=0;l<o.length;l++)u=Helper.getExtension(o[l].name),o[l].selected&&Helper.indexOf(VIDEO_EXTENSIONS,u)!=-1&&f.push(o[l]);this.vodTaskIdData.push(t);var c=f.length;c<=0?(this.resetVodData(),XRD.dispatch("popHint","沒有可以播放的文件！")):c==1?(this.vodTaskNameData.push(f[0].name),Protocol.getVodUrls(r.localIP,this.vodTaskIdData,function(e){n.getVodUrlsCallback(e)},function(e){n.vodShowUrlError(e)})):this.popPlayListOpen(f,t)}else this.vodShowBTError()},popPlayListOpen:function(e,t){var n=XRD.info.currentTaskList[t];XRD.dispatch("showBgMask"),$("#taskPlaylistName").html(n.name).attr("title",n.name),$("#taskPlaylistSize").html(Helper.byte2Size(n.size,2)),$("#pop-playlist-width").removeClass("layer_widthsmall").addClass("layer_width"),$("#pop-playlist-bt-sublist").html(""),$("#pop-playlist").show();var r="",i="",s="",o=e.length;for(var u=0;u<o;u++){var a=e[u];s=a.name,i=s.substr(s.lastIndexOf(".")),s.lastIndexOf("/")!=-1&&(s=s.substr(s.lastIndexOf("/")+1)),u%2?r+='<div class="pop_list_unit pop_list_bggr"><span class="pop_sp_name"><input class="pop_list_check" type="checkbox" checked data-name="'+a.name+'" />'+'<p class="pop_sp_filename"  title="'+s+'">'+s+'</p></span><span class="pop_sp_size">'+Helper.byte2Size(a.size,2)+'</span><span class="pop_sp_type">'+a.progress/100+"%</span></div>":r+='<div class="pop_list_unit"><span class="pop_sp_name"><input class="pop_list_check" type="checkbox" checked data-name="'+a.name+'" />'+'<p class="pop_sp_filename" title="'+s+'">'+s+'</p></span><span class="pop_sp_size">'+Helper.byte2Size(a.size,2)+'</span><span class="pop_sp_type">'+a.progress/100+"%</span></div>"}$("#pop-playlist-bt-sublist").html(r)},popPlaylistPlay:function(){var e=this,t=XRD.info.downloaderList[XRD.info.currentDownloader];$("#pop-playlist-bt-sublist input[type=checkbox]").each(function(t){$(this).attr("checked")&&e.vodTaskNameData.push($(this).attr("data-name"))}),XRD.dispatch("hideBgMask"),$("#pop-playlist").hide();var n=this.vodTaskNameData.length;if(n<=0)return XRD.dispatch("popHint","没有可以播放的文件！"),this.resetVodData();Protocol.getVodUrls(t.localIP,e.vodTaskIdData,function(t){e.getVodUrlsCallback(t)},function(t){e.vodShowUrlError(t)})},popPlaylistClose:function(){XRD.dispatch("hideBgMask"),$("#pop-playlist").fadeOut("fast"),this.resetVodData()},getVodUrlsCallback:function(e){var t=XRD.info.downloaderList[XRD.info.currentDownloader],n=XRD.info.currentTaskList,r=XRD.info.selectedTasks,i=n[r[0]],s=t.localIP;if(i.type==Protocol.LIST_TASK_TYPE_BT){var o=new Array,u="http://"+s+":8002/"+e.path,a=this.vodTaskNameData.length;if(a<=0)return XRD.dispatch("popHint","没有可以播放的文件！"),this.resetVodData();for(var f=0;f<a;f++)o.push(u+this.vodTaskNameData[f])}else var o="http://"+s+":8002/"+e.path;var l=Protocol.XMPPlay(o,this.vodTaskNameData);this.resetVodData(),l||XRD.dispatch("popHint","未检测到迅雷看看播放器或版本过低，请先安装最新版迅雷看看播放器")},vodLoading:!1,vodTaskIdData:[],vodTaskNameData:[],vodShowBTError:function(){this.resetVodData(),XRD.dispatch("popHint","播放失败！获取BT子文件接口错误！")},vodShowUrlError:function(e){this.resetVodData(),e=="timeout"?XRD.dispatch("popHint","播放失败！获取播放URL超时，请稍候再试！"):XRD.dispatch("popHint","播放失败！获取播放URL接口错误！")},resetVodData:function(){this.vodLoading=!1,this.vodTaskIdData=[],this.vodTaskNameData=[]},updateVipChannelState:function(e,t){if(!Helper.isArray(t)&&t)var n=[t];else var n=Helper.cloneArray(t);for(var r=0;r<n.length;r++)this.vipChannelTasks.push(n[r]),$("#tasklist-task-item-"+n[r]+" [data-dispatch=rActiveVipChannel]").parent().remove()},updateLixianChannelState:function(e,t){if(!Helper.isArray(t)&&t)var n=[t];else var n=Helper.cloneArray(t);for(var r=0;r<n.length;r++)this.lixianChannelTasks.push(n[r]),$("#tasklist-task-item-"+n[r]+" [data-dispatch=rActiveLixianChannel]").parent().remove()},loadTaskList:function(e,t){if(!XRD.info.currentDownloader)return;this.currentPage>1&&Helper.size(XRD.info.currentTaskList)==0&&(this.currentPage-=1,t=this.currentPage);if(e!="heartbeat")if(e=="rGoToPage"){if(e==this.currentListMessage&&t==this.currentPage)return;this.currentListMessage=e,XRD.defer("rGetTaskList")}else if(e=="rRefreshTaskList")this.currentListMessage=="rGoToPage"&&(t=this.currentPage),t===!0?(e="rShowRunningTasks",this.currentListMessage=e):e=this.currentListMessage,XRD.defer("rGetTaskList");else if(e!=this.currentListMessage)this.currentListMessage=e,XRD.defer("rGetTaskList");else if(e==this.currentListMessage&&t!==!0)return;switch(e){case"rShowRunningTasks":this.currentListType=Protocol.LIST_TYPE_RUNNING_TASKS,this.currentPage=1;break;case"rShowCompletedTasks":this.currentListType=Protocol.LIST_TYPE_COMPLETED_TASKS,this.currentPage=1;break;case"rShowRecycledTasks":this.currentListType=Protocol.LIST_TYPE_RECYCLED_TASKS,this.currentPage=1;break;case"rShowFailedTasks":this.currentListType=Protocol.LIST_TYPE_FAILED_TASKS,this.currentPage=1;break;case"rGoToPage":this.currentPage=t}XRD.dispatch("rGetTaskList",{pid:XRD.info.currentDownloader,type:this.currentListType,offset:(this.currentPage-1)*this.pageSize,size:this.pageSize})},viewTaskList:function(e,t){$("#tasklist-body").html("");if(t.length>0){$("#tasklist-header, #tasklist-body, #tasklist-footer").show(),$("#tasklist-empty").hide();var n=!1,r=XRD.info.downloaderList[XRD.info.currentDownloader];for(var i=0;i<t.length;i++){var s=this.taskIconClasses[t[i].state],o="1",u=t[i].progress/100,a="",f="",l="",c="",h="";t[i].type==Protocol.LIST_TASK_TYPE_BT?o="2":t[i].type==Protocol.LIST_TASK_TYPE_EMULE?o="3":t[i].type==Protocol.LIST_TASK_TYPE_GENERAL&&(Helper.indexOf(VIDEO_EXTENSIONS,Helper.getExtension(t[i].name))!=-1?o="5":o="1");if(t[i].state==Protocol.LIST_TASK_STATE_DOWNLOADING||t[i].state==Protocol.LIST_TASK_STATE_PREDOWNLOAD||t[i].state==Protocol.LIST_TASK_STATE_WAITING){if(!n&&!r.online&&r.company&&(r.company=="小米盒子"||r.company=="多看")){var p=Helper.getCookie("clickXiaomiBoxTip2");p||(h='<a class="xiaomibox_tip2" href="xiaomi_help.html" target="_blank" data-dispatch="rClickXiaoMiBoxTips2"><i class="xiaomibox_tip_i"></i>下载任务没有进度？</a>',n=!0)}var d;if(t[i].remainTime>0){var v=Helper.parseTimestamp(t[i].remainTime);v[3]&&(v[2]=v[3]*24+v[2]),v[2]<1e4?d=Helper.sprintf("%02d:%02d:%02d",v[2],v[1],v[0]):d="--:--:--"}else d="--:--:--";t[i].state==Protocol.LIST_TASK_STATE_WAITING||t[i].state==Protocol.LIST_TASK_STATE_PREDOWNLOAD?(a="剩余时间：--:--:--",r.online?r.storage?f="下载排队中":f="等待插入外接存储设备":f="下载器不在线"):(a="剩余时间："+d,f=Helper.byte2Size(t[i].speed,2)+"/s")}else if(t[i].state==Protocol.LIST_TASK_STATE_COMPLETED)a="完成时间："+Helper.timestamp2Datetime(t[i].completeTime);else if(t[i].state==Protocol.LIST_TASK_STATE_FAILED||t[i].state==Protocol.LIST_TASK_STATE_ERROR)if(t[i].failCode!==Protocol.LIST_TASK_ERR_SUCCESS){var m=Protocol.MESSAGE_LIST_TASK_ERRORS[t[i].failCode];Helper.isString(m)?f=m+'<a href="/help.html#dt_12" target="_blank" style="color:#2270ca;">#'+t[i].failCode+"</a>":t[i].failCode>=106496&&t[i].failCode<=106516?f='磁盘异常<a href="/help.html#dt_12" target="_blank" style="color:#2270ca;">#'+t[i].failCode+"</a>":t[i].failCode>=106518&&t[i].failCode<=106522?f='磁盘异常<a href="/help.html#dt_12" target="_blank" style="color:#2270ca;">#'+t[i].failCode+"</a>":f='未知错误<a href="/help.html#dt_12" target="_blank" style="color:#2270ca;">#'+t[i].failCode+"</a>"}if(t[i].state==Protocol.LIST_TASK_STATE_DOWNLOADING){var g="",y="",b="",w="";u=u>=100?99.99:u;if(t[i].vipChannel.available)switch(t[i].vipChannel.opened){case Protocol.LIST_TASK_VIPCHANNEL_OPENED_NOTUSED:Helper.indexOf(this.vipChannelTasks,t[i].id)!=-1?g='<span class="spd_gaosu">正在提交高速通道加速请求……</span>':XRD.info.downloaderList[XRD.info.currentDownloader].online?XRD.info.downloaderList[XRD.info.currentDownloader].storage?XRD.info.uservip>0?b='<span class="tbtn btn_gaosu"><a href="#" data-dispatch="rActiveVipChannel" data-data="'+t[i].id+'">高速通道</a>'+"</span>":b='<span class="tbtn btn_gaosu"><a href="#" data-dispatch="popVipOpen">高速通道</a></span>':b='<span class="tbtn btn_gaosu"><a href="#" data-dispatch="popHintNoStorage">高速通道</a></span>':b='<span class="tbtn btn_gaosu"><a href="#" data-dispatch="popHintOffline">高速通道</a></span>';break;case Protocol.LIST_TASK_VIPCHANNEL_OPENED_SUBMITTING:g='<span class="spd_gaosu">正在提交高速通道加速请求……</span>';break;case Protocol.LIST_TASK_VIPCHANNEL_OPENED_ACTIVATED:g='<span class="spd_gaosu" title="高速通道">+'+Helper.byte2Size(t[i].vipChannel.speed,2)+"/s</span>";break;case Protocol.LIST_TASK_VIPCHANNEL_OPENED_FAILED:var E=t[i].vipChannel.failCode;if(E>23852)var S=Protocol.MESSAGE_LIST_TASK_VIPCHANNEL_ERRORS[E-23852];else if(E>23652)var S=Protocol.MESSAGE_LIST_TASK_VIPCHANNEL_ERRORS[E-23652];else var S=Protocol.MESSAGE_LIST_TASK_VIPCHANNEL_ERRORS[E];XRD.info.uservip>0?g='<span class="spd_gaosu c_hlight">高速通道失败'+(S?": "+S:"")+" #"+E+'<a href="#" data-dispatch="rActiveVipChannel" data-data="'+t[i].id+'"> 重试</a>'+"</span>":g='<span class="spd_gaosu c_hlight">高速通道失败'+(S?": "+S:"")+" #"+E+'<a href="#" data-dispatch="popVipOpen"> 重试</a>'+"</span>"}switch(t[i].lixianChannel.state){case Protocol.LIST_TASK_LIXIANCHANNEL_STATE_NOTUSED:Helper.indexOf(this.lixianChannelTasks,t[i].id)!=-1?y='<span class="spd_lixian">正在从云端建立离线任务……</span>':XRD.info.downloaderList[XRD.info.currentDownloader].online?XRD.info.downloaderList[XRD.info.currentDownloader].storage?XRD.info.uservip>0?w='<span class="tbtn btn_lixian"><a href="#" data-dispatch="rActiveLixianChannel" data-data="'+t[i].id+'">离线加速</a>'+"</span>":w='<span class="tbtn btn_lixian"><a href="#" data-dispatch="popVipOpen">离线加速</a></span>':w='<span class="tbtn btn_lixian"><a href="#" data-dispatch="popHintNoStorage">离线加速</a></span>':w='<span class="tbtn btn_lixian"><a href="#" data-dispatch="popHintOffline">离线加速</a></span>';break;case Protocol.LIST_TASK_LIXIANCHANNEL_STATE_SUBMITTING:y='<span class="spd_lixian">正在从云端建立离线任务……</span>';break;case Protocol.LIST_TASK_LIXIANCHANNEL_STATE_DOWNLOADING:y='<span class="spd_lixian">云端下载中 '+Helper.byte2Size(t[i].lixianChannel.serverSpeed,2)+"/s</span>";break;case Protocol.LIST_TASK_LIXIANCHANNEL_STATE_ACTIVATED:y='<span class="spd_lixian" title="离线加速">+'+Helper.byte2Size(t[i].lixianChannel.speed,2)+"/s</span>";break;case Protocol.LIST_TASK_LIXIANCHANNEL_STATE_FAILED:var x=t[i].lixianChannel.failCode;if(x>=24876)var T=Protocol.MESSAGE_LIST_TASK_LIXIANCHANNEL_ERRORS[x-24876];else if(x>=24676)var T=Protocol.MESSAGE_LIST_TASK_LIXIANCHANNEL_ERRORS[x-24676];else{if(x==Protocol.LIST_TASK_LIXIANCHANNEL_ERR_IS_WORKING)break;var T=Protocol.MESSAGE_LIST_TASK_LIXIANCHANNEL_ERRORS[x]}XRD.info.uservip>0?y='<span class="spd_lixian c_hlight">离线加速失败'+(T?": "+T:"")+" #"+x+'<a href="#" data-dispatch="rActiveLixianChannel" data-data="'+t[i].id+'"> 重试</a>'+"</span>":y='<span class="spd_lixian c_hlight">离线加速失败'+(T?": "+T:"")+" #"+x+'<a href="#" data-dispatch="popVipOpen"> 重试</a>'+"</span>"}l=y+(y&&g?"|":"")+g,c=w+b}c=h?h:c;var N=$('<div class="rw_list" id="tasklist-task-item-'+t[i].id+'" data-task-id="'+t[i].id+'">'+'<div class="rw_inter">'+'<div class="w01">'+'<div class="w01sel">'+'<input type="checkbox" class="in_ztclick" id="tasklist-task-item-checkbox-'+t[i].id+'" />'+"</div>"+"</div>"+'<div class="w02">'+'<div class="rwicbox">'+'<em class="rwicimg '+s+'"></em>'+"</div>"+"</div>"+'<div class="w03">'+'<div class="w03img">'+'<img src="images/'+o+'.png" class="png" />'+"</div>"+"</div>"+'<div class="w04">'+'<div class="rw_infoname">'+'<p id="tname_a61">'+'<span class="namelink">'+'<a href="#" title="'+t[i].name+'">'+t[i].name+"</a>"+"</span>"+"</p>"+"<p>"+'<span class="rw_gray">'+Helper.byte2Size(t[i].size,2)+"</span>"+"</p>"+"</div>"+"</div>"+'<div class="w05">'+'<div class="rwjindu">'+'<div class="loadbar">'+'<span style="width:'+u+'%" class="barpar"></span>'+'<em class="loadnum">'+u+"%</em>"+"</div>"+'<div class="sub_barinfo rw_gray">'+a+"</div>"+"</div>"+"</div>"+'<div class="w06">'+'<p class="speed">'+f+"</p>"+'<p class="speeder">'+l+"</p>"+"</div>"+'<div class="w07">'+'<div class="rwset">'+"<p>"+c+"</p>"+"</div>"+"</div>"+"</div>"+"</div>");$("#tasklist-body").append(N);var C=t[i].id.toString();Helper.indexOf(XRD.info.selectedTasks,C)!=-1&&XRD.dispatch("rClickItem",C)}}else $("#tasklist-body").html('<p class="win_nolist">任务列表为空</p>');this.refreshToolbox()},updateTaskCount:function(e,t){switch(this.currentListType){case Protocol.LIST_TYPE_RUNNING_TASKS:this.totalCount=t.runningCount;break;case Protocol.LIST_TYPE_COMPLETED_TASKS:this.totalCount=t.completedCount;break;case Protocol.LIST_TYPE_RECYCLED_TASKS:this.totalCount=t.recycledCount;break;case Protocol.LIST_TYPE_FAILED_TASKS:this.totalCount=t.failedCount}$("#tasklist-pager").html(this.paginate(this.totalCount,this.pageSize,this.currentPage,this.showPages))},paginate:function(e,t,n,r){e||(e=0),t||(t=8),n||(n=1),r||(r=5),n=parseInt(n);var i="",s=e?Math.ceil(e/t):1,o=Math.ceil(r/2),u=1,a=s;r>s&&(r=s),n>o&&(u=n-(o-1)),n>s-(o-1)&&(u=s-r+1),n<s-(o-1)&&(a=n+(o-1)),n<o&&(a=r),n>o&&u>1&&(i+='<span class="pre"><a href="#" title="上一页" data-dispatch="rGoToPage" data-data="'+(n-1)+'">上一页</a></span>'),i+="<ul>",n>o&&u>1&&(i+='<li><span style="padding:0 5px;">...</span></li>');for(var f=u;f<=a;f++)i+="<li>",f==n?i+='<a class="on" href="#" data-dispatch="rGoToPage" data-data="'+f+'">'+f+"</a>":i+='<a href="#" data-dispatch="rGoToPage" data-data="'+f+'">'+f+"</a>",i+="</li>";return n<s-(o-1)&&a<s&&(i+='<li><span style="padding:0 5px;">...</span></li>'),i+="</ul>",n<s-(o-1)&&a<s&&(i+='<span class="next"><a href="#" title="下一页" data-dispatch="rGoToPage" data-data="'+(n+1)+'">下一页</a></span>'),i},taskFailed:function(e,t){t==-1&&(XRD.dispatch("messageClose"),XRD.dispatch("message","创建任务失败：文件名含有非法字符"))},clickXiaoMiBoxTips2:function(e){Helper.setCookie("clickXiaomiBoxTip2","checked",{path:"/",expires:3600,domain:"xunlei.com"}),XRD.dispatch("rRefreshTaskList")}})
XRD.attach("LiXian",{taskNumsPerPage:8,pageNo:1,totalPage:1,isOpen:0,_boxSpace:{},_boxDefaultPath:{},_lixianInitFlag:!1,init:function(){var e=XRD.info.uservip;e>0||(e=Helper.getCookie("vipstate")),e||(e=0);if(e<=0){$("#lixian-open-button").html('<b href="#" title="非会员不可用"><span class="li_xiazai_hui">离线下载</span></b>');return}$("#lixian-open-button").html('<a href="#module=lixian" data-dispatch="open" data-data="lixian"><span class="li_xiazai">离线下载</span></a>'),this._lixianInitFlag||(XRD.on("open",this.lixianOpen,this),Protocol.lixianInit(),this._lixianInitFlag=!0)},lixianOpen:function(e,t){if(t=="lixian"){try{_hmt.push(["_trackEvent","lixian","open"])}catch(n){}this.isOpen||(this.isOpen=1,XRD.on("lixianSelectAll",this.selectAll,this),XRD.on("lixianSelectInvert",this.selectInvert,this),XRD.on("lixianCheckboxChangeState",this.selectStatus,this),XRD.on("lixianSelectNone",this.selectNone,this),XRD.on("lixianAddToBox",this.addToBox,this),XRD.on("lixianCloseLayer",this.closeLayer,this),XRD.on("lixianRefreshBoxPartitionList",this.refreshPartitionList,this),XRD.on("lixianRefreshBoxRemainSpace",this.refreshBoxRemainSpace,this),XRD.on("lixianRefreshBoxPercentBar",this.refreshBoxSpacePercent,this),XRD.on("lixianBeginDownload",this.beginDownload,this),XRD.on("lixianRefreshBoxSpaceCache",this._refreshBoxSpaceCache,this),XRD.on("lixianRefreshBoxDefaultPathCache",this._refreshBoxDefaultPathCache,this),XRD.on("lixianRefreshBoxNeedSpace",this.refreshBoxNeedSpace,this),XRD.on("lixianLayerSelectAll",this._layerSelectAll,this),XRD.on("lixianLayerSelectNone",this._layerSelectNone,this),XRD.on("lixianLayerSelectStatus",this._layerSelectStatus,this),XRD.on("lixianLayerSelectInvert",this._layerSelectInvert,this),XRD.on("lixianGetTask",this.lixianTask,this),XRD.on("lixianGetListSuccess",this.refreshList,this),XRD.on("lixianGoPage",this.goPage,this),XRD.on("lixianGoPreviousPage",this.goPreviousPage,this),XRD.on("lixianGoNextPage",this.goNextPage,this),$(".task-checkbox-all").unbind("click").bind("click",function(){$(this).attr("checked")==="checked"?XRD.dispatch("lixianSelectAll"):XRD.dispatch("lixianSelectNone")}),$("#lixian-layer-select-all").die("click").live("click",function(){$(this).attr("checked")?XRD.dispatch("lixianLayerSelectAll"):XRD.dispatch("lixianLayerSelectNone")}),$(document).unbind("keydown",this._hotKey).bind("keydown",this._hotKey),$("#lixian-add-to-box-button").data("lixian-disabled",1),$("#lixian").show(),XRD.dispatch("lixianGetTask"),function(){var e=$(window).height()-190;e<100&&(e=150),$("#lixian-task-list").height(e).css("height",e+"px")}())}else $("#lixian").hide(),this.isOpen&&(this.isOpen=0,XRD.off("lixianSelectAll",this.selectAll,this),XRD.off("lixianSelectInvert",this.selectInvert,this),XRD.off("lixianCheckboxChangeState",this.selectStatus,this),XRD.off("lixianSelectNone",this.selectNone,this),XRD.off("lixianAddToBox",this.addToBox,this),XRD.off("lixianCloseLayer",this.closeLayer,this),XRD.off("lixianRefreshBoxPartitionList",this.refreshPartitionList,this),XRD.off("lixianRefreshBoxRemainSpace",this.refreshBoxRemainSpace,this),XRD.off("lixianRefreshBoxPercentBar",this.refreshBoxSpacePercent,this),XRD.off("lixianBeginDownload",this.beginDownload,this),XRD.off("lixianRefreshBoxSpaceCache",this._refreshBoxSpaceCache,this),XRD.on("lixianRefreshBoxDefaultPathCache",this._refreshBoxDefaultPathCache,this),XRD.off("lixianRefreshBoxNeedSpace",this.refreshBoxNeedSpace,this),XRD.off("lixianLayerSelectAll",this._layerSelectAll,this),XRD.off("lixianLayerSelectNone",this._layerSelectNone,this),XRD.off("lixianLayerSelectStatus",this._layerSelectStatus,this),XRD.off("lixianLayerSelectInvert",this._layerSelectInvert,this),XRD.off("lixianGetTask",this.lixianTask,this),XRD.off("lixianGetListSuccess",this.refreshList,this),XRD.off("lixianGoPage",this.goPage,this),XRD.off("lixianGoPreviousPage",this.goPreviousPage,this),XRD.off("lixianGoNextPage",this.goNextPage,this),$(".task-select-all").unbind("click"),$("#lixian-layer-select-all").die("click"),$(document).unbind("keydown",this._hotKey),this._boxSpace={},this._boxDefaultPath={})},selectAll:function(){return $(".task-checkbox").attr("checked","checked"),XRD.dispatch("lixianCheckboxChangeState"),!1},selectInvert:function(){var e=$(".task-checkbox"),t=null;for(var n=0;n<e.length;n++)t=$(e[n]),t.attr("checked")==="checked"?t.removeAttr("checked"):t.attr("checked","checked");return XRD.dispatch("lixianCheckboxChangeState"),!1},selectNone:function(){return $(".task-checkbox").removeAttr("checked"),XRD.dispatch("lixianCheckboxChangeState"),!1},selectStatus:function(){var e=$("#lixian .task-checkbox"),t=1,n=0,r=null;for(var i=0;i<e.length;i++)r=$(e[i]),r.attr("checked")?n=1:t=0;t===1?$(".task-checkbox-all").attr("checked","checked"):$(".task-checkbox-all").removeAttr("checked"),n<=0?$("#lixian-add-to-box-button").data("lixian-disabled",1).addClass("site_adddl_no"):$("#lixian-add-to-box-button").data("lixian-disabled",0).removeClass("site_adddl_no")},lixianTask:function(e){var t=Helper.getCookie("isvip");t==null&&(t=Helper.getCookie("vipstate")),t>0||(t=0);var n={user_info:{userid:Helper.getCookie("userid"),name:Helper.getCookie("usrname"),newno:Helper.getCookie("usernewno"),vip:t,ip:"0",from:"3",sessionid:Helper.getCookie("sessionid")},offset:this.pageNo<=0?0:(this.pageNo-1)*this.taskNumsPerPage,req_num:this.taskNumsPerPage,req_type:"4",fileattribute:"0"},r=function(e){e.ret<=0&&XRD.dispatch("lixianGetListSuccess",e)},i=function(e){var t=0;e.ret?t=e.ret:t=e.resp.ret,t?$("#lixian-task-list .rw_list div:eq(0)").html("获取离线任务列表失败。错误码：#"+t):$("#lixian-task-list .rw_list div:eq(0)").html("获取离线任务列表失败。")};Protocol.reqLxtaskList(n.user_info,n.offset,n.req_num,n.req_type,n.fileattribute,r,i)},refreshList:function(e,t){var n=t.tasklist.length,r="",i=null;for(var s=0;s<n;s++)i=t.tasklist[s],r+=this._lixianTaskItemTemplate(i);$(".lx-task-item").unbind("mouseleave"),$(".lx-task-item").unbind("mouseenter"),$("#lixian-task-list").html(r),t.task_total_cnt_all=t.task_total_cnt_all?t.task_total_cnt_all:0,this.totalPage=Math.ceil(t.task_total_cnt_all/this.taskNumsPerPage),this.pageNo<=0?this.pageNo=1:this.pageNo>this.totalPage&&(this.pageNo=this.totalPage),$("#lixian-pagebar").html(this._lixianTaskPageList(this.pageNo,this.totalPage)),$(".lx-task-item").bind("mouseenter",function(){$(this).addClass("lx-task-hover")}),$(".lx-task-item").bind("mouseleave",function(){$(this).removeClass("lx-task-hover")}),XRD.dispatch("lixianSelectNone")},goPage:function(e,t){return $("#lixian-task-list").html('<div class="rw_list"><div style="text-align:left;margin-left:2em;font-weight:bold;">列表刷新中……</div></div>'),$("#lixian-go-previous-page-button").show(),$("#lixian-go-next-page-button").show(),t=parseInt(t),t<1?t=1:t>this.totalPage&&(t=this.totalPage),this.pageNo=t,XRD.dispatch("lixianGetTask"),!1},goPreviousPage:function(e){XRD.dispatch("lixianGoPage",this.pageNo-1)},goNextPage:function(e){XRD.dispatch("lixianGoPage",this.pageNo+1)},addToBox:function(){if($("#lixian-add-to-box-button").data("lixian-disabled")<=0){XRD.dispatch("lixianCloseLayer"),XRD.dispatch("showBgMask"),this._boxSpace={},this._boxDefaultPath={};var e=$("#lixian input[type=checkbox]:checked"),t=0,n=0,r=null,s=function(e){var t="lixian-task-"+String(Math.ceil(Math.random()*1e5)),n="",r="",i="",s=e.length>8?1:0,o=null,u='<div class="rw_title"><span class="tname t01"><span style="" class="sel_form"><input type="checkbox" value="1" checked="checked" id="lixian-layer-select-all"></span></span><span class="tname bt_name w310">文件名称</span><span class="tname bt_size">文件大小</span></div><div class="rw_con z_h292" id="lixian-layer-task-list">';for(;s<e.length;s++)n=t+String(s),r=Helper.urlDecode($(e[s]).attr("data-name")),i=Helper.byte2Size($(e[s]).attr("data-size"),2),o=Helper.urlDecode(e[s].value),o.toLowerCase().substr(0,2)==="bt"&&(o=function(e){var t=/\/([0-9a-f]+)$/i,n=t.exec(e);return"magnet:?xt=urn:btih:"+n[1]}(o)),s%2?u+='<div class="rwli hoverbg"><label for="'+n+'" title="'+r+'"><div class="colbt colfirst"><span class="sel_form"><input type="checkbox" checked="checked" id="'+n+'" onclick="XRD.dispatch(\'lixianLayerSelectStatus\');" value="'+o+'" class="selit" data-size="'+$(e[s]).attr("data-size")+'" data-taskname="'+r+'"></span></div><div class="colbt bt_name w310"><div class="filename w310">'+r+'</div></div><div class="colbt bt_size">'+i+"</div></label></div>":u+='<div class="rwli"><label for="'+n+'" title="'+r+'"><div class="colbt colfirst"><span class="sel_form"><input type="checkbox" checked="checked" id="'+n+'" onclick="XRD.dispatch(\'lixianLayerSelectStatus\');" value="'+o+'" class="selit" data-size="'+$(e[s]).attr("data-size")+'" data-taskname="'+r+'"></span></div><div class="colbt bt_name w310"><div class="filename w310">'+r+'</div></div><div class="colbt bt_size">'+i+"</div></label></div>";return u+='</div><div class="rw_links z_rw_bg"><p>选择：<a title="全选" href="#" data-dispatch="lixianLayerSelectAll">全选</a><em style="margin: 0 7px;color:#BBBCBE" class="line">|</em><a title="反选" href="#" data-dispatch="lixianLayerSelectInvert">反选</a></p></div>',u}(e),o="",u=XRD.info.downloaderList,a=Helper.keys(u);for(i=0;i<a.length;i++)u[a[i]].online>=1&&(o+='<option value="'+u[a[i]].pid+'" data-online="'+u[a[i]].online+'" data-path="'+u[a[i]].path_list+'">'+u[a[i]].name+"</option>");for(i=0;i<a.length;i++)u[a[i]].online<=0&&(o+='<option value="'+u[a[i]].pid+'" data-online="'+u[a[i]].online+'" data-path="'+u[a[i]].path_list+'">'+u[a[i]].name+"</option>");$("#lixian-box-select").html(o),$("#lixian-box-need-space").html(Helper.byte2Size(t,2)).attr("data-space",t),$("#lixian-download-file-list").html(s);var f=$(window).height()-$("#lixian-select-box-layer").height();f>100?f=100:f<0&&(f=0),f+="px",$("#lixian-select-box-layer").fadeIn("fast").css("top",f),$("#lixian-box-select").unbind("change").bind("change",function(){XRD.dispatch("lixianRefreshBoxPartitionList")}),$("#lixian-box-partition").unbind("change").bind("change",function(){XRD.dispatch("lixianRefreshBoxRemainSpace")}),XRD.dispatch("lixianRefreshBoxPartitionList"),XRD.dispatch("lixianLayerSelectAll")}},closeLayer:function(){XRD.dispatch("hideBgMask"),$("#lixian-box-select").unbind("change"),$("#lixian-select-box-layer").fadeOut("fast"),this._boxSpace={}},refreshPartitionList:function(){$("#lixian-box-partition").html("<option>获取中</option>"),$("#lixian-box-remain-space").html("剩余空间：获取中").attr("data-space",0),$("#lixian-box-space-percent").width("100%"),$("#lixian-box-begin-download").addClass("btn_gary").data("allow",0);var e=$("#lixian-box-select").val();if(e)if($($("#lixian-box-select option")[$("#lixian-box-select")[0].selectedIndex]).attr("data-online")<=0)if(this._boxDefaultPath[e]){var t=this._boxDefaultPath[e];if(Helper.isString(t)&&t!=""){var n=t.split(":"),r=n[0];if(n[1]&&n[1]!=""&&n[1]!="/")var i=n[1];else var i="/TDDOWNLOAD/"}else var r="C",i="/TDDOWNLOAD/";var s=XRD.info.downloaderList[e].path_list,o=s.split(","),u="";for(var a=0;a<o.length;++a){if(o[a]=="")continue;var f=o[a].split(":")[0];f==r?u+='<option value="'+f+'-off">'+f+":</option>":u+='<option value="'+f+'-off" selected>'+f+":</option>"}u==""&&(u+='<option value="'+r+'-off">'+r+":</option>"),$("#lixian-box-partition").html(u),$("#lixian-box-partition").attr("data-defaultDisk",r),$("#lixian-box-partition").attr("data-defaultPath",i),$("#lixian-download-path").val(i),$("#lixian-box-remain-space").html('<span style="color:#f00;">下载器不在线</span>').attr("data-space",-2),XRD.dispatch("lixianRefreshBoxPercentBar")}else Protocol.getConfig(e,function(t){t.pid=e,XRD.dispatch("lixianRefreshBoxDefaultPathCache",t)});else if(this._boxSpace[e])if(this._boxDefaultPath[e]){var t=this._boxDefaultPath[e];if(Helper.isString(t)&&t!=""){var n=t.split(":"),r=n[0];if(n[1]&&n[1]!=""&&n[1]!="/")var i=n[1];else var i="/TDDOWNLOAD/"}else var r="C",i="/TDDOWNLOAD/";var l=this._boxSpace[e],u="",c=l.length;for(var a=0;a<c;a++)l[a].path==r?u+='<option value="'+l[a].path+"-"+l[a].remain+'" selected>'+l[a].path+":</option>":u+='<option value="'+l[a].path+"-"+l[a].remain+'">'+l[a].path+":</option>";c<=0&&(u+='<option value="'+r+'-noDisk">'+r+":</option>"),$("#lixian-box-partition").attr("data-defaultDisk",r),$("#lixian-box-partition").attr("data-defaultPath",i),$("#lixian-download-path").val(i),$("#lixian-box-partition").html(u),XRD.dispatch("lixianRefreshBoxRemainSpace")}else Protocol.getConfig(e,function(t){t.pid=e,XRD.dispatch("lixianRefreshBoxDefaultPathCache",t)});else Protocol.boxSpace(e,function(t){t.rtn==0&&(t.pid=e,XRD.dispatch("lixianRefreshBoxSpaceCache",t))})},refreshBoxRemainSpace:function(){if(!$("#lixian-box-partition").val()){$("#lixian-box-remain-space").attr("data-space",-1).html('<span style="color:#f00;">没有检测到外接存储设备</span>');return}var e=$("#lixian-box-partition").val().split("-");if(e[1]==="off")$("#lixian-box-remain-space").attr("data-space",-2).html('<span style="color:#f00;">下载器不在线</span>');else if(e[1]==="noDisk")$("#lixian-box-partition").attr("data-defaultDisk")==e[0]?$("#lixian-download-path").val($("#lixian-box-partition").attr("data-defaultPath")):$("#lixian-download-path").val("/TDDOWNLOAD/"),$("#lixian-box-remain-space").attr("data-space",-1).html('<span style="color:#f00;">没有检测到外接存储设备</span>');else{var t=Helper.byte2Size(e[1],2);$("#lixian-box-partition").attr("data-defaultDisk")==e[0]?$("#lixian-download-path").val($("#lixian-box-partition").attr("data-defaultPath")):$("#lixian-download-path").val("/TDDOWNLOAD/"),$("#lixian-box-remain-space").html("剩余空间："+t).attr("data-space",e[1])}XRD.dispatch("lixianRefreshBoxPercentBar")},refreshBoxNeedSpace:function(){var e=$("#lixian-select-box-layer input[type=checkbox]"),t=0,n=0,r=null;for(var i=1;i<e.length;i++)r=e[i],r.checked&&(n=Number($(r).attr("data-size")),t+=isNaN(n)?0:n),i%2?$(r).parent().parent().parent().parent().removeClass("hoverbg"):$(r).parent().parent().parent().parent().addClass("hoverbg");$("#lixian-box-need-space").html(Helper.byte2Size(t,2)).attr("data-space",t),XRD.dispatch("lixianRefreshBoxPercentBar")},refreshBoxSpacePercent:function(){var e=$("#lixian-box-remain-space").attr("data-space");if($("#lixian-box-need-space").attr("data-space")<=0){$("#lixian-newtask-message").html(""),$("#lixian-box-space-percent").css({width:"0%"}),$("#lixian-box-begin-download").addClass("btn_gary").data("allow",0);return}if(e==-1)$("#lixian-newtask-message").html("当有外接存储设备时添加的任务将自动开始下载"),$("#lixian-box-space-percent").css({width:"0%"}),$("#lixian-box-begin-download").removeClass("btn_gary").data("allow",1);else if(e==-2)$("#lixian-newtask-message").html("当下载器在线时添加的任务将自动开始下载"),$("#lixian-box-space-percent").css({width:"0%"}),$("#lixian-box-begin-download").removeClass("btn_gary").data("allow",1);else{if(e<=0)var t=100;else var t=Math.ceil($("#lixian-box-need-space").attr("data-space")/e*100);t>=100?($("#lixian-newtask-message").html("下载器空间不足"),$("#lixian-box-space-percent").css({width:"100%"}),$("#lixian-box-begin-download").addClass("btn_gary").data("allow",0)):($("#lixian-newtask-message").html(""),$("#lixian-box-space-percent").css({width:t+"%"}),$("#lixian-box-begin-download").removeClass("btn_gary").data("allow",1))}},beginDownload:function(){if($("#lixian-box-begin-download").data("allow")){var e=$("#lixian-box-select").val(),t=$("#lixian-box-partition").val().split("-"),n=$("#lixian-download-path").val().replace(/\\/g,"/");n=n.replace(/(^\s*)|(\s*$)/g,""),n=n.replace(/\/+/g,"/"),n==""&&(n="/");var r=t[0]+":"+n,i=/^[a-zA-Z]\:\/([^\/:*?"<>|\\]+\/{0,1})*$/i;if(!i.test(r)){alert('路径有误或者含有非法字符 \\ : * ? " < > |');return}var s=[],o=$("#lixian-layer-task-list input[type=checkbox]");for(var u=0;u<o.length;u++)o.eq(u).attr("checked")&&s.push({url:o.eq(u).val(),name:o.eq(u).attr("data-taskname"),gcid:"",cid:"",filesize:0});var a=function(e,t){if(e==0){var t=t.tasks,n=t.length,r=0,i=null;for(var s=0;s<n;s++){var o=t[s];i=$("#lixian-download-file-list [value='"+o.url+"']").parent().parent().parent().parent(),o.result==0?i.remove():r==0&&(r=o.result)}r==0?(XRD.dispatch("message","离线任务创建成功。"),XRD.dispatch("lixianCloseLayer")):r==202?(XRD.dispatch("lixianRefreshBoxNeedSpace"),$("#lixian-newtask-message").html("创建任务失败：下载器中已存在相同的任务")):(XRD.dispatch("lixianRefreshBoxNeedSpace"),$("#lixian-newtask-message").html("创建任务失败：错误 #"+r))}else $("#lixian-newtask-message").html("创建任务失败：错误 #"+e)};if(XRD.info.downloaderList[e].accesscode&&!XRD.getPassed(e)){XRD.dispatch("popAccessCode",e,function(){XRD.dispatch("message","离线任务创建中……"),Protocol.createTask($("#lixian-box-select").val(),r,s,a)});return}XRD.dispatch("message","离线任务创建中……"),Protocol.createTask($("#lixian-box-select").val(),r,s,a)}},_lixianTaskItemTemplate:function(e){var t=Math.floor(e.progress/100),n=function(){var t="";e.restype==3||e.restype==5?t="bt":e.vod?t="video":t="other";var n=0;switch(t){case"bt":n=6;break;case"video":n=5;break;default:n=1}return n}(),r=function(){var t="";switch(e.download_status){case 0:t="time";break;case 1:t="down";break;case 2:t="right";break;case 3:t="wrong";break;case 4:break;case 5:t="pause"}return t}(e.download_status);if(e.download_status==3)var i='<label for="input-checkbox-'+e.taskid+'"><div class="rw_list lx-task-item" id="lx-list-'+e.taskid+'" title="'+Helper.urlDecode(e.taskname)+'" data-taskid="'+e.taskid+'" data-status="'+e.download_status+'"><div class="rw_inter"><div class="w01"><div class="w01sel"><input type="checkbox" onclick="javascript:XRD.dispatch(\'lixianCheckboxChangeState\');" class="in_ztclick task-checkbox" value="'+e.url+'" id="input-checkbox-'+e.taskid+'" data-size="'+e.filesize+'" data-name="'+e.taskname+'" /></div></div><div class="w02"><div class="rwicbox"><em class="rwicimg rwic'+r+'" id="statuscss'+e.taskid+'"></em></div></div><div class="w03"><div class="w03img"><img src="images/'+n+'.png" class="png"></div></div><div class="w04"><div class="rw_infoname"><p id="tname_a'+e.taskid+'"><span class="namelink"><span taskid="'+e.taskid+'" check="1" dbclick="1">'+Helper.urlDecode(e.taskname)+'</span></span></p><p><span id="size-'+e.taskid+'" class="rw_gray">'+Helper.byte2Size(e.filesize,2)+'</span></p></div></div><div class="w05"><div class="rwjindu"><div class="loadbar"><span id="rwjindu-'+e.taskid+'" style="width:'+t+'%" class="barpar"></span><em class="loadnum" id="loadnum-'+e.taskid+'">'+t+'%</em></div><div class="sub_barinfo rw_gray" style="display:none;" id="rwtime-'+e.taskid+'"></div></div></div><div class="w07" style="display:;"><div class="rwset"><p class="p_center">&nbsp;</p></div></div></div></div></label>';else if(Number(e.flag)!==4)var i='<label for="input-checkbox-'+e.taskid+'"><div class="rw_list lx-task-item" id="lx-list-'+e.taskid+'" title="'+Helper.urlDecode(e.taskname)+'" data-taskid="'+e.taskid+'" data-status="'+e.download_status+'"><div class="rw_inter"><div class="w01"><div class="w01sel"><input type="checkbox" onclick="javascript:XRD.dispatch(\'lixianCheckboxChangeState\');" class="in_ztclick task-checkbox" value="'+e.url+'" id="input-checkbox-'+e.taskid+'" data-size="'+e.filesize+'" data-name="'+e.taskname+'" /></div></div><div class="w02"><div class="rwicbox"><em class="rwicimg rwic'+r+'" id="statuscss'+e.taskid+'"></em></div></div><div class="w03"><div class="w03img"><img src="images/'+n+'.png" class="png"></div></div><div class="w04"><div class="rw_infoname"><p id="tname_a'+e.taskid+'"><span class="namelink"><span taskid="'+e.taskid+'" check="1" dbclick="1">'+Helper.urlDecode(e.taskname)+'</span></span></p><p><span id="size-'+e.taskid+'" class="rw_gray">'+Helper.byte2Size(e.filesize,2)+'</span></p></div></div><div class="w05"><div class="rwjindu"><div class="loadbar"><span id="rwjindu-'+e.taskid+'" style="width:'+t+'%" class="barpar"></span><em class="loadnum" id="loadnum-'+e.taskid+'">'+t+'%</em></div><div class="sub_barinfo rw_gray" style="display:none;" id="rwtime-'+e.taskid+'"></div></div></div><div class="w07" style="display:;"><div class="rwset"><p class="p_center">保存<span>'+String(Math.floor(e.left_live_time/86400))+"</span>天</p></div></div></div></div></label>";else var i='<label for="input-checkbox-'+e.taskid+'"><div class="rw_list lx-task-item" id="lx-list-'+e.taskid+'" title="'+Helper.urlDecode(e.taskname)+'" data-taskid="'+e.taskid+'" data-status="'+e.download_status+'"><div class="rw_inter"><div class="w01"><div class="w01sel"><input type="checkbox" onclick="javascript:XRD.dispatch(\'lixianCheckboxChangeState\');" class="in_ztclick task-checkbox" value="'+e.url+'" id="input-checkbox-'+e.taskid+'" data-size="'+e.filesize+'" data-name="'+e.taskname+'" /></div></div><div class="w02"><div class="rwicbox"><em class="rwicimg rwic'+r+'" id="statuscss'+e.taskid+'"></em></div></div><div class="w03"><div class="w03img"><img src="images/'+n+'.png" class="png"></div></div><div class="w04"><div class="rw_infoname"><p id="tname_a'+e.taskid+'"><span class="namelink"><span taskid="'+e.taskid+'" check="1" dbclick="1">'+Helper.urlDecode(e.taskname)+'</span></span></p><p><span id="size-'+e.taskid+'" class="rw_gray">'+Helper.byte2Size(e.filesize,2)+'</span></p></div></div><div class="w05"><div class="rwjindu"><div class="loadbar"><span id="rwjindu-'+e.taskid+'" style="width:'+t+'%" class="barpar"></span><em class="loadnum" id="loadnum-'+e.taskid+'">'+t+'%</em></div><div class="sub_barinfo rw_gray" style="display:none;" id="rwtime-'+e.taskid+'"></div></div></div><div class="w07" style="display:;"><div class="rwset"><p class="p_center">已过期</p></div></div></div></div></label>';return i},_lixianTaskPageList:function(e,t){e<=1&&$("#lixian-go-previous-page-button").hide(),e>=t&&$("#lixian-go-next-page-button").hide();var n="";if(t<=5)for(var r=1;r<=t;r++)r==e?n+='<li><a class="on">'+r+"</a></li>":n+='<li><a href="#" data-dispatch="lixianGoPage" data-data="'+r+'">'+r+"</a></li>";else if(e<=3){for(var r=1;r<=5;r++)r==e?n+='<li><a class="on">'+r+"</a></li>":n+='<li><a href="#" data-dispatch="lixianGoPage" data-data="'+r+'");">'+r+"</a></li>";n+='<li><span style="padding:0 5px;">...</span></li>'}else if(e>=t-2){n+='<li><span style="padding:0 5px;">...</span></li>';for(var r=t-4;r<=t;r++)r==e?n+='<li><a class="on">'+r+"</a></li>":n+='<li><a href="#" data-dispatch="lixianGoPage" data-data="'+r+'">'+r+"</a></li>"}else{n+='<li><span style="padding:0 5px;">...</span></li>';var i=e+2;for(var r=e-2;r<=i;r++)r==e?n+='<li><a class="on">'+r+"</a></li>":n+='<li><a href="#" data-dispatch="lixianGoPage" data-data="'+r+'">'+r+"</a></li>";n+='<li><span style="padding:0 5px;">...</span></li>'}return n},_refreshBoxSpaceCache:function(e,t){this._boxSpace[t.pid]=t.space,XRD.dispatch("lixianRefreshBoxPartitionList")},_refreshBoxDefaultPathCache:function(e,t){t.defaultPath?this._boxDefaultPath[t.pid]=t.defaultPath:this._boxDefaultPath[t.pid]="C:/TDDOWNLOAD/",XRD.dispatch("lixianRefreshBoxPartitionList")},_hotKey:function(e){e.keyCode==27&&XRD.dispatch("lixianCloseLayer")},_layerSelectAll:function(){$("#lixian-select-box-layer input[type=checkbox]").attr("checked","checked"),XRD.dispatch("lixianRefreshBoxNeedSpace")},_layerSelectNone:function(){$("#lixian-select-box-layer input[type=checkbox]").removeAttr("checked"),$("#lixian-box-begin-download").data("allow",0),XRD.dispatch("lixianRefreshBoxNeedSpace")},_layerSelectInvert:function(){var e=$("#lixian-layer-task-list input[type=checkbox]");for(var t=0;t<e.length;t++)e.eq(t).attr("checked")?e.eq(t).removeAttr("checked"):e.eq(t).attr("checked","checked");XRD.dispatch("lixianLayerSelectStatus")},_layerSelectStatus:function(){var e=$("#lixian-layer-task-list input[type=checkbox]"),t=1;for(var n=0;n<e.length;n++)if(!e.eq(n).attr("checked")){t=0;break}t<=0?$("#lixian-layer-select-all").removeAttr("checked"):$("#lixian-layer-select-all").attr("checked","checked"),XRD.dispatch("lixianRefreshBoxNeedSpace")},_path2Array:function(e){var t=function(e){var t=[],n=1;for(var r=0;r<e.length;r++){n=1;for(var i=0;i<t.length;i++)if(e[i]==e[r]){n=0;break}n&&t.push(e[r])}return t};e.substr(e.length-1)===";"&&(e=e.substr(0,e.length-1));var n=e.split(";");for(var r=0;r<n.length;r++)n[r]=n[r].replace(/^\s+|\s+$/g,""),n[r].substr(1,1)===":"?n[r]=n[r].substr(0,1).toUpperCase():n[r]=n[r].substr(0,2).toUpperCase();return t(n)}})
document.domain="xunlei.com";var DaquanProtocol={PROTOCOL:"http",HOST:"hub.yuancheng.xunlei.com",PORT:"80",DEBUG:!1,V:1,_ajax:function(e,t,n){typeof t!="function"&&(t=function(){}),typeof n!="function"&&(n=function(){});var r=DaquanProtocol.PROTOCOL+"://"+DaquanProtocol.HOST+"/daquan/"+e+"&v="+DaquanProtocol.V+"&callback=?";DaquanProtocol.DEBUG&&(console.log("----------------"),console.log("AJAX: "+r)),$.ajax({url:r,dataType:"jsonp",success:function(e){DaquanProtocol.DEBUG&&console.log(e),t(e)},error:function(){DaquanProtocol.DEBUG&&console.log("REQUEST FAILED"),n()}})},screen:function(e,t,n){var r="screen?search="+e.search+"&classify="+e.classify+"&resolution="+e.resolution+"&type="+e.type+"&area="+e.area+"&year="+e.year+"&number="+e.number+"&offset="+e.offset;this._ajax(r,t,n)},hot:function(e,t,n){var r="hot?classify="+e.classify+"&number="+e.number;this._ajax(r,t,n)},down:function(e,t,n){var r="down?classify="+e.classify+"&movie_id="+e.movie_id;this._ajax(r,t,n)}}
XRD.attach("DaQuan",{NUMBER:9,_swap:"",_cache:null,_hotJson:{movie:null,tv:null,anime:null},_type:{anime:["其他","热血","机战","运动","美少女","推理","冒险","耽美","搞笑","百合","迪斯尼","战争","神魔","吸血鬼","忍者","竞技","悬疑","LOLI","恋爱","宠物","新番动画","经典长篇","完结动画","剧场/OVA","声优/LIVE","真人PV","预告","社会"],tv:["其他","武侠","历史","偶像","言情","警匪","悬疑","战争","纪实","都市","儿童","古装","科幻","伦理","军旅","喜剧","神话","家庭","传记","剧情","动画","真人秀"],movie:["其他","动作","情色","冒险","动画","传记","喜剧","罪案","纪录","剧情","家庭","魔幻","黑色","历史","恐怖","音乐","歌舞","悬疑","爱情","科幻","短片","惊悚","战争","灾难","伦理","西部","写真","儿童","励志","运动"],zongyi:["含义","其他","播报","选秀","访谈","杂谈","搞笑","时尚","美食","汽车","情感","游戏","科教","歌舞","晚会","财经","体育"]},_area:["其他","内地","香港","台湾","日本","韩国","美国","英国","法国","西班牙","加拿大","德国","泰国","印度","意大利"],_areaZongyi:["内地","香港","台湾","其他"],_source:{youku:"优酷",tudou:"土豆",qiyi:"奇艺",kankan:"看看",qq:"腾讯",sohu:"搜狐",pptv:"PPTV",letv:"乐视"},_currentSelect:{search:"",classify:"movie",resolution:"all",type:"all",area:"all",year:"all",offset:0},_currentPage:1,_resolution:["默认值","1080p","720p","480p","320p"],_boxSpace:{},_boxDefaultPath:{},init:function(){XRD.on("open",this.daquanOpen,this),this.initIndex()},daquanOpen:function(e,t){if(t=="daquan"){if(!HubClient.getMark("hideDaquanGuide")){window.location="/guide/daquan/guide_1.html";return}$("#daquan").show(),XRD.dispatch("daquanGetTask");try{_hmt.push(["_trackEvent","daquan","open"])}catch(n){}if(!this.isOpen){this.isOpen=1,XRD.on("daquanIndexShow",this.showIndex,this),XRD.on("daquanIndexHide",this.hideIndex,this),XRD.on("daquanRefreshMainboard",this.refreashMainboard,this),XRD.on("daquanRefreshIndex",this.refreshIndex,this),XRD.on("daquanGetListSuccess",this.refreshMainboardHtml,this),XRD.on("daquanGetListSuccess",this.refreshPageHtml,this),XRD.on("daquanChangeOption",this.changeOption,this),XRD.on("daquanGetListNoResult",this.noResult,this),XRD.on("daquanShowDetail",this.detail,this),XRD.on("daquanShowDownload",this.download,this),XRD.on("daquanCloseLayer",this.layerHide,this),XRD.on("daquanNoResultRefresh",this.noResultRefresh,this),XRD.on("daquanSelectAll",this.selectAll,this),XRD.on("daquanSelectInvert",this.selectInvert,this),XRD.on("daquanCheckboxChangeState",this.selectStatus,this),XRD.on("daquanSelectNone",this.selectNone,this),XRD.on("daquanRefreshBoxInfo",this.refreshBoxInfo,this),XRD.on("daquanRefreshBoxRemainSpace",this.refreshBoxRemainSpace,this),XRD.on("daquanRefreshBoxNeedSpace",this.refreshBoxNeedSpace,this),XRD.on("daquanRefreshBoxPercentBar",this.refreshBoxSpacePercent,this),XRD.on("daquanBeginDownload",this.beginDownload,this),XRD.on("daquanRefreshBoxSpaceCache",this._refreshBoxSpaceCache,this),XRD.on("daquanRefreshBoxDefaultPathCache",this._refreshBoxDefaultPathCache,this),$("#daquan-download-file-list input.task-checkbox-all").die("click").live("click",function(){$(this).attr("checked")==="checked"?XRD.dispatch("daquanSelectAll"):XRD.dispatch("daquanSelectNone")});var r=function(e){e.keyCode==13&&$("#daquan-search-button").click()};$("#daquan-search-input").unbind("focus").unbind("blur").bind("focus",function(){this.defaultValue==this.value&&(this.value=""),$(document).bind("keydown",r)}).blur(function(){this.value==""&&(this.value=this.defaultValue),$(document).unbind("keydown",r)}),$(document).unbind("keydown",this._hotKey).bind("keydown",this._hotKey),XRD.dispatch("daquanRefreshMainboard"),$("#daquan-index-rollup").show(),Helper.isIe()<=6&&($("#tasklist-body").data("op-height",$("#header").height()+$("#tasklist-toolbox").height()+$("#tasklist-header").height()+$("#tasklist-footer").height()),$("#tasklist-body").height($(window).height()-$("#tasklist-body").data("op-height")),$(window).resize(function(){$("#tasklist-body").height($(window).height()-$("#tasklist-body").data("op-height"))})),function(){$("#daquan-has-result-container").height($(window).height()-$("#header").height()-10),$("#daquan-no-result-container").height($(window).height()-$("#header").height()-10)}()}}else $("#daquan").hide(),this.isOpen&&(this.isOpen=0,XRD.dispatch("daquanCloseLayer"),XRD.off("daquanIndexShow",this.showIndex,this),XRD.off("daquanIndexHide",this.hideIndex,this),XRD.off("daquanRefreshIndex",this.refreshIndex,this),XRD.off("daquanGetListSuccess",this.refreshMainboardHtml,this),XRD.off("daquanGetListSuccess",this.refreshPageHtml,this),XRD.off("daquanChangeOption",this.changeOption,this),XRD.off("daquanRefreshMainboard",this.refreashMainboard,this),XRD.off("daquanGetListNoResult",this.noResult,this),XRD.off("daquanShowDetail",this.detail,this),XRD.off("daquanShowDownload",this.download,this),XRD.off("daquanCloseLayer",this.layerHide,this),XRD.off("daquanNoResultRefresh",this.noResultRefresh,this),XRD.off("daquanSelectAll",this.selectAll,this),XRD.off("daquanSelectInvert",this.selectInvert,this),XRD.off("daquanCheckboxChangeState",this.selectStatus,this),XRD.off("daquanSelectNone",this.selectNone,this),XRD.off("daquanRefreshBoxInfo",this.refreshBoxInfo,this),XRD.off("daquanRefreshBoxRemainSpace",this.refreshBoxRemainSpace,this),XRD.off("daquanRefreshBoxNeedSpace",this.refreshBoxNeedSpace,this),XRD.off("daquanRefreshBoxPercentBar",this.refreshBoxSpacePercent,this),XRD.off("daquanBeginDownload",this.beginDownload,this),XRD.off("daquanRefreshBoxSpaceCache",this._refreshBoxSpaceCache,this),XRD.on("daquanRefreshBoxDefaultPathCache",this._refreshBoxDefaultPathCache,this),$("#daquan-download-file-list input.task-checkbox-all").die("click"),$("#daquan-search-input").unbind("focus").unbind("blur"),$(document).unbind("keydown",this._hotKey),$("#daquan-index-rollup").hide(),$("#daquan-index-mainboard").hide(),this._cache=null,this._hotJson={movie:null,tv:null,anime:null})},initIndex:function(){this._currentSelect.type="all",$("#daquan-index-resolution").html(this.indexHtml._resolution()),$("#daquan-index-type").html(this.indexHtml._type(this._type[this._currentSelect.classify])),$("#daquan-index-area").html(this.indexHtml._area(this._area)),$("#daquan-index-year").html(this.indexHtml._year(this._year)),$("#daquan-index-mainboard a").removeClass("on"),$("#daquan-index-classify-"+this._currentSelect.classify).addClass("on"),$("#daquan-index-resolution-"+this._currentSelect.resolution).addClass("on"),$("#daquan-index-type-"+this._currentSelect.type).addClass("on"),$("#daquan-index-area-"+this._currentSelect.area).addClass("on"),$("#daquan-index-year-"+this._currentSelect.year).addClass("on"),XRD.dispatch("daquanRefreshIndex")},refreashMainboard:function(e,t){var n=function(e){e.rtn==0?($("#daquan").html($("#daquan-has-result").html()),XRD.dispatch("daquanGetListSuccess",e)):e.rtn==1&&($("#daquan").html($("#daquan-no-result").html()),XRD.dispatch("daquanGetListNoResult"))},r=function(e){XRD.dispatch("daquanGetListFailed",e)};this._currentSelect.number=this.NUMBER,this._currentSelect.offset=this.NUMBER*(this._currentPage-1),DaquanProtocol.screen(this._currentSelect,n,r)},refreshMainboardHtml:function(e,t){this._cache=t;var n="",r=t.movieList,i=function(e){var t="";for(var n=0;n<e.length;n++)e[n].link?t+='<a href="'+e[n].link+'" title="'+e[n].name+'" target="_blank">'+e[n].name+"</a>":t+='<span title="'+e[n].name+'">'+e[n].name+"</span>";return t},s=function(e){var t=[];return t[0]=Math.floor(e),t[1]=Math.floor(e*10%10),t},o=function(e){return e==1?'<i class="z_i_1080p">1080p下载</i>':""},u=[];for(var a=0;a<r.length;a++)r[a]._performer=i(r[a].performer),r[a]._director=i(r[a].director),u=s(r[a].mark),n+='<li><a class="z_dq_a_pic" href="#" data-dispatch="daquanShowDetail" data-data="'+a+'"><img src="'+r[a].image+'" alt="影片海报" title="'+r[a].name+'" width="95" height="127" />'+o(r[a].feature)+'</a><h3><a href="#" title="'+r[a].name+'" data-dispatch="daquanShowDetail" data-data="'+a+'">'+r[a].name+'</a></h3><div class="z_abs_score"><strong>'+u[0]+".<em>"+u[1]+'分</em></strong></div><p class="z_dq_info">'+r[a].description+'</p><p class="z_dq_actor">主演：'+r[a]._performer+'</p><p class="z_dq_links">'+'<a href="#" title="点击了解详情" data-dispatch="daquanShowDetail" data-data="'+a+'">点击了解详情&gt;&gt;</a>'+"大小：<em>"+r[a].size+'</em></p><div class="z_dq_btnwrap"><a class="z_btn_freedownload" href="#" title="免费下载" data-dispatch="daquanShowDownload" data-data="'+r[a].id+'">免费下载</a></div>=</li>';$("#daquan-mainboard").html(n)},refreshPageHtml:function(e,t){var n="",r=Math.ceil(t.totalNums/this.NUMBER);if(r<=1){$("#daquan-mainboard-page").html(" ");return}var i=0,s="",o="";this._currentPage<1?this._currentPage=1:this._currentPage>r&&(this._currentPage=r),this._currentPage>1&&(s='<a class="z_next_page" href="#" title="上一页" data-dispatch="daquanChangeOption" data-data="page-'+Number(this._currentPage-1)+'">&lt; 上一页</a>'),this._currentPage<r&&(o='<a class="z_next_page" href="#" title="下一页" data-dispatch="daquanChangeOption" data-data="page-'+Number(this._currentPage+1)+'">下一页 &gt;</a>');if(r<=9)for(i=1;i<=r;i++)this._currentPage==i?n+='<b title="'+i+'">'+i+"</b>":n+='<a href="#" title="'+i+'" data-dispatch="daquanChangeOption" data-data="page-'+i+'">'+i+"</a>";else{var u=0,a=this._currentPage-4,u=this._currentPage+4;a<1?(u+=1-a,a=1):u>r&&(a-=u-r,u=r),this._currentPage>1&&(s='<a class="z_next_page" href="#" title="上一页" data-dispatch="daquanChangeOption" data-data="page-'+Number(this._currentPage-1)+'">&lt; 上一页</a>'),this._currentPage<r&&(o='<a class="z_next_page" href="#" title="下一页" data-dispatch="daquanChangeOption" data-data="page-'+Number(this._currentPage+1)+'">下一页 &gt;</a>'),a>1&&(s+="<span>…</span>"),u<r&&(o="<span>…</span>"+o);for(i=a;i<=u;i++)this._currentPage==i?n+='<b title="'+i+'">'+i+"</b>":n+='<a href="#" title="'+i+'" data-dispatch="daquanChangeOption" data-data="page-'+i+'">'+i+"</a>"}$("#daquan-mainboard-page").html(s+n+o)},noResult:function(){var e="<strong>您选择的筛选条件：</strong>";this._currentSelect.search!=""&&(e+="<span>"+this._currentSelect.search+'<a title="删除" href="#" data-dispatch="daquanChangeOption" data-data="search-">X</a></span>'),this._currentSelect.type!="all"&&(e+="<span>"+this._type[this._currentSelect.classify][this._currentSelect.type]+'<a title="删除" href="#" data-dispatch="daquanChangeOption" data-data="type-all">X</a></span>'),this._currentSelect.area!="all"&&(e+="<span>"+this._area[this._currentSelect.area]+'<a title="删除" href="#" data-dispatch="daquanChangeOption" data-data="area-all">X</a></span>'),this._currentSelect.year!="all"&&(this._currentSelect.year=="ago"?e+='<span>更早<a title="删除" href="#" data-dispatch="daquanChangeOption" data-data="year-all">X</a></span>':e+="<span>"+this._currentSelect.year+'<a title="删除" href="#" data-dispatch="daquanChangeOption" data-data="year-all">X</a></span>'),$("#daquan-screen-condition").html(e);if(this._hotJson[this._currentSelect.classify]!=null)XRD.dispatch("daquanNoResultRefresh");else{var t={classify:this._currentSelect.classify,number:10},n=function(e){e.rtn==0&&XRD.dispatch("daquanNoResultRefresh",e)},r=function(){XRD.log("Get hot list failed.")};DaquanProtocol.hot(t,n,r)}},noResultRefresh:function(e,t){t!=null?this._hotJson[this._currentSelect.classify]=t:t=this._hotJson[this._currentSelect.classify];var n="";for(var r=0;r<t.movieList.length;r++)n+='<li><a class="z_hot_a_pic" href="#" data-dispatch="daquanChangeOption" data-data="search-'+t.movieList[r].name+'-clear"><img src="'+t.movieList[r].image+'" alt="'+t.movieList[r].name+'" title="'+t.movieList[r].name+'" width="95" height="127" /></a><p class="sear_p1"><a href="#" data-dispatch="daquanChangeOption" data-data="search-'+t.movieList[r].name+'">'+t.movieList[r].description+'</a></p><p class="sear_p2">播放：<span>'+t.movieList[r].playtimes+"</span></p></li>";$("#daquan-hot-list").html(n)},detail:function(e,t){XRD.dispatch("daquanCloseLayer"),XRD.dispatch("showBgMask");var n=function(e,t){var n="";for(var r=0;r<t.length;r++)n+="<span>"+e._type[e._currentSelect.classify][t[r]]+"</span>";return n}(this,this._cache.movieList[t].type),r='<div class="z_flo_film"><a class="z_flo_film_absimg" href="'+this._cache.movieList[t].link+'" title="'+this._cache.movieList[t].name+'" target="_blank"><img src="'+this._cache.movieList[t].image+'" alt="'+this._cache.movieList[t].name+'" title="'+this._cache.movieList[t].name+'" width="120" height="160" /></a><h3><a href="'+this._cache.movieList[t].link+'" title="'+this._cache.movieList[t].name+'" target="_blank">'+this._cache.movieList[t].name+"</a></h3><p>主演:"+this._cache.movieList[t]._performer+"</p><p>导演:"+this._cache.movieList[t]._director+"</p><p>类型:"+n+"</p><p>地区:<span>"+this._area[this._cache.movieList[t].area]+"</span></p><p>年份:<span>"+this._cache.movieList[t].year+'</span></p></div><dl class="z_flo_film_dl" style="height:auto;"><dt>剧情简介</dt><dd style="height:auto;">'+this._cache.movieList[t].description+"</dd>"+'</dl><a class="z_film_btn_ljxz" href="#" title="立即下载" href="#" data-dispatch="daquanShowDownload" data-data="'+this._cache.movieList[t].id+'">立即下载</a>';$("#daquan-movie-detail-main").html(r);var i=$(window).height()-$("#daquan-movie-detail").height();i>200?i=200:i<0&&(i=0),i+="px",$("#daquan-movie-detail").fadeIn("fast").css("top",i)},download:function(e,t){XRD.dispatch("daquanCloseLayer"),XRD.dispatch("showBgMask");var n=this,r=function(e){var t="";if(e.rtn==1)t="<span>服务器无资源返回</span>";else{var r={};if(n._currentSelect.classify=="tv"||n._currentSelect.classify=="anime"){var i=100,s=e.source.length;for(var o=0;o<s;o++)e.source[o].resolution<=0&&(e.source[o].resolution=100),r[e.source[o].resolution]||(r[e.source[o].resolution]=[]),r[e.source[o].resolution].push(e.source[o]),e.source[o].resolution<i&&(i=e.source[o].resolution)}var u=r[i]?r[i]:e.source;t=function(e){var t='<p class="z_pb10">请选择您想下载的文件</p><div class="rw_listbox" id="daquan-download-file-list"><div class="rw_title"><span class="tname t01"><span style="" class="sel_form"><input type="checkbox" class="task-checkbox-all" /></span></span><span class="tname bt_name w310">文件名称</span><span class="tname bt_size">文件大小</span></div><div class="rw_con z_h292">';for(var n=0;n<e.length;n++)n%2?t+='<div class="rwli hoverbg"><label for="daquan-task-select-'+n+'" title="'+e[n].name+'"><div class="colbt colfirst"><span class="sel_form"><input type="checkbox" id="daquan-task-select-'+n+'" data-size="'+e[n].size+'" data-url="'+e[n].url+'" class="selit task-checkbox" name="bt_ck" onclick="javascript:XRD.dispatch(\'daquanCheckboxChangeState\');" data-size="'+e[n].size+'" data-taskname="'+e[n].name+'"></span></div><div class="colbt bt_name w310"><div class="filename w310">'+e[n].name+'<input type="hidden" value="TVLoad.vol.1.01.FRM.pdf" name="btitle"></div></div><div class="colbt bt_size">'+e[n].size+"</div></label></div>":t+='<div class="rwli"><label for="daquan-task-select-'+n+'" title="'+e[n].name+'"><div class="colbt colfirst"><span class="sel_form"><input type="checkbox" id="daquan-task-select-'+n+'" data-size="'+e[n].size+'" data-url="'+e[n].url+'" class="selit task-checkbox" name="bt_ck" onclick="javascript:XRD.dispatch(\'daquanCheckboxChangeState\');" data-size="'+e[n].size+'" data-taskname="'+e[n].name+'"></span></div><div class="colbt bt_name w310"><div class="filename w310">'+e[n].name+'<input type="hidden" value="TVLoad.vol.1.01.FRM.pdf" name="btitle"></div></div><div class="colbt bt_size">'+e[n].size+"</div></label></div>";t+='</div><div class="rw_links z_rw_bg"><p>选择：<a href="#" data-dispatch="daquanSelectAll">全选</a><em style="margin: 0 7px;color:#BBBCBE" class="line">|</em><a title="反选" href="#" data-dispatch="daquanSelectInvert">反选</a></p></div></div>';var r='<p class="z_pb6">存储目录：</p><div class="fm_li z_fm_li"><select id="daquan-box-select">',i=Helper.keys(XRD.info.downloaderList),s="",o="";for(n=0;n<i.length;n++)XRD.info.downloaderList[i[n]].online?s+='<option value="'+XRD.info.downloaderList[i[n]].pid+'" data-online="'+XRD.info.downloaderList[i[n]].online+'" data-path="'+XRD.info.downloaderList[i[n]].path_list+'">'+XRD.info.downloaderList[i[n]].name+"</option>":o+='<option value="'+XRD.info.downloaderList[i[n]].pid+'" data-online="'+XRD.info.downloaderList[i[n]].online+'" data-path="'+XRD.info.downloaderList[i[n]].path_list+'">'+XRD.info.downloaderList[i[n]].name+"</option>";return r+=s+o+'</select><select id="daquan-box-partition"><option value="C-0">C:</option></select><input type="text" class="t_ipt_m w248" value="/TDDOWNLOAD/" id="daquan-download-path"></div><div class="barmagbox"><div class="savebar"><div class="need">所需空间：<span id="daquan-box-need-space" data-space="0">0B</span></div><div class="mayuse"><span id="daquan-box-remain-space">剩余空间：0B</span></div><span style="width: 0%;" class="bg" id="daquan-box-space-percent"></span></div></div><p class="lay_errtips" id="pop-daquantask-message"></p>',t+r}(u)}$("#daquan-movie-download-main").html(t),$("#daquan-box-select").unbind("change").bind("change",function(){XRD.dispatch("daquanRefreshBoxInfo")}),$("#daquan-box-partition").unbind("change").bind("change",function(){XRD.dispatch("daquanRefreshBoxRemainSpace");var e=$(this);e.val().substr(0,1)==e.attr("data-defaultPath")?$("#daquan-download-path").val(e.attr("data-defaultPath")):$("#daquan-download-path").val("/TDDOWNLOAD/")}),XRD.dispatch("daquanRefreshBoxInfo");var a=$(window).height()-$("#daquan-movie-download").height();a>100?a=100:a<0&&(a=0),a+="px",$("#daquan-movie-download").fadeIn("fast").css("top",a)},i=function(e){};DaquanProtocol.down({movie_id:t,classify:this._currentSelect.classify},r,i)},layerHide:function(){XRD.dispatch("hideBgMask"),$("#daquan-movie-detail").fadeOut("fast"),$("#daquan-movie-download").fadeOut("fast"),$("#daquan-box-select").unbind("change"),$("#daquan-box-partition").unbind("change"),this._boxSpace={},this._boxDefaultPath={}},indexHtml:{_resolution:function(){var e="<dt>按清晰度</dt>";return e+='<dd><a href="#" title="全部" data-dispatch="daquanChangeOption" data-data="resolution-all" id="daquan-index-resolution-all">全部</a></dd>',e+='<dd><a href="#" title="1080P" data-dispatch="daquanChangeOption" data-data="resolution-1080" id="daquan-index-resolution-1080">1080P</a></dd>',e+='<dd><a href="#" title="720P" data-dispatch="daquanChangeOption" data-data="resolution-720" id="daquan-index-resolution-720">720P</a></dd>',e+='<dd><a href="#" title="其他" data-dispatch="daquanChangeOption" data-data="resolution-other" id="daquan-index-resolution-other">其他</a></dd>',e},_type:function(e){var t="<dt>按类型</dt>";t+='<dd><a href="#" title="全部" data-dispatch="daquanChangeOption" data-data="type-all" id="daquan-index-type-all">全部</a></dd>';for(var n=1;n<e.length;n++)t+='<dd><a href="#" title="'+e[n]+'" data-dispatch="daquanChangeOption" data-data="type-'+n+'" id="daquan-index-type-'+n+'">'+e[n]+"</a></dd>";return t+='<dd><a href="#" title="其它" data-dispatch="daquanChangeOption" data-data="type-0" id="daquan-index-type-0">其它</a></dd>',t},_area:function(e){var t="<dt>按地区</dt>";t+='<dd><a href="#" title="全部" data-dispatch="daquanChangeOption" data-data="area-all" id="daquan-index-area-all">全部</a></dd>';for(var n=1;n<e.length;n++)t+='<dd><a href="#" title="'+e[n]+'" data-dispatch="daquanChangeOption" data-data="area-'+n+'" id="daquan-index-area-'+n+'">'+e[n]+"</a></dd>";return t+='<dd><a href="#" title="其它" data-dispatch="daquanChangeOption" data-data="area-0" id="daquan-index-area-0">其它</a></dd>',t},_year:function(){var e="<dt>按年份</dt>",t=function(){var e=new Date,t=e.getYear();return t<1900&&(t+=1900),t}();e+='<dd><a href="#" title="全部" data-dispatch="daquanChangeOption" data-data="year-all" id="daquan-index-year-all">全部</a></dd>';for(var n=t;n>=2003;n--)e+='<dd><a href="#" title="'+n+'" data-dispatch="daquanChangeOption" data-data="year-'+n+'" id="daquan-index-year-'+n+'">'+n+"</a></dd>";return e+='<dd><a href="#" title="更早" id="daquan-index-year-ago" data-dispatch="daquanChangeOption" data-data="year-ago">更早</a></dd>',e}},changeOption:function(e,t){var n=t.split("-");n[n.length-1]==="clear"&&(this._currentSelect.search="",this._currentSelect.type="all",this._currentSelect.area="all",this._currentSelect.year="all");switch(n[0]){case"search":var r=$("#daquan-search-input")[0];n.length>1&&(n[1]==""?r.value=r.defaultValue:r.value=n[1]),r.value==r.defaultValue?this._currentSelect.search="":this._currentSelect.search=r.value;break;case"resolution":this._currentSelect.resolution=n[1];break;case"type":this._currentSelect.type=n[1];break;case"year":this._currentSelect.year=n[1];break;case"area":this._currentSelect.area=n[1];break;case"classify":this._currentSelect.classify=n[1],this.initIndex();break;case"page":this._currentPage=Number(n[1])}n[0]!="page"&&(this._currentPage=1),n[1]!="classify"&&($("#daquan-index-mainboard a").removeClass("on"),$("#daquan-index-classify-"+this._currentSelect.classify).addClass("on"),$("#daquan-index-resolution-"+this._currentSelect.resolution).addClass("on"),$("#daquan-index-type-"+this._currentSelect.type).addClass("on"),$("#daquan-index-area-"+this._currentSelect.area).addClass("on"),$("#daquan-index-year-"+this._currentSelect.year).addClass("on")),XRD.dispatch("daquanRefreshMainboard")},showIndex:function(){var e=$(window).height()-200;$("#daquan-index-mainboard-options").css("height",e+"px"),Helper.isIe()?$("#daquan-index-mainboard").show():$("#daquan-index-mainboard").slideDown("fast")},hideIndex:function(){Helper.isIe()?$("#daquan-index-mainboard").hide():$("#daquan-index-mainboard").slideUp("fast")},selectAll:function(){return $(".task-checkbox").attr("checked","checked"),XRD.dispatch("daquanCheckboxChangeState"),!1},selectInvert:function(){var e=$(".task-checkbox"),t=null;for(var n=0;n<e.length;n++)t=$(e[n]),t.attr("checked")==="checked"?t.removeAttr("checked"):t.attr("checked","checked");return XRD.dispatch("daquanCheckboxChangeState"),!1},selectNone:function(){return $(".task-checkbox").removeAttr("checked"),XRD.dispatch("daquanCheckboxChangeState"),!1},selectStatus:function(){var e=$(".task-checkbox"),t=1,n=null;for(var r=0;r<e.length;r++){n=$(e[r]);if(n.attr("checked")==="checked")continue;t=0;break}t===1?$(".task-checkbox-all").attr("checked","checked"):$(".task-checkbox-all").removeAttr("checked"),XRD.dispatch("daquanRefreshBoxNeedSpace")},refreshBoxInfo:function(){$("#daquan-box-partition").html("<option>获取中</option>"),$("#daquan-box-remain-space").html("剩余空间：获取中").attr("data-space",0),$("#daquan-box-space-percent").width("100%"),$("#daquan-box-begin-download").addClass("btn_gary").data("allow",0);var e=$("#daquan-box-select").val();if(e)if(this._boxDefaultPath[e]){var t=this._boxDefaultPath[e];if(Helper.isString(t)&&t!=""){var n=t.split(":"),r=n[0].toUpperCase();if(n[1]&&n[1]!=""&&n[1]!="/")var i=n[1];else var i="/TDDOWNLOAD/"}else var r="C",i="/TDDOWNLOAD/";$("#daquan-box-partition").attr("data-defaultDisk",r),$("#daquan-box-partition").attr("data-defaultPath",i);if($($("#daquan-box-select option")[$("#daquan-box-select")[0].selectedIndex]).attr("data-online")<=0){$("#daquan-box-partition").html(function(e){var t=$("#daquan-box-partition").attr("data-defaultDisk");if(e.length<=1&&e[0].length<=0)return'<option value="'+t+'-off">'+t+":</option>";var n="";for(var r=0;r<e.length;r++)e[r]==t?n+='<option value="'+e[r]+'-off" selected>'+e[r]+":</option>":n+='<option value="'+e[r]+'-off">'+e[r]+":</option>";return n}(this._path2Array($($("#daquan-box-select option")[$("#daquan-box-select")[0].selectedIndex]).attr("data-path")))),$("#daquan-download-path").val($("#daquan-box-partition").attr("data-defaultPath")),XRD.dispatch("daquanRefreshBoxRemainSpace");return}if(this._boxSpace[e]){var r=$("#daquan-box-partition").attr("data-defaultDisk"),s=this._boxSpace[e],o="",u=s.length;if(u<=0)o+='<option value="'+r+'-noDisk">'+r+":</option>";else for(var a=0;a<s.length;a++)s[a].path==r?o+='<option value="'+s[a].path+"-"+s[a].remain+'" selected>'+s[a].path+":</option>":o+='<option value="'+s[a].path+"-"+s[a].remain+'">'+s[a].path+":</option>";$("#daquan-box-partition").html(o),$("#daquan-download-path").val($("#daquan-box-partition").attr("data-defaultPath")),XRD.dispatch("daquanRefreshBoxRemainSpace")}else Protocol.boxSpace(e,function(t){t.rtn==0&&(t.pid=e,XRD.dispatch("daquanRefreshBoxSpaceCache",t))})}else Protocol.getConfig(e,function(t){t.pid=e,XRD.dispatch("daquanRefreshBoxDefaultPathCache",t)})},refreshBoxRemainSpace:function(){if(!$("#daquan-box-partition").val()){$("#daquan-box-remain-space").attr("data-space",-1).html('<span style="color:#f00;">没有检测到外接存储设备</span>');return}var e=$("#daquan-box-partition").val().split("-");if(e[1]==="off")$("#daquan-box-remain-space").html('<span style="color:#f00;">下载器不在线</span>').attr("data-space",-2);else if(e[1]==="noDisk")$("#daquan-box-remain-space").html('<span style="color:#f00;">没有检测到外接存储设备</span>').attr("data-space",-1);else{var t=Helper.byte2Size(e[1],2);$("#daquan-box-remain-space").html("剩余空间："+t).attr("data-space",e[1])}XRD.dispatch("daquanRefreshBoxPercentBar")},refreshBoxNeedSpace:function(){var e=$("#daquan-download-file-list input[type=checkbox]"),t=0;for(var n=1;n<e.length;n++){var r=e[n];r.checked&&(t+=this._size2Byte($(r).attr("data-size"))),n%2?$(r).parent().parent().parent().parent().removeClass("hoverbg"):$(r).parent().parent().parent().parent().addClass("hoverbg")}$("#daquan-box-need-space").html(Helper.byte2Size(t,2)).attr("data-space",t),XRD.dispatch("daquanRefreshBoxPercentBar")},refreshBoxSpacePercent:function(){var e=$("#daquan-box-remain-space").attr("data-space");if($("#daquan-box-need-space").attr("data-space")<=0){$("#pop-daquantask-message").html(""),$("#daquan-box-space-percent").css({width:"0%"}),$("#daquan-box-begin-download").addClass("btn_gary").data("allow",0);return}if(e==-1)$("#pop-daquantask-message").html("当有外接存储设备时添加的任务将自动开始下载"),$("#daquan-box-space-percent").css({width:"0%"}),$("#daquan-box-begin-download").removeClass("btn_gary").data("allow",1);else if(e==-2)$("#pop-daquantask-message").html("当下载器在线时添加的任务将自动开始下载"),$("#daquan-box-space-percent").css({width:"0%"}),$("#daquan-box-begin-download").removeClass("btn_gary").data("allow",1);else{if(e<=0)var t=100;else var t=Math.ceil($("#daquan-box-need-space").attr("data-space")/e*100);t>=100?($("#pop-daquantask-message").html("下载器空间不足"),$("#daquan-box-space-percent").css({width:"100%"}),$("#daquan-box-begin-download").addClass("btn_gary").data("allow",0)):($("#pop-daquantask-message").html(""),$("#daquan-box-space-percent").css({width:t+"%"}),$("#daquan-box-begin-download").removeClass("btn_gary").data("allow",1))}},beginDownload:function(){if($("#daquan-box-begin-download").data("allow")<=0)return;var e=$("#daquan-box-select").val(),t=$("#daquan-box-partition").val().split("-",1),n=$("#daquan-download-path").val().replace(/\\/g,"/");n=n.replace(/(^\s*)|(\s*$)/g,""),n=n.replace(/\/+/g,"/"),n==""&&(n="/"),n=t[0]+":"+n;var r=/^[a-zA-Z]\:\/([^\/:*?"<>|\\]+\/{0,1})*$/i;if(!r.test(n)){alert('路径有误或者含有非法字符 \\ : * ? " < > |');return}var i=function(){var e=$("#daquan-download-file-list input[type=checkbox]"),t=[],n="",r="";for(var i=0;i<e.length;i++)$(e[i]).attr("data-url")&&$(e[i]).attr("checked")&&(n=$(e[i]).attr("data-url"),r=n.lastIndexOf("."),r<0?r="":r=n.substr(r),r.length>5&&(r=""),t.push({url:n,name:$(e[i]).attr("data-taskname")+r,gcid:"",cid:"",filesize:0}));return t}(),s=function(e,t){if(e==0){var t=t.tasks,n=t.length,r=0,i=null;for(var s=0;s<n;s++){var o=t[s];i=$("#daquan-download-file-list [data-url='"+o.url+"']").parent().parent().parent().parent(),o.result==0?i.remove():r==0&&(r=o.result)}r==0?(XRD.dispatch("message","大全任务创建成功。"),XRD.dispatch("daquanCloseLayer")):r==202?(XRD.dispatch("daquanRefreshBoxNeedSpace"),$("#pop-daquantask-message").html("创建任务失败：下载器中已存在相同的任务")):(XRD.dispatch("daquanRefreshBoxNeedSpace"),$("#pop-daquantask-message").html("创建任务失败：错误 #"+r))}else $("#pop-daquantask-message").html("创建任务失败：错误 #"+e)};if(XRD.info.downloaderList[e].accesscode&&!XRD.getPassed(e)){XRD.dispatch("popAccessCode",e,function(){XRD.dispatch("message","大全任务创建中……"),Protocol.createTask($("#daquan-box-select").val(),n,i,s)});return}XRD.dispatch("message","大全任务创建中……"),Protocol.createTask(e,n,i,s)},_hotKey:function(e){e.keyCode==27&&XRD.dispatch("daquanCloseLayer")},_refreshBoxSpaceCache:function(e,t){this._boxSpace[t.pid]=t.space,XRD.dispatch("daquanRefreshBoxInfo")},_refreshBoxDefaultPathCache:function(e,t){t.defaultPath?this._boxDefaultPath[t.pid]=t.defaultPath:this._boxDefaultPath[t.pid]="C:/TDDOWNLOAD/",XRD.dispatch("daquanRefreshBoxInfo")},_size2Byte:function(e){var e=e.toUpperCase(),t=e.substr(e.length-2);e=e.substr(0,e.length-2);switch(t){case"KB":e*=1024;break;case"MB":e*=1048576;break;case"GB":e*=1073741824;break;default:e=null}return e?e:NaN},_path2Array:function(e){var t=function(e){var t=[],n=1;for(var r=0;r<e.length;r++){n=1;for(var i=0;i<t.length;i++)if(e[i]==e[r]){n=0;break}n&&t.push(e[r])}return t};e.substr(e.length-1)===";"&&(e=e.substr(0,e.length-1));var n=e.split(";");for(var r=0;r<n.length;r++)n[r]=n[r].replace(/^\s+|\s+$/g,""),n[r].substr(1,1)===":"?n[r]=n[r].substr(0,1).toUpperCase():n[r]=n[r].substr(0,2).toUpperCase();return t(n)}})
XRD.attach("PopHint",{init:function(){XRD.on("popHintOpen",this.open,this),XRD.on("popHintClose",this.close,this),XRD.on("popHint",this.popHint,this),XRD.on("popHintOffline",this.popHintOffline,this),XRD.on("popHintNoStorage",this.popHintNoStorage,this),$("#pop-hint").css("top",$(window).height()/2+"px").css("left",$(window).width()/2+"px").css("margin-top",0-$("#pop-hint").height()/2).css("margin-left",0-$("#pop-hint").width()/2)},open:function(e){XRD.dispatch("showBgMask"),$("#pop-hint").fadeIn("fast")},close:function(e){XRD.dispatch("hideBgMask"),$("#pop-hint").fadeOut("normal")},popHint:function(e,t,n){$("#pop-hint-message1").html(t),$("#pop-hint-message2").html(n),XRD.dispatch("popHintOpen")},popHintOffline:function(e){XRD.dispatch("popHint","您所选择的下载器没有连接到网络，无法进行任务的下载和操作。","您可以先建立下载任务，在下载器联网或开机后建立的任务将自动开始下载。")},popHintNoStorage:function(e){XRD.dispatch("popHint","您所选择的下载器没有检测到外接硬盘，无法进行任务的下载和操作。","您可以先建立下载任务，在连接硬盘后后建立的任务将自动开始下载。")}})
XRD.attach("PopBind",{init:function(){this.show=!1,this.binding=!1,XRD.on("popBindOpen",this.open,this),XRD.on("popBindClose",this.close,this),XRD.on("popBindOkay",this.okay,this),XRD.on("popBindNoDownloader",this.noDownloader,this),XRD.on("popBindShowVDActive",this.showVDActive,this),XRD.on("popAddDownloader",this.open,this),XRD.on("rDownloaderAdded",this.downloaderAdded,this),XRD.on("rDownloaderAddFailed",this.downloaderAddFailed,this);var e=this;$("#pop-bind").css("top",$(window).height()/2+"px").css("left",$(window).width()/2+"px").css("margin-top",0-$("#pop-bind").height()/2).css("margin-left",0-$("#pop-bind").width()/2),$("#pop-bind-tab-title").children().click(function(){$("#pop-bind-tab-content").children().hide().eq($(this).index()).show(),$(this).addClass("on").siblings().removeClass("on"),$("#pop-bind-tab-bottom > span").hide().eq($(this).index()).show(),$("#pop-bind-tab-content input[data-field]").val(""),$("#pop-bind-tab-content [data-field=hint]").html(""),e.binding=!1}),$("#pop-bind-tab-content input[data-field]").click(function(){$("#pop-bind-tab-content [data-field=hint]").html("")}),$("#pop-bind-tab-content input[data-field]").keyup(function(){e.binding=!1,$("#pop-bind-tab-content [data-field=hint]").html("")})},open:function(e){$("#pop-bind-tab-title").children().eq(0).addClass("on").siblings().removeClass("on"),$("#pop-bind-tab-content").children().hide().eq(0).show(),$(this).addClass("on").siblings().removeClass("on"),$("#pop-bind-tab-bottom > span").hide().eq(0).show(),XRD.dispatch("showBgMask"),$("#pop-bind").fadeIn("fast"),this.show=!0},close:function(e){XRD.dispatch("hideBgMask"),$("#pop-bind").fadeOut("normal"),$("#pop-bind-tab-content input[data-field]").val(""),$("#pop-bind-tab-content [data-field=hint]").html(""),this.show=!1},okay:function(e){var t=this;if(t.binding)return!1;t.binding=!0,setTimeout(function(){t.binding=!1},1e3);var n=$("#pop-bind-tab-title").children(".on").index(),r="";switch(n){case 1:r=$("#pop-bind input[data-field=key1]").val();break;case 2:r=$("#pop-bind input[data-field=key2]").val();break;case 3:r=$("#pop-bind input[data-field=key3]").val()}if(n===1||n===2||n===3){if(r.length==0){$("#pop-bind-tab-content [data-field=hint]").html("请输入激活码");return}if(r.length<6){$("#pop-bind-tab-content [data-field=hint]").html("激活码长度为6位或10位");return}if(!/^[0-9a-zA-Z\:@#\$]+$/.test(r)){$("#pop-bind-tab-content [data-field=hint]").html("激活码字符有误");return}$("#pop-bind-tab-content [data-field=hint]").html("正在绑定……"),XRD.dispatch("rAddDownloader",r)}else XRD.dispatch("popBindClose")},noDownloader:function(e){XRD.dispatch("popBindClose"),XRD.dispatch("popInstructorOpen")},showVDActive:function(e){XRD.dispatch("popBindClose"),XRD.dispatch("popVDActiveOpen")},downloaderAdded:function(e,t){XRD.dispatch("message","下载器绑定成功"),XRD.dispatch("popBindClose");if(t.present_vip==1){var n="";t.vip_type==1?n+="您已成功领取迅雷白金会员":n+="您已成功领取迅雷普通会员",t.send_type==1?n+=t.num+"天，":n+=t.num+"个月，",n+="可以享有远程下载高速通道和离线下载两项特权，详情请登录迅雷官网会员中心查看！",XRD.dispatch("popBindVip",n),XRD.info.uservip>0||(XRD.info.uservip=1,XRD.modules.LiXian.init.call(XRD.modules.LiXian))}},downloaderAddFailed:function(e,t){t==62?($("#pop-bind-tab-content [data-field=hint]").html("绑定超过最大值"),this.show||XRD.dispatch("message","下载器绑定失败：绑定超过最大值")):t==63?($("#pop-bind-tab-content [data-field=hint]").html("绑定失败，已经绑定到其它用户"),this.show||XRD.dispatch("message","下载器绑定失败：已经绑定到其它用户")):t==106?($("#pop-bind-tab-content [data-field=hint]").html("绑定失败，请重新进入电视激活码界面获取激活码"),this.show||XRD.dispatch("message","下载器绑定失败：请重新进入电视激活码界面获取激活码")):($("#pop-bind-tab-content [data-field=hint]").html("绑定失败，请重新输入"),this.show||XRD.dispatch("message","下载器绑定失败：激活码错误"))}})
XRD.attach("PopInstructor",{init:function(){XRD.on("popInstructorOpen",this.open,this),XRD.on("popInstructorClose",this.close,this),XRD.on("popInstructorOkay",this.okay,this),$("#pop-instructor").css("top",$(window).height()/2+"px").css("left",$(window).width()/2+"px").css("margin-top",0-$("#pop-instructor").height()/2).css("margin-left",0-$("#pop-instructor").width()/2),$("#pop-instructor-tab-title").children().click(function(){$("#pop-instructor-tab-content").children().hide().eq($(this).index()).show(),$(this).children("a").addClass("on"),$(this).siblings().children("a").removeClass("on")})},open:function(e){XRD.dispatch("showBgMask"),$("#pop-instructor").fadeIn("fast")},close:function(e){XRD.dispatch("hideBgMask"),$("#pop-instructor").fadeOut("normal")},okay:function(e){var t=$("#pop-instructor-tab-title a.on").parent().index();XRD.dispatch("popInstructorClose");switch(t){case 0:break;case 1:break;case 2:XRD.dispatch("popVDPageOpen")}}})
XRD.attach("PopConfig",{init:function(){this.loading=!1,XRD.on("popConfigOpen",this.open,this),XRD.on("popConfigClose",this.close,this),XRD.on("popConfigOkay",this.okay,this),XRD.on("popConfigReset",this.reset,this),XRD.on("popConfigDownloader",this.configDownloader,this),XRD.on("rDownloaderConfig",this.updateConfig,this),XRD.on("rGetDownloaderConfigFailed",this.getConfigFailed,this),XRD.on("rConfDownloaderSpace",this.cofDownloaderSpace,this),XRD.on("rConfDownloaderSpaceFailed",this.cofDownloaderSpaceFailed,this),XRD.on("rDownloaderConfigSuccess",this.downloaderConfigSuccess,this),$("#pop-config").css("top",$(window).height()/2+"px").css("left",$(window).width()/2+"px").css("margin-top",0-$("#pop-config").height()/2).css("margin-left",0-$("#pop-config").width()/2);for(var e=0;e<=24;e++)e<24&&$("#pop-config [data-field=slStartTime]").append('<option value="'+e+'">'+e+"</option>"),e>0&&$("#pop-config [data-field=slEndTime]").append('<option value="'+e+'">'+e+"</option>");$("#pop-config-download-limit-switch").click(function(){$(this).attr("checked")?($("#pop-config [data-field=slStartTime]").removeAttr("disabled"),$("#pop-config [data-field=slEndTime]").removeAttr("disabled"),$("#pop-config [data-field=downloadSpeedLimit]").removeAttr("disabled")):($("#pop-config [data-field=slStartTime]").attr("disabled",!0),$("#pop-config [data-field=slEndTime]").attr("disabled",!0),$("#pop-config [data-field=downloadSpeedLimit]").attr("disabled",!0))}),$("#pop-config-download-disks").change(function(e){var t=Helper.toNumber(this.value),n=$("#pop-config-download-dir"),r=this.selectedIndex;if(r<0)return;var i=this.options[r];(new RegExp("^"+$(this).attr("data-defaultDisk")+":?$")).test($(i).text())?n.val($(this).attr("data-defaultdir")):n.val("/TDDOWNLOAD/"),$("#pop-config-download-space").html(Helper.byte2Size(t,2))})},open:function(e){XRD.dispatch("showBgMask"),$("#pop-config").fadeIn("fast")},close:function(e){XRD.dispatch("hideBgMask"),$("#pop-config").fadeOut("normal")},okay:function(e){var t={pid:this.pid};t.maxRunTaskNumber=$("#pop-config [data-field=maxRunTaskNumber]").val(),t.slStartTime=$("#pop-config [data-field=slStartTime]").val(),t.slEndTime=$("#pop-config [data-field=slEndTime]").val(),Math.abs(t.slStartTime-t.slEndTime)==24?(t.slStartTime=0,t.slEndTime=1440):(t.slStartTime=Helper.toNumber(t.slStartTime)+(new Date).getTimezoneOffset()/60,t.slEndTime=Helper.toNumber(t.slEndTime)+(new Date).getTimezoneOffset()/60,t.slStartTime=(t.slStartTime<0?t.slStartTime+24:t.slStartTime)*60,t.slEndTime=(t.slEndTime<0?t.slEndTime+24:t.slEndTime)*60);if($("#pop-config-download-limit-switch").attr("checked")){if(!XRD.info.downloaderList[this.pid].isLite&&XRD.info.downloaderList[this.pid].clientVersion&&XRD.info.downloaderList[this.pid].clientVersion>=400){if(t.slStartTime==t.slEndTime){alert("限速时点不能相同！");return}var n=+$("#pop-config [data-field=downloadSpeedLimit]").last().val()}else var n=+$("#pop-config [data-field=downloadSpeedLimit]").first().val();if(!(!isNaN(n)&&+n>0)){alert("不正确的下载限速值，请重新输入！");return}t.downloadSpeedLimit=n}else t.downloadSpeedLimit=-1,t.slStartTime=0,t.slEndTime=1440;t.uploadSpeedLimit=-1,$("#pop-config [data-field=autoDlSubtitle]").attr("checked")?t.autoDlSubtitle=1:t.autoDlSubtitle=0,XRD.info.uservip>0&&($("#pop-config [data-field=autoOpenLixian]").attr("checked")?t.autoOpenLixian=1:t.autoOpenLixian=0,$("#pop-config [data-field=autoOpenVip]").attr("checked")?t.autoOpenVip=1:t.autoOpenVip=0);if(!XRD.info.downloaderList[this.pid].isLite&&XRD.info.downloaderList[this.pid].clientVersion&&XRD.info.downloaderList[this.pid].clientVersion>=403){var r=$("#pop-config-download-disks"),i=r[0],s=i.selectedIndex,o="";s>=0&&(o=i.options[s].text);if(!o)var u=r.attr("data-defaultDisk")+":"+r.attr("data-defaultDir");else{var a=$("#pop-config-download-dir").val();a=a.replace(/(^\s*)|(\s*$)/g,""),a=a.replace(/\/+/g,"/");if(a==""||a=="/")var u=o+"/TDDOWNLOAD/";else{var u=o+a;u.substr(u.length-1,1)!="/"&&(u+="/");var f=/^[a-z]\:\/([^\/:*?"<>|\\]+\/)+$/i;if(!f.test(u)){alert('路径含有非法字符 \\ : * ? " < > |');return}}}t.defaultPath=u}XRD.info.downloaderList[this.pid].config=t,XRD.dispatch("message","正在更新设置参数……"),XRD.dispatch("rConfigDownloader",t,"config"),XRD.dispatch("popConfigClose")},reset:function(){this.loading=!1,$("#pop-config-message").html(""),$("#pop-config-submit").removeClass("btn_gary").data("disabled","0"),$("#pop-config [data-field=maxRunTaskNumber] option").removeAttr("selected"),$("#pop-config-download-limit-switch").removeAttr("checked"),$("#pop-config [data-field=slStartTime]").attr("disabled",!0),$("#pop-config [data-field=slStartTime] option").removeAttr("selected"),$("#pop-config [data-field=slEndTime]").attr("disabled",!0),$("#pop-config [data-field=slEndTime] option").removeAttr("selected"),$("#pop-config [data-field=downloadSpeedLimit]").attr("disabled",!0).val(""),$("#pop-config [data-field=autoDlSubtitle]").removeAttr("checked"),$("#pop-config [data-field=autoOpenLixian]").removeAttr("checked"),$("#pop-config [data-field=autoOpenVip]").removeAttr("checked")},updateConfig:function(e,t){this.loading=!1,Math.abs(t.slStartTime-t.slEndTime)==1440?(t.slStartTime=0,t.slEndTime=24):(t.slStartTime=Math.floor(t.slStartTime/60)-(new Date).getTimezoneOffset()/60,t.slEndTime=Math.floor(t.slEndTime/60)-(new Date).getTimezoneOffset()/60,t.slStartTime=t.slStartTime>=24?t.slStartTime-24:t.slStartTime,t.slEndTime=t.slEndTime>24?t.slEndTime-24:t.slEndTime),$("#pop-config-submit").removeClass("btn_gary").data("disabled","0"),XRD.info.downloaderList[this.pid].config=t;var n=t.defaultPath;if(Helper.isString(n)&&n!=""){var r=t.defaultPath.split(":"),i=r[0];XRD.info.downloaderList[this.pid].defaultDisk=i;var s=n.replace(new RegExp("^"+i+":?"),"")||"/TDDOWNLOAD/"}else{var i="C";XRD.info.downloaderList[this.pid].defaultDisk="C";var s="/TDDOWNLOAD/"}$("#pop-config-download-disks").attr("data-defaultDisk",i),$("#pop-config-download-disks").attr("data-defaultDir",s),$("#pop-config-download-dir").val(s),$("#pop-config [data-field=maxRunTaskNumber] option").each(function(e){$(this).val()==t.maxRunTaskNumber&&($(this).siblings().removeAttr("selected"),$(this).attr("selected",!0))}),t.downloadSpeedLimit==-1?($("#pop-config-download-limit-switch").removeAttr("checked"),$("#pop-config [data-field=downloadSpeedLimit]").val(""),$("#pop-config [data-field=slStartTime] > option:first").attr("selected",!0),$("#pop-config [data-field=slEndTime] > option:last").attr("selected",!0),$("#pop-config [data-field=slStartTime]").attr("disabled",!0),$("#pop-config [data-field=slEndTime]").attr("disabled",!0),$("#pop-config [data-field=downloadSpeedLimit]").attr("disabled",!0)):($("#pop-config-download-limit-switch").attr("checked",!0),$("#pop-config [data-field=slStartTime]").removeAttr("disabled"),$("#pop-config [data-field=slStartTime] option[value="+t.slStartTime+"]").attr("selected",!0).siblings().removeAttr("selected"),$("#pop-config [data-field=slEndTime]").removeAttr("disabled"),$("#pop-config [data-field=slEndTime] option[value="+t.slEndTime+"]").attr("selected",!0).siblings().removeAttr("selected"),$("#pop-config [data-field=downloadSpeedLimit]").val(t.downloadSpeedLimit),$("#pop-config [data-field=downloadSpeedLimit]").removeAttr("disabled"));if(!XRD.info.downloaderList[this.pid].isLite&&XRD.info.downloaderList[this.pid].clientVersion&&XRD.info.downloaderList[this.pid].clientVersion>=403){var o=$("#pop-config-download-disks option").length;for(var u=0;u<o;u++)if($("#pop-config-download-disks").get(0).options[u].text==i+":"){$("#pop-config-download-disks").get(0).options[u].selected=!0;break}$("#pop-config-download-disks").trigger("change")}t.autoDlSubtitle==1?$("#pop-config [data-field=autoDlSubtitle]").attr("checked",!0):$("#pop-config [data-field=autoDlSubtitle]").removeAttr("checked"),XRD.info.uservip>0&&(t.autoOpenLixian?$("#pop-config [data-field=autoOpenLixian]").attr("checked",!0):$("#pop-config [data-field=autoOpenLixian]").removeAttr("checked"),t.autoOpenVip?$("#pop-config [data-field=autoOpenVip]").attr("checked",!0):$("#pop-config [data-field=autoOpenVip]").removeAttr("checked"))},configDownloader:function(e,t){this.loading=!0,this.pid=t;var n=XRD.info.downloaderList[t].company?XRD.info.downloaderList[t].company:"未知设备",r=XRD.info.downloaderList[t].deviceVersion?XRD.info.downloaderList[t].deviceVersion.toString():"";if(r!=""){var i=r.split(""),s=i.length,o=1,u="";if(s==8)for(var a=s-1;a>=0;a--){if(o==4||o==5||o==8)u="."+u;u=i[a]+u,o++}else if(s==7)for(var a=s-1;a>=0;a--)o==4||o==5?u=i[a]+"."+u:o==6?u="."+u:u=i[a]+u,o++;else u=r}else var u="未知版本";$("#downloader-type").html(n),$("#downloader-version").html(u),$("#pop-config-submit").addClass("btn_gary").data("disabled","1"),XRD.dispatch("popConfigReset"),XRD.dispatch("rGetDownloaderConfig",t,"config"),$("#pop-config-downloader-name").html(XRD.info.downloaderList[t].name),XRD.info.uservip>0?($("#pop-config [data-field=autoOpenLixian]").removeAttr("disabled"),$("#pop-config [data-field=autoOpenVip]").removeAttr("disabled")):($("#pop-config [data-field=autoOpenLixian]").attr("disabled",!0),$("#pop-config [data-field=autoOpenVip]").attr("disabled",!0)),!XRD.info.downloaderList[t].isLite&&XRD.info.downloaderList[t].clientVersion&&XRD.info.downloaderList[t].clientVersion>=400?($("#pop-config-scheduled-limit").show(),$("#pop-config-old-limit").hide()):($("#pop-config-scheduled-limit").hide(),$("#pop-config-old-limit").show()),!XRD.info.downloaderList[t].isLite&&XRD.info.downloaderList[t].clientVersion&&XRD.info.downloaderList[t].clientVersion>=401?$("#pop-config-auto-dl-subtitle").show():$("#pop-config-auto-dl-subtitle").hide(),$("#pop-config-download-default-path").hide(),!XRD.info.downloaderList[t].isLite&&XRD.info.downloaderList[t].clientVersion&&XRD.info.downloaderList[t].clientVersion>=403&&XRD.dispatch("rGetDownloaderSpace",t,"config"),XRD.dispatch("popConfigOpen")},getConfigFailed:function(e,t){this.loading=!1,t==108&&($("#pop-config-message").html("该下载器版本不支持自动开启离线高速功能"),$("#pop-config-submit").addClass("btn_gary").data("disabled","1"))},cofDownloaderSpace:function(e,t){var n=XRD.info.downloaderList[this.pid],r=$("#pop-config-download-disks"),i=$("#pop-config-download-dir"),s=[],o=r.attr("data-defaultDisk");if(Helper.isArray(t)&&t.length>0){for(var u=0,a=t.length;u<a;u++)o===t[u].path?s.push('<option value="'+Helper.toNumber(t[u].remain)+'" selected>'+t[u].path+":</option>"):s.push('<option value="'+Helper.toNumber(t[u].remain)+'">'+t[u].path+":</option>");$("#pop-config-download-default-path").show(),r.html(s.join("")).trigger("change")}else $("#pop-config-download-default-path").hide()},cofDownloaderSpaceFailed:function(e,t){this.loading=!1,$("#pop-config-download-default-path").hide(),t==101&&this.cofDownloaderSpace()},downloaderConfigSuccess:function(e,t){var n=t.defaultPath;if(Helper.isString(n)&&n!=""){var r=n.split(":"),i=r[0];XRD.info.downloaderList[this.pid].defaultDisk=i}else XRD.info.downloaderList[this.pid].defaultDisk="C"}})
XRD.attach("PopRemove",{init:function(){this.dispatchMessage="popRemoveClose",this.dispatchData=null,XRD.on("popRemoveOpen",this.open,this),XRD.on("popRemoveClose",this.close,this),XRD.on("popRemoveOkay",this.okay,this),XRD.on("popRemoveDownloader",this.removeDownloader,this),XRD.on("popRemoveTask",this.removeTask,this),XRD.on("popClearRecycledTasks",this.clearRecycledTasks,this),$("#pop-remove").css("top",$(window).height()/2+"px").css("left",$(window).width()/2+"px").css("margin-top",0-$("#pop-remove").height()/2).css("margin-left",0-$("#pop-remove").width()/2)},open:function(e,t){XRD.dispatch("showBgMask"),$("#pop-remove").fadeIn("fast")},close:function(e){XRD.dispatch("hideBgMask"),$("#pop-remove").fadeOut("normal")},okay:function(e){XRD.dispatch("popRemoveClose");switch(this.dispatchMessage){case"rRemoveDownloader":XRD.dispatch(this.dispatchMessage,this.dispatchData);break;case"rRemoveTasks":$("#pop-remove-files").attr("checked")?this.dispatchData.deleteFiles=!0:this.dispatchData.deleteFiles=!1,XRD.dispatch("message","正在删除所选任务……"),XRD.dispatch(this.dispatchMessage,this.dispatchData.taskIds,this.dispatchData.deleteFiles);break;case"rRecycleTasks":$("#pop-remove-files").attr("checked")?this.dispatchData.deleteFiles=!0:this.dispatchData.deleteFiles=!1,XRD.dispatch("message","正在删除所选任务……"),XRD.dispatch(this.dispatchMessage,this.dispatchData.taskIds,this.dispatchData.deleteFiles);break;case"rClearTasks":$("#pop-remove-files").attr("checked")?this.dispatchData=!0:this.dispatchData=!1,XRD.dispatch("message","正在清空垃圾箱……"),XRD.dispatch(this.dispatchMessage,this.dispatchData)}},removeDownloader:function(e,t){$("#pop-remove-message").html("你确定要删除该下载器么？删除后将无法通过远程下载向此下载器添加任务。如果是虚拟下载器，则解除绑定后，您需要重新启动迅雷7才能完成操作。"),$("#pop-remove-subinfo").html(""),this.dispatchMessage="rRemoveDownloader",this.dispatchData=t,XRD.dispatch("popRemoveOpen")},removeTask:function(e,t){Helper.isArray(t)||(t=XRD.info.selectedTasks),!XRD.info.downloaderList[XRD.info.currentDownloader].isLite&&XRD.info.downloaderList[XRD.info.currentDownloader].clientVersion&&XRD.info.downloaderList[XRD.info.currentDownloader].clientVersion>=400?$("#pop-remove-message").html("您确定要删除所选择的任务么？"):$("#pop-remove-message").html("您确定要删除所选择的任务么？您的下载器版本较低，无法使用垃圾箱功能，删除这些任务同时会删除已下载文件。"),!XRD.info.downloaderList[XRD.info.currentDownloader].isLite&&XRD.info.downloaderList[XRD.info.currentDownloader].clientVersion&&XRD.info.downloaderList[XRD.info.currentDownloader].clientVersion>=400?XRD.info.currentTaskType=="rShowRecycledTasks"||XRD.info.currentTaskType=="rShowFailedTasks"?($("#pop-remove-subinfo").html('<label for="pop-remove-files"><input type="checkbox" checked id="pop-remove-files" /> 同时删除文件</label>'),this.dispatchMessage="rRemoveTasks",this.dispatchData={taskIds:t,deleteFiles:!0}):($("#pop-remove-subinfo").html('<label for="pop-remove-files"><input type="checkbox" id="pop-remove-files" /> 同时删除文件</label>'),this.dispatchMessage="rRecycleTasks",this.dispatchData={taskIds:t,deleteFiles:!1}):($("#pop-remove-subinfo").html('<label for="pop-remove-files"><input type="checkbox" checked id="pop-remove-files" /> 同时删除文件</label>'),this.dispatchMessage="rRemoveTasks",this.dispatchData={taskIds:t,deleteFiles:!0}),XRD.dispatch("popRemoveOpen")},clearRecycledTasks:function(e){$("#pop-remove-message").html("是否删除垃圾箱中的所有任务？"),$("#pop-remove-subinfo").html('<label for="pop-remove-files"><input type="checkbox" checked id="pop-remove-files" /> 同时删除文件</label>'),this.dispatchMessage="rClearTasks",this.dispatchData=!0,XRD.dispatch("popRemoveOpen")}})
XRD.attach("PopRename",{init:function(){XRD.on("popRenameOpen",this.open,this),XRD.on("popRenameClose",this.close,this),XRD.on("popRenameOkay",this.okay,this),XRD.on("popRenameDownloader",this.renameDownloader,this),XRD.on("rDownloaderRenamed",this.downloaderRenamed,this),XRD.on("rDownloaderRenameFailed",this.downloaderRenameFailed,this),$("#pop-rename").css("top",$(window).height()/2+"px").css("left",$(window).width()/2+"px").css("margin-top",0-$("#pop-rename").height()/2).css("margin-left",0-$("#pop-rename").width()/2)},open:function(e){XRD.dispatch("showBgMask"),$("#pop-rename").fadeIn("fast")},close:function(e){XRD.dispatch("hideBgMask"),$("#pop-rename").fadeOut("normal")},okay:function(e){var t=$("#pop-rename-pid").val(),n=$("#pop-rename-name").val(),r=/[<>&?#]/g;if(n&&r.test(n)){alert("下载器名称含有非法字符 < > & ? #");return}Helper.isString(n)&&n.length>0?(XRD.dispatch("popRenameClose"),XRD.dispatch("rRenameDownloader",{pid:t,name:n})):alert("下载器名称不能为空！")},renameDownloader:function(e,t){$("#pop-rename-pid").val(t),$("#pop-rename-name").val(XRD.info.downloaderList[t].name),XRD.dispatch("popRenameOpen")}})
XRD.attach("PopNewTask",{init:function(){this.index=0,this.online=!0,this.storage=!0,this.loading=!1,this.checking=!1,this.checkable=!1,this.availableSpace=0,this.requiredSpace=0,this.validUrl=!0,this.url="",this.multiUrl="",this.checkUrlHandle=null,this.defaultDisk="C",XRD.on("popNewTaskOpen",this.open,this),XRD.on("popNewTaskClose",this.close,this),XRD.on("popNewTaskOkay",this.okay,this),XRD.on("popNewTaskReset",this.reset,this),XRD.on("popNewTaskRefresh",this.refresh,this),XRD.on("popNewTaskCheckUrl",this.checkUrl,this),XRD.on("popCreateTask",this.createTask,this),XRD.on("popImportTasks",this.importTasks,this),XRD.on("rDownloaderSpace",this.downloaderSpace,this),XRD.on("rDownloaderSpaceFailed",this.downloaderSpaceFailed,this),XRD.on("rUrlInfo",this.urlInfo,this),XRD.on("rCheckUrlFailed",this.checkUrlFailed,this),XRD.on("rTaskCreated",this.createTaskSuccess,this),XRD.on("rBtTaskCreated",this.createTaskSuccess,this),XRD.on("rMultiTaskCreated",this.createTaskSuccess,this),XRD.on("rTaskCreateFailed",this.createTaskFailed,this),XRD.on("rBtTaskCreateFailed",this.createTaskFailed,this),XRD.on("rMultiTaskCreateFailed",this.createTaskFailed,this),XRD.on("rTaskDownloaderConfig",this.taskDownloaderConfig,this),XRD.on("rTaskGetDownloaderConfigFailed",this.taskDownloaderConfigFailed,this),XRD.on("popBtAutoSelect",this.autoSelect,this),XRD.on("rCreateTaskCallback",this.createTaskCallback,this);var e=this;$("#pop-newtask").css("top","100px").css("left",$(window).width()/2+"px").css("margin-left",0-$("#pop-newtask").width()/2),$("#pop-newtask-tab-title").children().click(function(){e.index=$(this).index(),$("#pop-newtask-tab-content").children().hide().eq($(this).index()).show(),$(this).addClass("on").siblings().removeClass("on"),XRD.dispatch("popNewTaskReset")}),$("#pop-newtask-url, #pop-newtask-multi-url").bind("keyup paste",function(t){var n=$(this);if(t.type==="paste")setTimeout(function(){if(e.index===0&&!/^(http|https|ftp|magnet|ed2k|thunder|mms|rtsp)\:.+/.test(Helper.trim(n.val()))){$("#pop-newtask-message").html("无效的URL");return}XRD.dispatch("popNewTaskCheckUrl")},100);else{if(e.index===0&&!/^(http|https|ftp|magnet|ed2k|thunder|mms|rtsp)\:.+/.test(Helper.trim(n.val()))){$("#pop-newtask-message").html("无效的URL");return}XRD.dispatch("popNewTaskCheckUrl")}}),$("#pop-newtask-downloaders").change(function(){e.online=XRD.info.downloaderList[$(this).val()].online,e.storage=XRD.info.downloaderList[$(this).val()].storage,e.defaultDisk=XRD.info.downloaderList[$(this).val()].defaultDisk,e.loading=!0,e.availableSpace=0,$("#pop-newtask-status").html(""),$("#pop-newtask-available-space").html(""),$("#pop-newtask-message").html("正在获取磁盘剩余空间……"),XRD.dispatch("rGetDownloaderSpace",$(this).val())}),$("#pop-newtask-disklist").change(function(){var t=this.options[this.selectedIndex],n=$("#pop-newtask-savepath");(new RegExp("^"+$(this).attr("data-defaultDisk")+":?$")).test($(t).text())?n.val($(this).attr("data-defaultPath")):n.val("/TDDOWNLOAD/");var r=$(this).val();e.availableSpace=Helper.toNumber(r),r>=0&&$("#pop-newtask-available-space").html("剩余空间："+Helper.byte2Size(r,2)),XRD.dispatch("popNewTaskRefresh")}),$("#pop-newtask-savepath").keyup(function(){XRD.dispatch("popNewTaskRefresh")}),$("#pop-newtask-bt-file").live("change",function(){$("#pop-newtask-message").html("正在获取BT种子信息……"),Protocol.btCheck(XRD.info.currentDownloader,"pop-newtask-bt-form",function(e,t){if(e==0)XRD.dispatch("rUrlInfo",t),XRD.dispatch("popNewTaskRefresh");else{var n=Protocol.MESSAGE_LIST_TASK_ERRORS[e];Helper.isString(n)?$("#pop-newtask-message").html(n+" #"+e):$("#pop-newtask-message").html("解析BT种子失败 #"+e)}})}),$("#pop-newtask-name").keyup(function(){XRD.dispatch("popNewTaskRefresh")}),$("#pop-newtask-bt-list input[type=checkbox]").live("click",function(){$(this).attr("checked")?$("#pop-newtask-bt-list input[type=checkbox]:checked").size()==$("#pop-newtask-bt-list input[type=checkbox]").size()&&$("#pop-newtask-bt-select-all-checkbox").attr("checked",!0):$("#pop-newtask-bt-select-all-checkbox").removeAttr("checked"),XRD.dispatch("popNewTaskRefresh")}),$("#pop-newtask-bt-select-all-checkbox").click(function(){$(this).attr("checked")?$("#pop-newtask-bt-list input[type=checkbox]").attr("checked",!0):$("#pop-newtask-bt-list input[type=checkbox]").removeAttr("checked"),XRD.dispatch("popNewTaskRefresh")}),$("#pop-newtask-bt-select-all").click(function(){$("#pop-newtask-bt-list input[type=checkbox]").attr("checked",!0),$("#pop-newtask-bt-select-all-checkbox").attr("checked",!0),XRD.dispatch("popNewTaskRefresh")}),$("#pop-newtask-bt-select-inverse").click(function(){$("#pop-newtask-bt-list input[type=checkbox]").each(function(e){$(this).attr("checked")?($(this).removeAttr("checked"),$("#pop-newtask-bt-select-all-checkbox").removeAttr("checked")):($(this).attr("checked",!0),$("#pop-newtask-bt-list input[type=checkbox]:checked").size()==$("#pop-newtask-bt-list input[type=checkbox]").size()&&$("#pop-newtask-bt-select-all-checkbox").attr("checked",!0))}),XRD.dispatch("popNewTaskRefresh")}),$("#pop-newtask-multi-list input[type=checkbox]").live("click",function(){$(this).attr("checked")?$("#pop-newtask-multi-list input[type=checkbox]:checked").size()==$("#pop-newtask-multi-list input[type=checkbox]").size()&&$("#pop-newtask-multi-select-all-checkbox").attr("checked",!0):$("#pop-newtask-multi-select-all-checkbox").removeAttr("checked"),XRD.dispatch("popNewTaskRefresh")}),$("#pop-newtask-multi-select-all-checkbox").click(function(){$(this).attr("checked")?$("#pop-newtask-multi-list input[type=checkbox]").attr("checked",!0):$("#pop-newtask-multi-list input[type=checkbox]").removeAttr("checked"),XRD.dispatch("popNewTaskRefresh")}),$("#pop-newtask-multi-select-all").click(function(){$("#pop-newtask-multi-list input[type=checkbox]").attr("checked",!0),$("#pop-newtask-multi-select-all-checkbox").attr("checked",!0),XRD.dispatch("popNewTaskRefresh")}),$("#pop-newtask-multi-select-inverse").click(function(){$("#pop-newtask-multi-list input[type=checkbox]").each(function(e){$(this).attr("checked")?($(this).removeAttr("checked"),$("#pop-newtask-multi-select-all-checkbox").removeAttr("checked")):($(this).attr("checked",!0),$("#pop-newtask-multi-list input[type=checkbox]:checked").size()==$("#pop-newtask-multi-list input[type=checkbox]").size()&&$("#pop-newtask-multi-select-all-checkbox").attr("checked",!0))}),XRD.dispatch("popNewTaskRefresh")}),$("#pop-newtask-submit").click(function(){$(this).data("disabled")==0&&XRD.dispatch("popNewTaskOkay")})},open:function(e){XRD.dispatch("popNewTaskReset"),this.index=0,this.loading=!1,this.availableSpace=0,$("#pop-newtask-downloaders").html(""),$("#pop-newtask-disklist").html(""),$("#pop-newtask-savepath").val(""),$("#pop-newtask-status").html(""),$("#pop-newtask-available-space").html(""),XRD.dispatch("showBgMask");var t=$(window).height()-$("#pop-newtask").height();t>100?t=100:t<0&&(t=0),t+="px",$("#pop-newtask").fadeIn("fast").css("top",t),$("#pop-newtask-tab-title").children().removeClass().first().addClass("on"),$("#pop-newtask-tab-content").children().hide().first().show(),this.online=XRD.info.downloaderList[XRD.info.currentDownloader].online,this.storage=XRD.info.downloaderList[XRD.info.currentDownloader].storage;for(var n in XRD.info.downloaderList)n==XRD.info.currentDownloader?$("#pop-newtask-downloaders").append('<option value="'+n+'" selected>'+XRD.info.downloaderList[n].name+"</option>"):$("#pop-newtask-downloaders").append('<option value="'+n+'">'+XRD.info.downloaderList[n].name+"</option>");this.online?(this.loading=!0,$("#pop-newtask-message").html("正在获取磁盘剩余空间……"),XRD.dispatch("rGetDownloaderSpace",XRD.info.currentDownloader)):this.downloaderSpace()},close:function(e){XRD.dispatch("hideBgMask"),$("#pop-newtask").fadeOut("normal"),clearInterval(this.checkUrlHandle)},okay:function(e){var t=$("#pop-newtask-downloaders > option:selected").val();if(XRD.info.downloaderList[t].accesscode&&!XRD.getPassed(t)){var n=this;XRD.dispatch("popNewTaskClose"),XRD.dispatch("popAccessCode",t,function(){XRD.dispatch("rSelectDownloader",t,!0),n.okay.call(n,e)});return}XRD.dispatch("message","正在提交新任务……");switch(this.index){case 0:Protocol.createTask($("#pop-newtask-downloaders > option:selected").val(),$("#pop-newtask-disklist > option:selected").html()+$("#pop-newtask-savepath").val(),[{url:Helper.trim($("#pop-newtask-url").val()),name:Helper.trim($("#pop-newtask-name").val()),gcid:"",cid:"",filesize:+$("#pop-newtask-name").attr("data-size")}],function(e,t){e==0?XRD.dispatch("rCreateTaskCallback",t):XRD.dispatch("rTaskCreateFailed",e)});break;case 1:var r=[];$("#pop-newtask-bt-list input[type=checkbox]").each(function(e){$(this).attr("checked")&&r.push(+$(this).data("id"))}),Protocol.createBtTask($("#pop-newtask-downloaders > option:selected").val(),$("#pop-newtask-disklist > option:selected").html()+$("#pop-newtask-savepath").val(),$("#pop-newtask-bt-name").attr("data-infohash"),Helper.trim($("#pop-newtask-bt-name").val()),r,function(e,t){e==0?XRD.dispatch("rBtTaskCreated"):XRD.dispatch("rBtTaskCreateFailed",e)});break;case 2:var i=[];$("#pop-newtask-multi-list input[type=checkbox]").each(function(e){var t=$(this);t.attr("checked")&&i.push({url:Helper.trim(t.data("url")),name:t.attr("data-filename"),gcid:"",cid:"",filesize:+t.attr("data-filesize")})}),Protocol.createTask($("#pop-newtask-downloaders > option:selected").val(),$("#pop-newtask-disklist > option:selected").html()+$("#pop-newtask-savepath").val(),i,function(e,t){e==0?XRD.dispatch("rCreateTaskCallback",t):XRD.dispatch("rTaskCreateFailed",e)})}},reset:function(){this.checking=!1,this.checkable=!1,this.requiredSpace=0,this.validUrl=!0,this.url="",this.multiUrl="",this.loading||$("#pop-newtask-message").html(""),$("#pop-newtask-required-space").html(""),$("#pop-newtask-progress").css("width","0%"),$("#pop-newtask-url, #pop-newtask-name").val(""),$("#pop-newtask-bt-form").html('<label>本地文件：<input type="file" name="filepath" class="t_ipt_f filetxt" id="pop-newtask-bt-file" /></label>'),$("#pop-newtask-name").attr("data-size",0),$("#pop-newtask-bt-name").val(""),$("#pop-newtask-bt-name").attr("data-infohash",""),$("#pop-newtask-bt-list").children().remove(),$("#pop-newtask-bt-details, #pop-newtask-bt-controls").hide(),$("#pop-newtask-multi-url").val(""),$("#pop-newtask-multi-list").children().remove(),$("#pop-newtask-multi-details, #pop-newtask-multi-controls").hide(),$("#pop-newtask-submit").addClass("btn_gary").data("disabled","1")},refresh:function(e){if(this.loading)return;var t=$("#pop-newtask-tab-title .on").index(),n=!1;if(!this.validUrl){$("#pop-newtask-message").html("无效的URL"),$("#pop-newtask-submit").addClass("btn_gary").data("disabled","1");return}switch(t){case 0:if(!$("#pop-newtask-url").val()){$("#pop-newtask-message").html("请输入下载URL");break}if(!/^(http|https|ftp|magnet|ed2k|thunder|mms|rtsp)\:.+/.test(Helper.trim($("#pop-newtask-url").val()))){$("#pop-newtask-message").html("无效的URL");return}if(!$("#pop-newtask-name").val()){$("#pop-newtask-message").html("任务名称不能为空");break}if(/[\\\/:\*\?"<>|]/g.test($("#pop-newtask-name").val())){$("#pop-newtask-message").html('任务名称含有非法字符：\\ / : * ? " < > |');break}n=!!$("#pop-newtask-url").val()&&!!$("#pop-newtask-name").val();break;case 1:var r=0;$("#pop-newtask-bt-list input[type=checkbox]:checked").each(function(e){r+=+$(this).data("filesize")}),this.requiredSpace=r;if(!$("#pop-newtask-bt-file").val()){$("#pop-newtask-message").html("请选择BT种子文件");break}if(!$("#pop-newtask-bt-name").val()){$("#pop-newtask-message").html("任务名称不能为空");break}if($("#pop-newtask-bt-list input[type=checkbox]:checked").size()==0){$("#pop-newtask-message").html("请选择至少一个BT子文件");break}n=!!($("#pop-newtask-bt-file").val()&&$("#pop-newtask-bt-name").val()&&$("#pop-newtask-bt-list input[type=checkbox]:checked").size()>0);break;case 2:var r=0,i=0;$("#pop-newtask-multi-list input[type=checkbox]").each(function(){this.checked&&(r+=+$(this).data("filesize")),i%2?$(this).parent().parent().parent().addClass("hoverbg"):$(this).parent().parent().parent().removeClass("hoverbg"),i++}),this.requiredSpace=r,$("#pop-newtask-multi-count").html($("#pop-newtask-multi-list input[type=checkbox]:checked").size());if(!$("#pop-newtask-multi-url").val()){$("#pop-newtask-message").html("请输入下载URL");break}if($("#pop-newtask-multi-list input[type=checkbox]:checked").size()==0){$("#pop-newtask-message").html("请选择至少一个下载文件");break}n=!!($("#pop-newtask-multi-url").val()&&$("#pop-newtask-multi-list input[type=checkbox]:checked").size()>0)}$("#pop-newtask-required-space").html("所需空间："+Helper.byte2Size(this.requiredSpace,2));if(this.availableSpace>0){var s=Math.floor(this.requiredSpace*100/this.availableSpace);s>100&&(s=100),$("#pop-newtask-progress").css("width",""+s+"%")}if(n){var o=$("#pop-newtask-savepath").val();o=o.replace(/(^\s*)|(\s*$)/g,""),o=o.replace(/\/+/g,"/"),o==""?(n=!1,$("#pop-newtask-message").html("下载路径不能为空")):/^\/([^\/:*?"<>|\\]+\/{0,1})*$/i.test(o)||(n=!1,$("#pop-newtask-message").html('下载路径有误或者含有非法字符 \\ : * ? " < > |')),this.online&&this.storage&&this.requiredSpace>this.availableSpace&&(n=!1,$("#pop-newtask-message").html("下载器空间不足"))}n?(this.online?this.storage?$("#pop-newtask-message").html(""):$("#pop-newtask-message").html("当有外接存储设备时添加的任务将自动开始下载"):$("#pop-newtask-message").html("当下载器在线时添加的任务将自动开始下载"),$("#pop-newtask-submit").removeClass("btn_gary").data("disabled","0")):$("#pop-newtask-submit").addClass("btn_gary").data("disabled","1")},downloaderSpace:function(e,t){this.loading=!1,$("#pop-newtask-message").html(""),$("#pop-newtask-disklist").html("").removeAttr("data-defaultDisk").removeAttr("data-defaultPath");if(Helper.isArray(t)&&t.length>0){for(var n=0;n<t.length;n++)n===0?$("#pop-newtask-disklist").append('<option value="'+t[n].remain+'" selected>'+t[n].path+":"+"</option>"):$("#pop-newtask-disklist").append('<option value="'+t[n].remain+'">'+t[n].path+":"+"</option>");$("#pop-newtask-status").html(""),$("#pop-newtask-disklist").trigger("change"),XRD.dispatch("rGetDownloaderConfig",$("#pop-newtask-downloaders").val())}else if(Helper.isArray(t)&&t.length==0)$("#pop-newtask-disklist").append('<option value="-1">C:</option>'),$("#pop-newtask-available-space").html(""),$("#pop-newtask-status").html("没有检测到外接存储设备"),XRD.dispatch("rGetDownloaderConfig",$("#pop-newtask-downloaders").val());else{var r=$("#pop-newtask-downloaders").val(),i=XRD.info.downloaderList[r].path_list,s=i.split(";"),o=0;for(var n=0;n<s.length;++n){if(s[n]=="")continue;o++,$("#pop-newtask-disklist").append('<option value="-2">'+s[n].split(":")[0]+":</option>")}o<=0&&$("#pop-newtask-disklist").append('<option value="-2">C:</option>'),XRD.dispatch("rGetDownloaderConfig",r),$("#pop-newtask-available-space").html(""),$("#pop-newtask-status").html("下载器不在线")}XRD.dispatch("popNewTaskRefresh")},downloaderSpaceFailed:function(e,t){this.loading=!1,$("#pop-newtask-status").html(""),$("#pop-newtask-message").html(""),t==101&&this.downloaderSpace(),XRD.dispatch("popNewTaskRefresh")},checkUrl:function(e){var t=this;if(this.checking){this.checkable=!0;return}this.checking=!0,this.checkable=!1;if(this.index===0){var n=Helper.trim($("#pop-newtask-url").val());n&&n!=this.url&&(this.url=n,Protocol.urlResolve(XRD.info.currentDownloader,n,function(e,t){e==0?XRD.dispatch("rUrlInfo",t):XRD.dispatch("rCheckUrlFailed",e)}))}else if(this.index===2){var r=$("#pop-newtask-multi-url").val();if(r&&r!=this.multiUrl){this.multiUrl=r,$("#pop-newtask-multi-list").children().remove();var i=r.split("\n");this.validUrl=!1;for(var s=0;s<i.length;s++)i[s]=Helper.trim(i[s]),i[s]&&/^(http|https|ftp|magnet|ed2k|thunder|mms|rtsp)\:.+/.test(i[s])&&XRD.dispatch("rCheckUrl",{pid:XRD.info.currentDownloader,url:i[s]})}}XRD.dispatch("popNewTaskRefresh"),this.checkUrlHandle=setTimeout(function(){t.checking=!1,t.checkable&&XRD.dispatch("popNewTaskCheckUrl")},1e3)},urlInfo:function(e,t){var n=t.taskInfo,r=$("#pop-newtask-tab-title .on").index();if(r==0)this.requiredSpace=+n.size,$("#pop-newtask-name").val(n.name),$("#pop-newtask-name").attr("data-size",n.size);else if(r==1){$("#pop-newtask-bt-list").children().remove();for(var i=0;i<n.subList.length;i++){this.requiredSpace+=+n.subList[i].size;var s=n.subList[i].selected?"checked":"",o=i%2?"hoverbg":"",u=n.subList[i].name;u.lastIndexOf("/")!=-1&&(u=u.substr(u.lastIndexOf("/")+1));var a=$('<div class="rwli '+o+'">'+'<div class="colbt colfirst">'+'<span class="sel_form">'+'<input type="checkbox" class="selit" '+s+' data-id="'+n.subList[i].id+'" data-filesize="'+n.subList[i].size+'" data-selected="'+n.subList[i].selected+'" data-auto-select="'+String(this.isAutoSelect(n.subList[i].name,n.subList[i].size))+'" />'+"</span>"+"</div>"+'<div class="colbt bt_name">'+'<div class="filename" title="'+n.subList[i].name+'">'+u+"</div>"+"</div>"+'<div class="colbt bt_size">'+Helper.byte2Size(n.subList[i].size,2)+"</div>"+'<div class="colbt bt_type">'+Helper.getExtension(n.subList[i].name)+"</div>"+"</div>");$("#pop-newtask-bt-list").append(a)}$("#pop-newtask-bt-name").val(n.name),$("#pop-newtask-bt-name").attr("data-infohash",t.infohash),$("#pop-newtask-bt-details, #pop-newtask-bt-controls").show(),XRD.dispatch("popBtAutoSelect")}else if(r==2){this.requiredSpace+=+n.size;var f=$("#pop-newtask-multi-list").children().size(),o=f%2?"hoverbg":"",a=$('<div class="rwli '+o+'">'+'<div class="colbt colfirst">'+'<span class="sel_form">'+'<input type="checkbox" class="selit" checked data-filename="'+n.name+'" data-filesize="'+n.size+'" data-url="'+n.url+'" />'+"</span>"+"</div>"+'<div class="colbt bt_name">'+'<div class="filename" title="'+n.name+'">'+n.name+"</div>"+"</div>"+'<div class="colbt bt_size">'+Helper.byte2Size(n.size,2)+"</div>"+'<div class="colbt bt_type">'+Helper.getExtension(n.name)+"</div>"+"</div>");$("#pop-newtask-multi-list").append(a),$("#pop-newtask-multi-details, #pop-newtask-multi-controls").show()}var l=$(window).height()-$("#pop-newtask").height();l>100?l=100:l<0&&(l=0),l+="px",$("#pop-newtask").css("top",l),this.validUrl=!0,XRD.dispatch("popNewTaskRefresh")},checkUrlFailed:function(e,t){if(t==201){var n=$("#pop-newtask-tab-title .on").index();n==0&&(this.validUrl=!1,XRD.dispatch("popNewTaskRefresh"))}},createTaskCallback:function(e,t){var t=t.tasks,n=t.length;if(n==1){var r=t[0];r.result==0?XRD.dispatch("rTaskCreated"):XRD.dispatch("rTaskCreateFailed",r.result)}else{var i=0,s=null;for(var o=0;o<n;o++){var r=t[o];s=$("#pop-newtask-multi-list [data-url='"+r.url+"']").parent().parent().parent(),r.result==0?s.remove():i==0&&(i=r.result)}i==0?XRD.dispatch("rTaskCreated"):(XRD.dispatch("popNewTaskRefresh"),XRD.dispatch("rTaskCreateFailed",i))}},createTaskSuccess:function(e,t){XRD.dispatch("popNewTaskClose"),XRD.dispatch("rShowRunningTasks")},createTaskFailed:function(e,t){t===202?$("#pop-newtask-message").html("创建任务失败：下载器中已存在相同的任务"):$("#pop-newtask-message").html("创建任务失败：错误 #"+t)},createTask:function(e,t,n){if(!XRD.info.currentDownloader){var r=$("#sidebar-downloader-list [data-pid]:first").data("pid");r&&XRD.info.downloaderList[r].accesscode&&!XRD.getPassed(r)&&XRD.dispatch("popAccessCode",r,function(){XRD.dispatch("popCreateTask",t,n)});return}XRD.dispatch("popNewTaskOpen"),t&&($("#pop-newtask-url").val(t),n&&$("#pop-newtask-name").val(n)),XRD.dispatch("popNewTaskRefresh")},importTasks:function(e,t){XRD.dispatch("popNewTaskOpen"),$("#pop-newtask-tab-title").children().eq(2).trigger("click"),Helper.loadExternalData(t,"data",function(e){var t="";for(var n=0;n<e.length;n++)t+=e[n].url+"\n";$("#pop-newtask-multi-url").val(t),XRD.dispatch("popNewTaskCheckUrl")})},autoSelect:function(){$("#pop-newtask-bt-list input").removeAttr("checked"),$("#pop-newtask-bt-list input[data-auto-select=1]").attr("checked","checked")},isAutoSelect:function(e,t){t=Number(t);if(t<15360)return 0;e=Helper.trim(e.toLowerCase());if(e==="thumbs.db")return 0;var n=e.substr(e.length-4);switch(n){case".txt":case".url":case"html":case".htm":return 0;default:}return 1},taskDownloaderConfig:function(e,t){var n=t.defaultPath;if(Helper.isString(n)&&n!=""){var r=n.split(":"),i=r[0];if(r[1]&&r[1]!=""&&r[1]!="/")var s=r[1];else var s="/TDDOWNLOAD/";XRD.info.downloaderList[$("#pop-newtask-downloaders").val()].defaultDisk=i}else{var i="C";XRD.info.downloaderList[$("#pop-newtask-downloaders").val()].defaultDisk=i;var s="/TDDOWNLOAD/"}$("#pop-newtask-disklist").attr("data-defaultDisk",i),$("#pop-newtask-disklist").attr("data-defaultPath",s);var o=$("#pop-newtask-disklist option").length;for(var u=0;u<o;u++)if($("#pop-newtask-disklist ").get(0).options[u].text==i+":"){$("#pop-newtask-disklist ").get(0).options[u].selected=!0;break}$("#pop-newtask-disklist").trigger("change")},taskDownloaderConfigFailed:function(e,t){$("#pop-newtask-disklist").attr("data-defaultDisk","C"),$("#pop-newtask-disklist").attr("data-defaultPath","/TDDOWNLOAD/"),$("#pop-newtask-disklist").trigger("change")}})
XRD.attach("PopVDPage",{init:function(){XRD.on("popVDPageOpen",this.open,this),XRD.on("popVDPageClose",this.close,this),$("#pop-vdpage").css("top",$(window).height()/2+"px").css("left",$(window).width()/2+"px").css("margin-top",0-$("#pop-vdpage").height()/2).css("margin-left",0-$("#pop-vdpage").width()/2)},open:function(e){XRD.dispatch("showBgMask"),$("#pop-vdpage").fadeIn("fast")},close:function(e){XRD.dispatch("hideBgMask"),$("#pop-vdpage").fadeOut("normal")}})
XRD.attach("PopVDActive",{init:function(){XRD.on("popVDActiveOpen",this.open,this),XRD.on("popVDActiveClose",this.close,this),XRD.on("popVDActiveOkay",this.okay,this),$("#pop-vdactive").css("top",$(window).height()/2+"px").css("left",$(window).width()/2+"px").css("margin-top",0-$("#pop-vdactive").height()/2).css("margin-left",0-$("#pop-vdactive").width()/2)},open:function(e){XRD.dispatch("showBgMask"),$("#pop-vdactive").fadeIn("fast")},close:function(e){XRD.dispatch("hideBgMask"),$("#pop-vdactive").fadeOut("normal")},okay:function(e){XRD.info.inXL&&external.ShowInstallPanel(),XRD.dispatch("popVDActiveClose")}})
XRD.attach("PopExport",{init:function(){ZeroClipboard.setMoviePath("img/ZeroClipboard.png"),XRD.on("popExportOpen",this.open,this),XRD.on("popExportClose",this.close,this),XRD.on("popExportOkay",this.okay,this),XRD.on("popExportUrl",this.exportUrl,this),$("#pop-export").css("top",$(window).height()/2+"px").css("left",$(window).width()/2+"px").css("margin-top",0-$("#pop-export").height()/2).css("margin-left",0-$("#pop-export").width()/2)},open:function(e){XRD.dispatch("showBgMask"),$("#pop-export").fadeIn("fast"),this.clipboard=new ZeroClipboard.Client,this.clipboard.glue("pop-export-copy","pop-export-copy-container"),this.clipboard.addEventListener("onMouseDown",function(e){e.setText($("#pop-export-urls").val().replace(/([^\r])\n/g,"$1\r\n"))}),this.clipboard.addEventListener("onMouseUp",function(e){$("#pop-export-subinfo").html("已复制到剪贴板")}),$("#pop-export-urls").keydown(function(){$("#pop-export-subinfo").html("")}),$("#pop-export-subinfo").html("")},close:function(e){XRD.dispatch("hideBgMask"),$("#pop-export").fadeOut("normal"),$("#pop-export-urls").val("")},okay:function(e){},exportUrl:function(e,t){var n="";if(!t){var r=XRD.info.selectedTasks,i=XRD.info.currentTaskList,s=null;for(var o=0;o<r.length;o++)s=i[r[o]],s.url&&(n+=s.url+"\n \n")}n?$("#pop-export-urls").val(n):$("#pop-export-urls").val("无法获取所选任务的URL"),XRD.dispatch("popExportOpen")}})
XRD.attach("PopProperty",{init:function(){XRD.on("popPropertyOpen",this.open,this),XRD.on("popPropertyClose",this.close,this)},open:function(e){if(!XRD.info.downloaderList[XRD.info.currentDownloader].online){XRD.dispatch("popHintOffline");return}if(!XRD.info.downloaderList[XRD.info.currentDownloader].storage){XRD.dispatch("popHintNoStorage");return}if(XRD.info.selectedTasks.length!==1)return!1;var t=XRD.info.currentTaskList[XRD.info.selectedTasks[0]];t.type==2&&!XRD.info.downloaderList[XRD.info.currentDownloader].isLite?($("#pop-property-width").removeClass("layer_widthsmall").addClass("layer_width"),$("#property-bt-sublist").html(""),$("#pop-property-bt-sublist").show(),Protocol.getBtSubList(XRD.info.currentDownloader,XRD.info.selectedTasks[0],function(e){if(!e.rtn){var t="",n="",r="";for(var i=0;i<e.taskInfo.subList.length;i++)r=e.taskInfo.subList[i].name,n=r.substr(r.lastIndexOf(".")),r.lastIndexOf("/")!=-1&&(r=r.substr(r.lastIndexOf("/")+1)),i%2?t+='<div class="pop_list_unit pop_list_bggr"><span class="pop_sp_name"><!--input class="pop_list_check" type="checkbox" /--><p class="pop_sp_filename"  title="'+r+'">'+r+'</p></span><span class="pop_sp_size">'+Helper.byte2Size(e.taskInfo.subList[i].size,2)+'</span><span class="pop_sp_type">'+e.taskInfo.subList[i].progress/100+"%</span></div>":t+='<div class="pop_list_unit"><span class="pop_sp_name"><!--input class="pop_list_check" type="checkbox" /--><p class="pop_sp_filename" title="'+r+'">'+r+'</p></span><span class="pop_sp_size">'+Helper.byte2Size(e.taskInfo.subList[i].size,2)+'</span><span class="pop_sp_type">'+e.taskInfo.subList[i].progress/100+"%</span></div>";$("#property-bt-sublist").html(t)}})):($("#pop-property-width").removeClass("layer_width").addClass("layer_widthsmall"),$("#pop-property-bt-sublist").hide(),$("#pop-property-bt-selector").hide()),$("#taskPropertyName").html(t.name).attr("title",t.name),$("#taskPropertySize").html(Helper.byte2Size(t.size,2));var n=/\/?(([a-z]+):.+)$/i.exec(t.path);$("#taskPropertyPath").val(n[1]),t.type<=0&&(t.type=1),$("#taskPropertyIcon").attr("src","images/"+t.type+".png"),$("#taskPropertyDownloader").val(XRD.info.downloaderList[XRD.info.currentDownloader].name),XRD.info.downloaderList[XRD.info.currentDownloader].online&&Protocol.boxSpace(XRD.info.currentDownloader,function(e){var t=0,r=0;for(var i=0;i<e.space.length;i++)t+=Number(e.space[i].remain),e.space[i].path===n[2]&&(r=e.space[i].remain);$("#taskPropertyDownloaderRemainSpace").html(Helper.byte2Size(t,2)),$("#taskPropertyPartitionRemainSpace").html(Helper.byte2Size(r,2))}),XRD.dispatch("showBgMask"),$("#pop-property").fadeIn("fast")},close:function(e){XRD.dispatch("hideBgMask"),$("#pop-property").fadeOut("fast",function(){$("#taskPropertyDownloaderRemainSpace").html("-"),$("#taskPropertyPartitionRemainSpace").html("-")})}})
XRD.attach("PopVip",{init:function(){XRD.on("popVipOpen",this.open,this),XRD.on("popVipClose",this.close,this),$("#pop-vip").css("top",$(window).height()/2+"px").css("left",$(window).width()/2+"px").css("margin-top",0-$("#pop-vip").height()/2).css("margin-left",0-$("#pop-vip").width()/2)},open:function(e){XRD.dispatch("showBgMask"),$("#pop-vip").fadeIn("fast")},close:function(e){XRD.dispatch("hideBgMask"),$("#pop-vip").fadeOut("normal")}})
XRD.attach("PopAccessCode",{init:function(){this.pid=null,this.okayCallback=null,XRD.on("popAccessCodeOpen",this.open,this),XRD.on("popAccessCodeClose",this.close,this),XRD.on("popAccessCodeOkay",this.okay,this),XRD.on("popAccessCode",this.show,this),XRD.on("rAccessCodePassed",this.passed,this),XRD.on("rAccessCodeFailed",this.failed,this),$("#pop-accesscode-key").keydown(function(){$("#pop-accesscode-message").html("")}),$("#pop-accesscode").css("top",$(window).height()/2+"px").css("left",$(window).width()/2+"px").css("margin-top",0-$("#pop-accesscode").height()/2).css("margin-left",0-$("#pop-accesscode").width()/2)},open:function(e){XRD.dispatch("showBgMask"),$("#pop-accesscode").fadeIn("fast")},close:function(e){XRD.dispatch("hideBgMask"),$("#pop-accesscode").fadeOut("normal")},okay:function(e){var t=$("#pop-accesscode-pid").val(),n=$("#pop-accesscode-key").val();Helper.isString(n)&&n.length>0?XRD.dispatch("rVerifyAccessCode",t,n):$("#pop-accesscode-message").html("访问密码不能为空")},show:function(e,t,n){XRD.info.accessCodePopped=1,this.pid=t,this.okayCallback=n,$("#pop-accesscode-pid").val(t),$("#pop-accesscode-key").val(""),$("#pop-accesscode-name").html(XRD.info.downloaderList[t].name),XRD.dispatch("popAccessCodeOpen")},passed:function(e){XRD.setPassed(this.pid),XRD.dispatch("popAccessCodeClose"),Helper.isFunction(this.okayCallback)&&this.okayCallback()},failed:function(e,t){$("#pop-accesscode-message").html(t)}})
XRD.attach("PopBindVip",{init:function(){XRD.on("popBindVipOpen",this.open,this),XRD.on("popBindVipClose",this.close,this),XRD.on("popBindVip",this.popBindVip,this),$("#pop-bind-vip").css("top",$(window).height()/2+"px").css("left",$(window).width()/2+"px").css("margin-top",0-$("#pop-bind-vip").height()/2).css("margin-left",0-$("#pop-bind-vip").width()/2)},open:function(e){XRD.dispatch("showBgMask"),$("#pop-bind-vip").fadeIn("fast")},close:function(e){XRD.dispatch("hideBgMask"),$("#pop-bind-vip").fadeOut("normal")},popBindVip:function(e,t,n){$("#pop-bind-vip-message1").html(t),$("#pop-bind-vip-message2").html(n),XRD.dispatch("popBindVipOpen")}})
XRD.attach("Terminal",{init:function(){XRD.on("rGetDownloaderList",this.getDownloaderList,this),XRD.on("rGetDownloaderConfig",this.getDownloaderConfig,this),XRD.on("rLoginDownloader",this.loginDownloader,this),XRD.on("rGetDownloaderSpace",this.getDownloaderSpace,this),XRD.on("rAddDownloader",this.addDownloader,this),XRD.on("rConfigDownloader",this.configDownloader,this),XRD.on("rRenameDownloader",this.renameDownloader,this),XRD.on("rRemoveDownloader",this.removeDownloader,this),XRD.on("rVerifyAccessCode",this.verifyAccessCode,this),XRD.on("rGetTaskList",this.getTaskList,this),XRD.on("rCreateTask",this.createTask,this),XRD.on("rCreateMultiTask",this.createMultiTask,this),XRD.on("rStartTasks",this.startTasks,this),XRD.on("rPauseTasks",this.pauseTasks,this),XRD.on("rRemoveTasks",this.removeTasks,this),XRD.on("rRecycleTasks",this.recycleTasks,this),XRD.on("rRestoreTasks",this.restoreTasks,this),XRD.on("rClearTasks",this.clearTasks,this),XRD.on("rActiveVipChannel",this.activeVipChannel,this),XRD.on("rActiveLixianChannel",this.activeLixianChannel,this),XRD.on("rCheckUrl",this.checkUrl,this)},connectError:function(){XRD.dispatch("connectError")},getDownloaderList:function(e){Protocol.listPeer(function(e){e&&e.rtn==0?XRD.dispatch("rDownloaderList",e.peerList):e&&e.rtn==1004?XRD.dispatch("logout"):e&&e.rtn==1005?XRD.dispatch("rDownloaderList",[]):XRD.dispatch("rDownloaderListFailed",e?e.rtn:null)},this.connectError)},getDownloaderConfig:function(e,t,n){n=="config"?Protocol.getConfig(t,function(e){e&&e.rtn==0?XRD.dispatch("rDownloaderConfig",e):XRD.dispatch("rGetDownloaderConfigFailed",e?e.rtn:null)},this.connectError):Protocol.getConfig(t,function(e){e&&e.rtn==0?XRD.dispatch("rTaskDownloaderConfig",e):XRD.dispatch("rTaskGetDownloaderConfigFailed",e?e.rtn:null)},this.connectError)},loginDownloader:function(e,t){Protocol.login(t,"",function(e){e&&e.rtn==0?XRD.dispatch("rDownloaderLogined",e,t):e&&e.rtn==1004?XRD.dispatch("logout"):XRD.dispatch("rDownloaderLoginFailed",e?e.rtn:null,t)},this.connectError)},getDownloaderSpace:function(e,t,n){n=="config"?Protocol.boxSpace(t,function(e){e&&e.rtn==0?XRD.dispatch("rConfDownloaderSpace",e.space):XRD.dispatch("rConfDownloaderSpaceFailed",e?e.rtn:null)},this.connectError):Protocol.boxSpace(t,function(e){e&&e.rtn==0?XRD.dispatch("rDownloaderSpace",e.space):XRD.dispatch("rDownloaderSpaceFailed",e?e.rtn:null)},this.connectError)},addDownloader:function(e,t){Protocol.bind("",t,function(e){e&&e.rtn==0?XRD.dispatch("rDownloaderAdded",e):XRD.dispatch("rDownloaderAddFailed",e?e.rtn:null)},this.connectError)},configDownloader:function(e,t,n){var r=t.pid;delete t.pid,n=="config"?Protocol.setConfig(r,t,function(e){e&&e.rtn==0?(XRD.dispatch("rDownloaderConfigured"),XRD.dispatch("rDownloaderConfigSuccess",e)):XRD.dispatch("rDownloaderConfigureFailed",e?e.rtn:null)},this.connectError):Protocol.setConfig(r,t,function(e){e&&e.rtn==0?XRD.dispatch("rDownloaderConfigured"):XRD.dispatch("rDownloaderConfigureFailed",e?e.rtn:null)},this.connectError)},renameDownloader:function(e,t){var n=t.pid,r=t.name;Protocol.rename(n,r,function(e){e&&e.rtn==0?XRD.dispatch("rDownloaderRenamed"):XRD.dispatch("rDownloaderRenameFailed",e?e.rtn:null)},this.connectError)},removeDownloader:function(e,t){Protocol.unbind(t,function(e){e&&e.rtn==0?XRD.dispatch("rDownloaderRemoved"):XRD.dispatch("rDownloaderRemoveFailed",e?e.rtn:null)},this.connectError)},verifyAccessCode:function(e,t,n){Protocol.verifyAccessCode(t,n,function(e){e&&e.rtn==0?XRD.dispatch("rAccessCodePassed"):XRD.dispatch("rAccessCodeFailed",e?e.msg:"验证失败")},this.connectError)},getTaskList:function(e,t){var n=t.pid,r=t.type,i=Helper.toNumber(t.offset),s=Helper.toNumber(t.size);if(!n)return;Protocol.list(n,r,i,s,function(e){e&&e.rtn==0?(XRD.dispatch("rTaskList",e.tasks),XRD.dispatch("rDownloaderTaskStat",{runningCount:e.dlNum,completedCount:e.completeNum,recycledCount:e.recycleNum,failedCount:e.serverFailNum})):XRD.dispatch("rTaskListFailed",e?e.rtn:null)},this.connectError)},startTasks:function(e,t){if(!Helper.isArray(t)&&t)var n=[t];else var n=Helper.cloneArray(t);for(var r=0;r<n.length;r++)n[r]=n[r]+"_"+XRD.info.currentTaskList[n[r]].state;Protocol.start(XRD.info.currentDownloader,n,function(e){e&&e.rtn==0?XRD.dispatch("rTaskStarted"):XRD.dispatch("rTaskStartFailed",e?e.rtn:null)},this.connectError)},pauseTasks:function(e,t){if(!Helper.isArray(t)&&t)var n=[t];else var n=Helper.cloneArray(t);for(var r=0;r<n.length;r++)n[r]=n[r]+"_"+XRD.info.currentTaskList[n[r]].state;Protocol.pause(XRD.info.currentDownloader,n,function(e){e&&e.rtn==0?XRD.dispatch("rTaskPaused"):XRD.dispatch("rTaskPauseFailed",e?e.rtn:null)},this.connectError)},removeTasks:function(e,t,n){if(!Helper.isArray(t)&&t)var r=[t];else var r=Helper.cloneArray(t);for(var i=0;i<r.length;i++)r[i]=r[i]+"_"+XRD.info.currentTaskList[r[i]].state;Protocol.del(XRD.info.currentDownloader,r,0,!!n,function(e){e&&e.rtn==0?XRD.dispatch("rTaskRemoved"):XRD.dispatch("rTaskRemoveFailed",e?e.rtn:null)},this.connectError)},recycleTasks:function(e,t,n){if(!Helper.isArray(t)&&t)var r=[t];else var r=Helper.cloneArray(t);for(var i=0;i<r.length;i++)r[i]=r[i]+"_"+XRD.info.currentTaskList[r[i]].state;Protocol.del(XRD.info.currentDownloader,r,1,!!n,function(e){e&&e.rtn==0?XRD.dispatch("rTaskRecycled"):XRD.dispatch("rTaskRecycleFailed",e?e.rtn:null)},this.connectError)},restoreTasks:function(e,t){if(!Helper.isArray(t)&&t)var n=[t];else var n=Helper.cloneArray(t);Protocol.restore(XRD.info.currentDownloader,n,function(e){e&&e.rtn==0?XRD.dispatch("rTaskRestored"):XRD.dispatch("rTaskRestoreFailed",e?e.rtn:null)},this.connectError)},clearTasks:function(e,t){Protocol.clear(XRD.info.currentDownloader,t,function(e){e&&e.rtn==0?XRD.dispatch("rTaskCleared"):XRD.dispatch("rTaskClearFailed",e?e.rtn:null)},this.connectError)},activeVipChannel:function(e,t){if(!Helper.isArray(t)&&t)var n=[t];else var n=Helper.cloneArray(t);for(var r=0;r<n.length;r++)Protocol.openVipChannel(n[r],XRD.info.currentDownloader,function(e){e&&e.rtn==0?XRD.dispatch("rVipChannelActived"):XRD.dispatch("rVipChannelFailed",e?e.rtn:null)},this.connectError)},activeLixianChannel:function(e,t){if(!Helper.isArray(t)&&t)var n=[t];else var n=Helper.cloneArray(t);for(var r=0;r<n.length;r++)Protocol.openLixianChannel(n[r],XRD.info.currentDownloader,function(e){e&&e.rtn==0?XRD.dispatch("rLixianChannelActived"):XRD.dispatch("rLixianChannelFailed",e?e.rtn:null)},this.connectError)},checkUrl:function(e,t){var n=t.pid,r=t.url;Protocol.urlCheck(n,Helper.urlEncode(r),1,function(e){e&&e.rtn==0?XRD.dispatch("rUrlInfo",e):XRD.dispatch("rCheckUrlFailed",e?e.rtn:null)})},createTask:function(e,t){var n=t.pid,r=t.path,i=t.url,s=t.name;Protocol.createOne(n,r,Helper.urlEncode(i),Helper.urlEncode(s),1,0,function(e){e&&e.rtn==0?XRD.dispatch("rTaskCreated"):XRD.dispatch("rTaskCreateFailed",e?e.rtn:null)},this.connectError)},createMultiTask:function(e,t){var n=t.info,r=t.list;Protocol.createMulti(n,r,function(e){if(e&&e.rtn==0){if(e&&e.tasks)for(var t=0;t<e.tasks.length;t++)if(e.tasks[t].result===202){XRD.dispatch("rMultiTaskCreateFailed",202);return}XRD.dispatch("rMultiTaskCreated")}else XRD.dispatch("rMultiTaskCreateFailed",e?e.rtn:null)},this.connectError)}})
XRD.attach("Listener",{init:function(){$(document).contextmenu(function(e){XRD.dispatch("contextMenu",e)}),document.body.onclick=function(){XRD.dispatch("closeFloating")}}})
